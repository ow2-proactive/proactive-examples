<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<job xmlns="urn:proactive:jobdescriptor:3.12" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" maxNumberOfExecution="2" name="Distributed_Auto_ML" onTaskError="continueJobExecution" priority="normal" projectName="1. Automated Machine Learning" xsi:schemaLocation="urn:proactive:jobdescriptor:3.12 http://www.activeeon.com/public_content/schemas/proactive/jobdescriptor/3.12/schedulerjob.xsd">
  <variables>
    <variable name="NATIVE_SCHEDULER" value=""/>
    <variable name="NATIVE_SCHEDULER_PARAMS" value=""/>
    <variable name="NODE_ACCESS_TOKEN" value=""/>
    <variable name="NODE_SOURCE_NAME" value=""/>
    <variable model="PA:LIST(no-container,docker,podman,singularity)" name="CONTAINER_PLATFORM" value="docker"/>
    <variable model="PA:Boolean" name="PROPAGATE_CONTAINER_PLATFORM" value="True"/>
    <variable model="PA:Boolean" name="CONTAINER_GPU_ENABLED" value="False"/>
    <variable model="PA:LIST(,docker://activeeon/dlm3,docker://activeeon/cuda,docker://activeeon/cuda2,docker://activeeon/rapidsai,docker://activeeon/tensorflow:latest,docker://activeeon/tensorflow:latest-gpu)" name="CONTAINER_IMAGE" value=""/>
    <variable model="PA:LIST(Bayes,Grid,Random,QuasiRandom,CMAES,MOCMAES)" name="TUNING_ALGORITHM" value="Random"/>
    <variable model="PA:CATALOG_OBJECT" name="WORKFLOW_TO_OPTIMIZE" value="auto-ml-optimization/Himmelblau_Function"/>
    <variable model="PA:Integer" name="NUMBER_OF_REPETITIONS" value="-1"/>
    <variable model="PA:Integer" name="MAX_ITERATIONS" value="2"/>
    <variable model="PA:Integer" name="PARALLEL_EXECUTIONS_PER_ITERATION" value="2"/>
    <variable model="PA:Integer" name="PAUSE_AFTER_EVERY_ITERATIONS" value="-1"/>
    <variable model="PA:Boolean" name="VISDOM_ENABLED" value="False"/>
    <variable model="PA:Boolean" name="VISDOM_PROXYFIED" value="False"/>
    <variable model="PA:Boolean" name="VISDOM_ENABLE_LOGIN" value="False"/>
    <variable name="VISDOM_USERNAME" value=""/>
    <variable model="PA:HIDDEN" name="VISDOM_PASSWORD" value=""/>
    <variable model="PA:NOT_EMPTY_STRING" name="VISDOM_INSTANCE_NAME" value="visdom-server-${PA_JOB_ID}"/>
    <variable model="PA:Boolean" name="TENSORBOARD_ENABLED" value="False"/>
    <variable model="PA:NOT_EMPTY_STRING" name="TENSORBOARD_INSTANCE_NAME" value="tensorboard-server-${PA_JOB_ID}"/>
    <variable model="PA:NOT_EMPTY_STRING" name="TENSORBOARD_HOST_LOG_PATH" value="/shared/$TENSORBOARD_INSTANCE_NAME"/>
    <variable model="PA:NOT_EMPTY_STRING" name="TENSORBOARD_CONTAINER_LOG_PATH" value="/tmp/$TENSORBOARD_INSTANCE_NAME"/>
    <variable model="PA:Boolean" name="TENSORBOARD_PROXYFIED" value="False"/>
  </variables>
  <description>
    <![CDATA[ This workflow proposes six algorithms for hyperparameter optimization. The choice of the sampling/search strategy depends strongly on the problem tackled. ]]>
  </description>
  <genericInformation>
<info name="bucketName" value="auto-ml-optimization"/>
<info name="workflow.icon" value="/automation-dashboard/styles/patterns/img/wf-icons/tunning_algorithm.png"/>
<info name="NODESOURCENAME" value="$NODE_SOURCE_NAME"/>
<info name="NS" value="$NATIVE_SCHEDULER"/>
<info name="Documentation" value="PML/PMLUserGuide.html#_AutoML"/>
<info name="NODE_ACCESS_TOKEN" value="$NODE_ACCESS_TOKEN"/>
<info name="NS_BATCH" value="$NATIVE_SCHEDULER_PARAMS"/>
<info name="group" value="public-objects"/>
</genericInformation>
  <taskFlow>
    <task fork="true" name="Split">
      <description>
        <![CDATA[ This task defines some input, here strings to be processed. ]]>
      </description>
      <genericInformation>
        <info name="task.icon" value="/automation-dashboard/styles/patterns/img/wf-icons/controls_replicate.png"/>
      </genericInformation>
      <depends>
        <task ref="Else"/>
      </depends>
      <forkEnvironment javaHome="/usr">
        <envScript>
          <script>
            <file language="groovy" url="${PA_CATALOG_REST_URL}/buckets/scripts/resources/fork_env_cuda_universal/raw"/>
          </script>
        </envScript>
      </forkEnvironment>
      <scriptExecutable>
        <script>
          <code language="cpython">
            <![CDATA[
import ssl
import json
import numpy as np
import urllib.request
from lxml import etree

import chocolate as choco
from chocolate import uniform, quantized_uniform, log, quantized_log, choice
from chocolate import MongoDBConnection, Bayes, Grid, Random, QuasiRandom, CMAES, MOCMAES, Repeat


def raiser(msg): raise Exception(msg)


PA_JOB_ID = variables.get("PA_JOB_ID")
print('PA_JOB_ID: ', PA_JOB_ID)

PA_TASK_ITERATION = int(variables.get('PA_TASK_ITERATION'))
print("PA_TASK_ITERATION: ", PA_TASK_ITERATION)

PA_CATALOG_REST_URL = variables.get("PA_CATALOG_REST_URL")
print('PA_CATALOG_REST_URL: ', PA_CATALOG_REST_URL)

# Workflow to optimize
WORKFLOW_TO_OPTIMIZE = variables.get("WORKFLOW_TO_OPTIMIZE")
bucket_name, workflow_name = WORKFLOW_TO_OPTIMIZE.split('/')
print("bucket_name: ", bucket_name, ", workflow_name: ", workflow_name)

# workflow_url = PA_CATALOG_REST_URL + '/buckets/auto-ml-optimization/resources/Himmelblau_Function/raw'
workflow_url = PA_CATALOG_REST_URL + '/buckets/'+bucket_name+'/resources/'+workflow_name+'/raw'
print("workflow_url: ", workflow_url)

if workflow_url.startswith('https'):
    workflow_xml = urllib.request.urlopen(workflow_url, context=ssl._create_unverified_context()).read()
else:
    workflow_xml = urllib.request.urlopen(workflow_url).read()
# print("workflow_xml: " + str(workflow_xml))

# Define the search space
# space = "space=" + variables.get('SEARCH_SPACE')
# print('SEARCH_SPACE: ', space)
# exec(space)
workflow_root = etree.fromstring(workflow_xml)

search_space_xpath = "string(//*[@name='SEARCH_SPACE']/@value)"
search_space = str(workflow_root.xpath(search_space_xpath))

if len(str(search_space)) <= 0:
    raiser("The objective workflow do not contains a SEARCH_SPACE variable!")

search_space_model_xpath = "string(//*[@name='SEARCH_SPACE']/@model)"
search_space_model = str(workflow_root.xpath(search_space_model_xpath))

if len(str(search_space_model)) <= 0:
    raiser("The SEARCH_SPACE variable of the objective workflow do not contains a model type!")

# search key dict
def key_search(i):
    try:
        keys = list(i.keys())
    except:
         keys = []
    return keys

# get key and value dict
def key_value_get(key, value):
    aux = key.strip() + "(" + str(value) + ")"
    if key.strip() == 'uniform' or key.strip() == "quantized_uniform" or key.strip() == "log" or key.strip() == "quantized_log":
        aux = aux.replace('[', '')
        aux = aux.replace(']', '')
    return aux

# convert json to chocolate format
def json_to_choco_convert(search_space):
    cont_model = 0
    for data in search_space:
        key_list = key_search(data) 
        if not key_list:
            key, value = list(search_space[data].items())[0]
            aux = key_value_get(key, value)
            search_space[data] = eval(aux)
        else:
            for i in key_list:
                try:
                    key, value = list(data[i].items())[0]
                    aux = key_value_get(key, value)
                    search_space[cont_model][i] = eval(aux)
                except:
                    pass
            cont_model += 1
    return search_space

if search_space_model.upper() == 'PA:JSON':
    # Define the search space from a JSON string
    space = "space=" + str(search_space)
    exec(space)
    space = json_to_choco_convert(space)
    print("\nspace: ", space)

if search_space_model.upper() == 'PA:CATALOG_OBJECT':
    # Define the search space from a JSON file stored in the catalog
    search_space_bucket_name, search_space_script_name = search_space.split('/')
    print("search_space_bucket_name: ", search_space_bucket_name, ", search_space_script_name: ", search_space_script_name)
    search_space_script_url = PA_CATALOG_REST_URL + '/buckets/'+search_space_bucket_name+'/resources/'+search_space_script_name+'/raw'
    print("search_space_script_url: ", search_space_script_url)
    if search_space_script_url.startswith('https'):
        search_space_script_json = json.loads(urllib.request.urlopen(search_space_script_url, context=ssl._create_unverified_context()).read())
    else:
        search_space_script_json = json.loads(urllib.request.urlopen(search_space_script_url).read())
    print("\nsearch_space_script_json: ", search_space_script_json)
    space = json_to_choco_convert(search_space_script_json)
    print("\nspace: ", space)


# Establish a connection to a MongoDB local database
MONGODB_URL = variables.get('MONGODB_URL')
print('MONGODB_URL: ', MONGODB_URL)
conn = MongoDBConnection(MONGODB_URL)
if PA_TASK_ITERATION == 0:
    print('Cleaning database for the first iteration')
    conn.clear() # Clear all data from the database.

TUNING_ALGORITHM = variables.get('TUNING_ALGORITHM')
assert TUNING_ALGORITHM is not None, "TUNING_ALGORITHM must be set!"
TUNING_ALGORITHM = TUNING_ALGORITHM.lower()
print('TUNING_ALGORITHM: ', TUNING_ALGORITHM)

cross_validation = int(variables.get('NUMBER_OF_REPETITIONS'))
cv = None
if cross_validation > 1:
    cv = Repeat(repetitions=cross_validation, reduce=np.mean, rep_col="_repetition_id")

# Construct the optimizer
sampler = None
if TUNING_ALGORITHM == "grid":
    sampler = Grid(conn, space, cv)
if TUNING_ALGORITHM == "random":
    sampler = Random(conn, space, cv)
if TUNING_ALGORITHM == "quasirandom":
    sampler = QuasiRandom(conn, space, cv)
if TUNING_ALGORITHM == "bayes":
    sampler = Bayes(conn, space, cv)
if TUNING_ALGORITHM == "cmaes":
    sampler = CMAES(conn, space, cv)
if TUNING_ALGORITHM == "mocmaes":
    sampler = MOCMAES(conn, space, cv)
assert sampler is not None, "TUNING_ALGORITHM must be selected!"

# Check for previous results
workflow_results = None
if PA_TASK_ITERATION > 0:
    workflow_results = variables.get('workflow_results')

# Add previous loss values to the database
if workflow_results is not None:
    previous_results = json.loads(workflow_results)
    print("Adding previous loss values to the database")
    for i, previous_result in enumerate(previous_results):
        # print(i, previous_result)
        previous_token = previous_result['token']
        previous_loss = previous_result['loss']
        print(i, 'previous_token: ', previous_token, ', previous_loss: ', previous_loss)
        # Add the loss to the database
        # sampler.update(token, loss)
        sampler.update(previous_token, previous_loss)

# Sample the next point
samples_per_iteration = int(variables.get('PARALLEL_EXECUTIONS_PER_ITERATION'))
result = []
try:
    for i in range(samples_per_iteration):
        token, params = sampler.next()
        token_params = {
          'token': token,
          'params': params
        }
        token_params_json = json.dumps(token_params)
        print("sample: ", i, ", token_params: ", token_params_json)
        result.append(token_params_json)
except StopIteration:
    print("Stopping iteration...")
    pass

print('result: ', result)
]]>
          </code>
        </script>
      </scriptExecutable>
      <controlFlow>
        <replicate>
          <script>
            <code language="groovy">
              <![CDATA[
runs = result.size()
println "runs: " + runs
]]>
            </code>
          </script>
        </replicate>
      </controlFlow>
      <metadata>
        <positionTop>
            797.8125
        </positionTop>
        <positionLeft>
            481.62109375
        </positionLeft>
      </metadata>
    </task>
    <task fork="false" name="Submit_Job_No_Wait">
      <description>
        <![CDATA[ This task will be replicated according to the 'runs' value specified in the replication script.
The replication index is used in each task's instance to select the input. ]]>
      </description>
      <variables>
        <variable inherited="true" model="PA:CATALOG_OBJECT" name="WORKFLOW_TO_OPTIMIZE" value="auto-ml-optimization/Himmelblau_Function"/>
      </variables>
      <genericInformation>
        <info name="task.icon" value="/automation-dashboard/styles/patterns/img/wf-icons/controls_submit_job_no_wait.png"/>
      </genericInformation>
      <depends>
        <task ref="Split"/>
      </depends>
      <scriptExecutable>
        <script>
          <code language="groovy">
            <![CDATA[
import groovy.json.JsonSlurper
import groovy.json.JsonOutput

def jsonSlurper = new JsonSlurper()

int replication = variables.get('PA_TASK_REPLICATION')
token_params_json = results[0].value()[replication]
println "token_params_json: " + token_params_json

def object = jsonSlurper.parseText(token_params_json)
token = object.token
params = object.params
println "token:  " + token
println "params: " + params

//String token_encoded = JsonOutput.toJson([token: token]).bytes.encodeBase64().toString()
//String params_encoded = JsonOutput.toJson([params: params]).bytes.encodeBase64().toString()
String token_encoded = JsonOutput.toJson(token).bytes.encodeBase64().toString()
String params_encoded = JsonOutput.toJson(params).bytes.encodeBase64().toString()
println "token_encoded:  " + token_encoded
println "params_encoded: " + params_encoded

// Check Visdom support
def VISDOM_ENABLED = false
if ("true".equalsIgnoreCase(variables.get("VISDOM_ENABLED"))) {
    VISDOM_ENABLED = true
}

// Check Tensorboard support
def TENSORBOARD_ENABLED = false
if ("true".equalsIgnoreCase(variables.get("TENSORBOARD_ENABLED"))) {
    TENSORBOARD_ENABLED = true
}

// Check if container platform should be propagated
def PROPAGATE_CONTAINER_PLATFORM = false
if ("true".equalsIgnoreCase(variables.get("PROPAGATE_CONTAINER_PLATFORM"))) {
    PROPAGATE_CONTAINER_PLATFORM = true
}

// Submit a workflow referenced in the ProActive Catalog (or accessible by url)
// Please add the bucket and workflow names that you want to execute as Task Variables 'call_workflow'
// connect to the scheduler
schedulerapi.connect()

// get the workflow information from Task Variables
def calledWorkflow = variables.get("WORKFLOW_TO_OPTIMIZE")

// variables submitted to the workflow: Empty in the example, modify this map to give parameters to the submitted workflow
//workflow_variables = Collections.EMPTY_MAP
workflow_variables = [:]
workflow_variables.put("token_encoded", token_encoded)
workflow_variables.put("params_encoded", params_encoded)

def NS = variables.get("NS")
if (NS?.trim()) { workflow_variables.put("NS", NS) }

def NS_BATCH = variables.get("NS_BATCH")
if (NS_BATCH?.trim()) { workflow_variables.put("NS_BATCH", NS_BATCH) }

def NODE_ACCESS_TOKEN = variables.get("NODE_ACCESS_TOKEN")
if (NODE_ACCESS_TOKEN?.trim()) { workflow_variables.put("NODE_ACCESS_TOKEN", NODE_ACCESS_TOKEN) }

def NODE_SOURCE_NAME = variables.get("NODE_SOURCE_NAME")
if (NODE_SOURCE_NAME?.trim()) { workflow_variables.put("NODE_SOURCE_NAME", NODE_SOURCE_NAME) }

def NATIVE_SCHEDULER = variables.get("NATIVE_SCHEDULER")
if (NATIVE_SCHEDULER?.trim()) { workflow_variables.put("NATIVE_SCHEDULER", NATIVE_SCHEDULER) }

def NATIVE_SCHEDULER_PARAMS = variables.get("NATIVE_SCHEDULER_PARAMS")
if (NATIVE_SCHEDULER_PARAMS?.trim()) { workflow_variables.put("NATIVE_SCHEDULER_PARAMS", NATIVE_SCHEDULER_PARAMS) }

// Add generated params from search space as a workflow variable
params.each {
    workflow_variables.put(it.key, it.value)
}

workflow_variables.put("TENSORBOARD_ENABLED", variables.get("TENSORBOARD_ENABLED"))
if (TENSORBOARD_ENABLED) {
    println "Adding Tensorboard support to the workflow variables"
    def HOST_LOG_PATH = variables.get("HOST_LOG_PATH")
	if (HOST_LOG_PATH?.trim()) { workflow_variables.put("HOST_LOG_PATH", HOST_LOG_PATH) }
    
    def CONTAINER_LOG_PATH = variables.get("CONTAINER_LOG_PATH")
	if (CONTAINER_LOG_PATH?.trim()) { workflow_variables.put("CONTAINER_LOG_PATH", CONTAINER_LOG_PATH) }
    
    def INSTANCE_NAME = variables.get("INSTANCE_NAME")
	if (INSTANCE_NAME?.trim()) { workflow_variables.put("INSTANCE_NAME", INSTANCE_NAME) }
    
    def CONTAINER_ROOTLESS_ENABLED = variables.get("CONTAINER_ROOTLESS_ENABLED")
	if (CONTAINER_ROOTLESS_ENABLED?.trim()) { workflow_variables.put("CONTAINER_ROOTLESS_ENABLED", CONTAINER_ROOTLESS_ENABLED) }
}

workflow_variables.put("VISDOM_ENABLED", VISDOM_ENABLED)
if (VISDOM_ENABLED) {
    println "Adding Visdom support to the workflow variables"
    def VISDOM_INSTANCE_NAME = variables.get("VISDOM_INSTANCE_NAME")
    def VISDOM_ENDPOINT = variables.get("ENDPOINT_" + VISDOM_INSTANCE_NAME)
    if (VISDOM_ENDPOINT?.trim()) { workflow_variables.put("VISDOM_ENDPOINT", VISDOM_ENDPOINT) }
}

if (PROPAGATE_CONTAINER_PLATFORM) {
    println "Propagating container platform to the workflow variables"
    def CONTAINER_PLATFORM = variables.get("CONTAINER_PLATFORM")
    if (CONTAINER_PLATFORM?.trim()) { workflow_variables.put("CONTAINER_PLATFORM", CONTAINER_PLATFORM) }
}

println "Submitting workflow " + calledWorkflow

// submitting the job
def PA_CATALOG_REST_URL = variables.get("PA_CATALOG_REST_URL")
def generic_infos_map = ["PARENT_JOB_ID" : variables.get("PA_JOB_ID")]
println "------------------------------"
println "PA_CATALOG_REST_URL:  " + PA_CATALOG_REST_URL
println "bucket_workflow_name: " + calledWorkflow
println "workflow_variables:   " + workflow_variables
println "generic_infos_map:    " + generic_infos_map
println "------------------------------"
jobid = schedulerapi.submitFromCatalog(PA_CATALOG_REST_URL, calledWorkflow, workflow_variables, generic_infos_map)

// alternatively you can submit a workflow from a direct url
// // add sessionId to request header map
// requestHeader = Collections.singletonMap("sessionId", schedulerapi.getSession()
// jobUrl = "https://try.activeeon.com/catalog/buckets/basic-examples/resources/distributed_computing_Pi/raw"
// jobid = schedulerapi.submit(jobURL, variables, generic_infos_map, requestHeader)

println "Job submitted with job id " + jobid
jobid_params = JsonOutput.toJson(params)
result = [jobid, jobid_params]
]]>
          </code>
        </script>
      </scriptExecutable>
      <metadata>
        <positionTop>
            925.3125
        </positionTop>
        <positionLeft>
            481.62109375
        </positionLeft>
      </metadata>
    </task>
    <task fork="true" name="Merge">
      <description>
        <![CDATA[ As a merge operation, we simply print the results from previous tasks. ]]>
      </description>
      <genericInformation>
        <info name="task.icon" value="/automation-dashboard/styles/patterns/img/wf-icons/controls_replicate.png"/>
      </genericInformation>
      <depends>
        <task ref="Submit_Job_No_Wait"/>
      </depends>
      <forkEnvironment javaHome="/usr">
        <envScript>
          <script>
            <file language="groovy" url="${PA_CATALOG_REST_URL}/buckets/scripts/resources/fork_env_cuda_universal/raw"/>
          </script>
        </envScript>
      </forkEnvironment>
      <scriptExecutable>
        <script>
          <code language="cpython">
            <![CDATA[
import json, os, math, shutil
import numpy as np

from io import BytesIO
from PIL import Image
from argparse import ArgumentParser
from time import sleep

# connect to the scheduler
schedulerapi.connect()

PA_JOB_ID = variables.get("PA_JOB_ID")
print('PA_JOB_ID: ', PA_JOB_ID)

# Check Visdom support
VISDOM_ENABLED = variables.get("VISDOM_ENABLED")
if VISDOM_ENABLED is not None and VISDOM_ENABLED.lower() == "true":
    VISDOM_ENABLED = True
    from visdom import Visdom
else:
    VISDOM_ENABLED = False

# Check Tensorboard support
TENSORBOARD_ENABLED = variables.get("TENSORBOARD_ENABLED")
if TENSORBOARD_ENABLED is not None and TENSORBOARD_ENABLED.lower() == "true":
    TENSORBOARD_ENABLED = True
    from tensorboardX import SummaryWriter
else:
    TENSORBOARD_ENABLED = False

writer = None
if TENSORBOARD_ENABLED:
    CONTAINER_LOG_PATH = variables.get("CONTAINER_LOG_PATH")
    assert CONTAINER_LOG_PATH is not None
    TENSORBOARD_JOB_ID = "job_ID_" + variables.get("PA_JOB_ID")
    TENSORBOARD_PATH = os.path.join(CONTAINER_LOG_PATH, TENSORBOARD_JOB_ID)
    print('TENSORBOARD_PATH: ', TENSORBOARD_PATH)
    try:
        if not os.path.exists(TENSORBOARD_PATH):
            os.makedirs(TENSORBOARD_PATH)
        
        writer = SummaryWriter(TENSORBOARD_PATH)
    except:
        print("Error while using: ", TENSORBOARD_PATH)
        print("Deactivating Tensorboard")
        TENSORBOARD_ENABLED = False
        pass

# print('received results: ', results)

parent_job_id = PA_JOB_ID

### BEGIN VISDOM ###
vis = None
if VISDOM_ENABLED:
    VISDOM_HOST = variables.get('VISDOM_HOST')
    VISDOM_PORT = variables.get('VISDOM_PORT')
    print("Connecting to %s:%s" % (VISDOM_HOST, VISDOM_PORT))
    vis = Visdom(server="http://"+VISDOM_HOST, port=int(VISDOM_PORT))
    assert vis.check_connection()
    print("OK")
    win_text_loss = variables.get('VISDOM_win_text_loss')
    win_plot_loss = variables.get('VISDOM_win_plot_loss')
    print("win_text_loss: ", win_text_loss)
    print("win_plot_loss: ", win_plot_loss)
### END VISDOM ###

results_list = []
job_id_params = {}
for r in results:
    # v = int(str(r.value()))
    job_id = int(str(r.value()[0]))
    params = json.loads(str(r.value()[1]))
    job_id_params["job_id_"+str(job_id)] = params
    results_list.append(job_id)
results_list.sort()

workflow_results = []
# for i, res in enumerate(results):
for i, job_id in enumerate(results_list):
    # job_id = str(res.getValue())
    # print(i, job_id)

    # Wait for the job termination
    is_finished = False
    while True:
        is_finished = schedulerapi.isJobFinished(str(job_id))
        print(i, "job_id: ", job_id, ", is_finished: ", is_finished)
        if is_finished:
            break
        else:
            sleep(0.5)  # 500ms

    # Get job result
    # RESULT_JSON: {"token": {"_token_id": 0}, "loss": 0.009321813276374468}
    result_map = schedulerapi.getJobResult(str(job_id)).getResultMap()
    result_json = result_map['RESULT_JSON']
    job_result = json.loads(result_json)
    print(i, "job_id: ", job_id, ", job_result: ", job_result)
    workflow_results.append(job_result)

    token = job_result['token']        # {'_chocolate_id': 0}
    loss = job_result['loss']          # 450.9434895085956
    token_id = token['_chocolate_id']  # 0

    if VISDOM_ENABLED:
        try:
            VISDOM_JOB_ID = 'job_id_' + parent_job_id
            # vis.text("{:.4f}\n".format(loss), win=win_text_loss, append=True, env=VISDOM_JOB_ID)
            vis.text("Job ID: {}, Loss: {:.4f}\n".format(job_id, loss), win=win_text_loss, append=True, env=VISDOM_JOB_ID)
            # vis.line(Y=np.array([loss]), X=np.array([token_id]), win=win_plot_loss, update='append', env=VISDOM_JOB_ID)
            vis.line(Y=np.array([loss]), X=np.array([job_id]), win=win_plot_loss, update='append', env=VISDOM_JOB_ID)
        except:
            print("Error while plotting with Visdom!")
            pass

    if TENSORBOARD_ENABLED:
        try:
            writer.add_text('Text/parent_job', 'text logged at job: ' + str(job_id), loss)
            writer.add_scalar('Loss', np.array([loss]), job_id)
            # writer.add_scalar('Loss', np.array([loss]), token_id)

            # Parallel Coordinates Plot
            params = job_id_params["job_id_"+str(job_id)]
            writer.add_hparams(params, {'PLoss': loss}, name="job_id_"+str(job_id))
        except:
            print("Error while plotting with Tensorboard!")
            pass

if TENSORBOARD_ENABLED:
    writer.close()

workflow_results = json.dumps(workflow_results)
print('workflow_results: ', workflow_results)

variables.put('workflow_results', workflow_results)
]]>
          </code>
        </script>
      </scriptExecutable>
      <controlFlow block="end"/>
      <metadata>
        <positionTop>
            1050.9375
        </positionTop>
        <positionLeft>
            481.62109375
        </positionLeft>
      </metadata>
    </task>
    <task fork="false" name="Start">
      <genericInformation>
        <info name="task.icon" value="/automation-dashboard/styles/patterns/img/wf-icons/controls_loop.png"/>
      </genericInformation>
      <depends>
        <task ref="Join_Task"/>
      </depends>
      <scriptExecutable>
        <script>
          <code language="groovy">
            <![CDATA[
PA_TASK_ITERATION = variables.get('PA_TASK_ITERATION')
println '\n\nLoop block start ' + PA_TASK_ITERATION
]]>
          </code>
        </script>
      </scriptExecutable>
      <controlFlow block="start"/>
      <metadata>
        <positionTop>
            415.3125
        </positionTop>
        <positionLeft>
            666.3671875
        </positionLeft>
      </metadata>
    </task>
    <task fork="false" name="Loop">
      <genericInformation>
        <info name="task.icon" value="/automation-dashboard/styles/patterns/img/wf-icons/controls_loop.png"/>
      </genericInformation>
      <depends>
        <task ref="Finally"/>
      </depends>
      <scriptExecutable>
        <script>
          <code language="javascript">
            <![CDATA[
print('Loop block end ' + variables.get('PA_TASK_ITERATION'))
]]>
          </code>
        </script>
      </scriptExecutable>
      <controlFlow block="end">
        <loop target="Start">
          <script>
            <code language="groovy">
              <![CDATA[
import com.google.common.base.Splitter;

MAX_ITERATIONS = variables.get('MAX_ITERATIONS') as Integer
PA_TASK_ITERATION = variables.get('PA_TASK_ITERATION') as Integer
PAUSE_AFTER_EVERY_ITERATIONS = variables.get('PAUSE_AFTER_EVERY_ITERATIONS') as Integer
println("MAX_ITERATIONS:               " + MAX_ITERATIONS)
println("PA_TASK_ITERATION:            " + PA_TASK_ITERATION)
println("PAUSE_AFTER_EVERY_ITERATIONS: " + PAUSE_AFTER_EVERY_ITERATIONS)

def pauseIsEnabled() {
    return PAUSE_AFTER_EVERY_ITERATIONS > 0 && ((PA_TASK_ITERATION + 1) % PAUSE_AFTER_EVERY_ITERATIONS == 0)
}

def waitForSignals() {
    // Read the variable SIGNALS
    signals = "Continue_Iterations,Stop_Iterations"

    // Split the value of the variable SIGNALS and transform it into a list
    Set signalsSet = new HashSet<>(Splitter.on(',').trimResults().omitEmptyStrings().splitToList(signals))

    // Send a ready notification for each signal in the set
    println("Ready for signals "+ signalsSet)
    signalsSet.each { signal ->
        signalapi.readyForSignal(signal)
    }

    // Wait until one signal among those specified is received
    println("Waiting for any signal among "+ signalsSet)
    receivedSignal = signalapi.waitForAny(signalsSet)

    // Remove ready signals
    signalapi.removeManySignals(new HashSet<>(signalsSet.collect { signal -> "ready_"+signal }))

    // Display the received signal and add it to the job result
    println("Received signal: "+ receivedSignal)
    if ("Continue_Iterations".equalsIgnoreCase(receivedSignal)) {
        return true
    } else {
        return false
    }
}

def checkForSignals() {
    // Read the variable SIGNALS_SET
    Set signalsSet = variables.get("SIGNALS_SET")

    // Check whether one signal among those specified as input is received
    println("Checking whether one signal in the set " + signalsSet + " is received")
    receivedSignal = signalapi.checkForSignals(signalsSet)

    // If a signal is received, remove ready signals and break the loop, else sleep 10 seconds then restart
    if (receivedSignal != null) {
        // Remove ready signals
        signalapi.removeManySignals(new HashSet<>(signalsSet.collect { signal -> "ready_"+signal }))

        // Print the received signal
        println("Received signal: " + receivedSignal)
        if ("Terminate_Job_And_Services".equalsIgnoreCase(receivedSignal)) {
            return false
        } else {
            return true
        }
    } else {
        return true
    }
}

// Check if loop should be true or false
if((MAX_ITERATIONS < 0) || (MAX_ITERATIONS > 0 && PA_TASK_ITERATION < (MAX_ITERATIONS - 1))) {
    loop = checkForSignals()
    if (loop && pauseIsEnabled()) {
        loop = waitForSignals()
    }
} else {
    loop = false
}

]]>
            </code>
          </script>
        </loop>
      </controlFlow>
      <metadata>
        <positionTop>
            797.8125
        </positionTop>
        <positionLeft>
            707.63671875
        </positionLeft>
      </metadata>
    </task>
    <task fork="false" name="Parse_MongoDB_Endpoint">
      <description>
        <![CDATA[ This task aims to parse PCA endpoint in order to retrieve a HOST and a PORT number to use them as an input in the data connector tasks. ]]>
      </description>
      <depends>
        <task ref="Start_MongoDB"/>
      </depends>
      <scriptExecutable>
        <script>
          <code language="groovy">
            <![CDATA[
def endpoint = new URL(results[0].toString())
variables.put("MONGODB_HOST", endpoint.getHost())
variables.put("MONGODB_PORT", endpoint.getPort())

// Wait for database sever to be up and fully running.
sleep(10000)

MONGODB_HOST = variables.get("MONGODB_HOST")
MONGODB_PORT = variables.get("MONGODB_PORT")
MONGODB_USER = variables.get("MONGODB_USER")
MONGODB_PASS = variables.get("MONGODB_PASS")

MONGODB_URL  = "mongodb://"+MONGODB_USER+":"+MONGODB_PASS+"@"+MONGODB_HOST+":"+MONGODB_PORT
variables.put("MONGODB_URL", MONGODB_URL)
]]>
          </code>
        </script>
      </scriptExecutable>
      <metadata>
        <positionTop>
            160.3125
        </positionTop>
        <positionLeft>
            196.875
        </positionLeft>
      </metadata>
    </task>
    <task fork="false" name="Start_MongoDB" onTaskError="cancelJob">
      <description>
        <![CDATA[ Start the MongoDB server as a service. ]]>
      </description>
      <variables>
        <variable inherited="false" name="SERVICE_ID" value="MongoDB"/>
        <variable inherited="false" name="INSTANCE_NAME" value="mongodb-server-${PA_JOB_ID}"/>
        <variable inherited="false" name="ENGINE" value="$CONTAINER_PLATFORM"/>
        <variable inherited="false" name="USER" value="activeeon"/>
        <variable inherited="false" model="PA:HIDDEN" name="PASSWORD" value="ENC(T11vzCF5nEz9mzCTXMOeqjTzBLOp2Axu)"/>
        <variable inherited="true" name="NATIVE_SCHEDULER" value=""/>
        <variable inherited="true" name="NATIVE_SCHEDULER_PARAMS" value=""/>
        <variable inherited="true" name="NODE_ACCESS_TOKEN" value=""/>
        <variable inherited="true" name="NODE_SOURCE_NAME" value=""/>
      </variables>
      <genericInformation>
        <info name="task.icon" value="/automation-dashboard/styles/patterns/img/wf-icons/mongodb.png"/>
        <info name="task.documentation" value="PSA/PSAUserGuide.html"/>
      </genericInformation>
      <scriptExecutable>
        <script>
          <file language="groovy" url="${PA_CATALOG_REST_URL}/buckets/service-automation/resources/Service_Start/raw">
            <arguments>
              <argument value="false"/>
              <argument value="false"/>
              <argument value="USER"/>
              <argument value="PASSWORD"/>
              <argument value="NATIVE_SCHEDULER"/>
              <argument value="NATIVE_SCHEDULER_PARAMS"/>
              <argument value="NODE_ACCESS_TOKEN"/>
              <argument value="NODE_SOURCE_NAME"/>
              <argument value="ENGINE"/>
            </arguments>
          </file>
        </script>
      </scriptExecutable>
      <controlFlow block="none"/>
      <post>
        <script>
          <code language="groovy">
            <![CDATA[
variables.put('MONGODB_USER', variables.get("USER"))
variables.put('MONGODB_PASS', variables.get("PASSWORD"))
variables.put('MONGODB_INSTANCE_NAME', variables.get("INSTANCE_NAME"))
]]>
          </code>
        </script>
      </post>
      <metadata>
        <positionTop>
            32.8125
        </positionTop>
        <positionLeft>
            196.875
        </positionLeft>
      </metadata>
    </task>
    <task fork="false" name="Join_Task">
      <description>
        <![CDATA[ The simplest task, ran by a Groovy engine. ]]>
      </description>
      <depends>
        <task ref="Parse_MongoDB_Endpoint"/>
        <task ref="Continuation1"/>
        <task ref="Continuation2"/>
      </depends>
      <scriptExecutable>
        <script>
          <code language="groovy">
            <![CDATA[
import com.google.common.base.Splitter;

if (variables.get("READY_SENT") == null){
    
    // Read the variable SIGNALS
    signals = "Terminate_Job_And_Services"

    // Split the value of the variable SIGNALS and transform it into a list
    Set signalsSet = new HashSet<>(Splitter.on(',').trimResults().omitEmptyStrings().splitToList(signals))

    // Send a ready notification for each signal in the set
    println("Ready for signals "+ signalsSet)
    signalsSet.each { 
        signal -> signalapi.readyForSignal(signal)
    }
    
    // Add a variable to avoid sending ready notifications again
    variables.put("READY_SENT", true)
    
    // Add the signals set as a variable to be used by next tasks
    variables.put("SIGNALS_SET", signalsSet)
}
]]>
          </code>
        </script>
      </scriptExecutable>
      <metadata>
        <positionTop>
            287.8125
        </positionTop>
        <positionLeft>
            666.3671875
        </positionLeft>
      </metadata>
    </task>
    <task fork="false" name="Finish_MongoDB" onTaskError="cancelJob">
      <variables>
        <variable inherited="false" name="INSTANCE_ID" value=""/>
        <variable inherited="false" name="INSTANCE_NAME" value="mongodb-server-${PA_JOB_ID}"/>
        <variable inherited="false" model="PA:LIST(Finish_MongoDB)" name="ACTION" value="Finish_MongoDB"/>
      </variables>
      <genericInformation>
        <info name="task.icon" value="/automation-dashboard/styles/patterns/img/wf-icons/mongodb.png"/>
        <info name="task.documentation" value="PSA/PSAUserGuide.html"/>
      </genericInformation>
      <depends>
        <task ref="Loop"/>
      </depends>
      <scriptExecutable>
        <script>
          <file language="groovy" url="${PA_CATALOG_REST_URL}/buckets/service-automation/resources/Service_Action/raw">
            <arguments>
              <argument value="MONGODB_INSTANCE_NAME"/>
            </arguments>
          </file>
        </script>
      </scriptExecutable>
      <controlFlow block="none"/>
      <metadata>
        <positionTop>
            925.3125
        </positionTop>
        <positionLeft>
            707.63671875
        </positionLeft>
      </metadata>
    </task>
    <task fork="false" name="Check_Algorithm_Condition">
      <genericInformation>
        <info name="task.icon" value="/automation-dashboard/styles/patterns/img/wf-icons/controls_if.png"/>
      </genericInformation>
      <depends>
        <task ref="Start"/>
      </depends>
      <scriptExecutable>
        <script>
          <code language="groovy">
            <![CDATA[
println("Checking the branch condition of the algorithm")
]]>
          </code>
        </script>
      </scriptExecutable>
      <controlFlow>
        <if continuation="Finally" else="Else" target="If_Bayes">
          <script>
            <code language="groovy">
              <![CDATA[
TUNING_ALGORITHM = variables.get('TUNING_ALGORITHM')

if(TUNING_ALGORITHM.toLowerCase().contains("bayes")){
    branch = "if";
} else {
    branch = "else";
}
]]>
            </code>
          </script>
        </if>
      </controlFlow>
      <metadata>
        <positionTop>
            542.8125
        </positionTop>
        <positionLeft>
            550.37109375
        </positionLeft>
      </metadata>
    </task>
    <task fork="false" name="If_Bayes">
      <genericInformation>
        <info name="task.icon" value="/automation-dashboard/styles/patterns/img/wf-icons/controls_if.png"/>
      </genericInformation>
      <scriptExecutable>
        <script>
          <code language="groovy">
            <![CDATA[
println("Running the If_Bayes branch")
]]>
          </code>
        </script>
      </scriptExecutable>
      <controlFlow block="start"/>
      <metadata>
        <positionTop>
            670.3125
        </positionTop>
        <positionLeft>
            304.62890625
        </positionLeft>
      </metadata>
    </task>
    <task fork="false" name="Else">
      <genericInformation>
        <info name="task.icon" value="/automation-dashboard/styles/patterns/img/wf-icons/controls_if.png"/>
      </genericInformation>
      <scriptExecutable>
        <script>
          <code language="groovy">
            <![CDATA[
println("Running the Else branch")
]]>
          </code>
        </script>
      </scriptExecutable>
      <controlFlow block="start"/>
      <metadata>
        <positionTop>
            670.3125
        </positionTop>
        <positionLeft>
            481.62109375
        </positionLeft>
      </metadata>
    </task>
    <task fork="false" name="Finally">
      <genericInformation>
        <info name="task.icon" value="/automation-dashboard/styles/patterns/img/wf-icons/controls_if.png"/>
      </genericInformation>
      <scriptExecutable>
        <script>
          <code language="groovy">
            <![CDATA[
println("Running the continuation branch [Finally task]")
]]>
          </code>
        </script>
      </scriptExecutable>
      <metadata>
        <positionTop>
            670.3125
        </positionTop>
        <positionLeft>
            619.12109375
        </positionLeft>
      </metadata>
    </task>
    <task fork="true" name="Split_and_Submit_Job_No_Wait">
      <description>
        <![CDATA[ The simplest task, ran by a Python engine. ]]>
      </description>
      <genericInformation>
        <info name="task.icon" value="/automation-dashboard/styles/patterns/img/wf-icons/controls_replicate.png"/>
      </genericInformation>
      <depends>
        <task ref="If_Bayes"/>
      </depends>
      <forkEnvironment javaHome="/usr">
        <envScript>
          <script>
            <file language="groovy" url="${PA_CATALOG_REST_URL}/buckets/scripts/resources/fork_env_cuda_universal/raw"/>
          </script>
        </envScript>
      </forkEnvironment>
      <scriptExecutable>
        <script>
          <code language="cpython">
            <![CDATA[
import os, math, json, base64, shutil
import numpy as np
import ssl
import urllib.request

from lxml import etree
from io import BytesIO
from PIL import Image
from argparse import ArgumentParser
from time import sleep

import chocolate as choco
from chocolate import uniform, quantized_uniform, log, quantized_log, choice
from chocolate import MongoDBConnection, Bayes, Grid, Random, QuasiRandom, CMAES, MOCMAES

from py4j.java_collections import SetConverter, MapConverter, ListConverter


def raiser(msg): raise Exception(msg)


# Connect to the scheduler
schedulerapi.connect()

PA_JOB_ID = variables.get("PA_JOB_ID")
print('PA_JOB_ID: ', PA_JOB_ID)

PA_TASK_ITERATION = int(variables.get('PA_TASK_ITERATION'))
print("PA_TASK_ITERATION: ", PA_TASK_ITERATION)

PA_CATALOG_REST_URL = variables.get("PA_CATALOG_REST_URL")
print('PA_CATALOG_REST_URL: ', PA_CATALOG_REST_URL)

# Check Visdom support
VISDOM_ENABLED = variables.get("VISDOM_ENABLED")
if VISDOM_ENABLED is not None and VISDOM_ENABLED.lower() == "true":
    VISDOM_ENABLED = True
    from visdom import Visdom
else:
    VISDOM_ENABLED = False

# Check Tensorboard support
TENSORBOARD_ENABLED = variables.get("TENSORBOARD_ENABLED")
if TENSORBOARD_ENABLED is not None and TENSORBOARD_ENABLED.lower() == "true":
    TENSORBOARD_ENABLED = True
    from tensorboardX import SummaryWriter
else:
    TENSORBOARD_ENABLED = False

# Check if container platform should be propagated
PROPAGATE_CONTAINER_PLATFORM = variables.get("PROPAGATE_CONTAINER_PLATFORM")
if PROPAGATE_CONTAINER_PLATFORM is not None and PROPAGATE_CONTAINER_PLATFORM.lower() == "true":
    PROPAGATE_CONTAINER_PLATFORM = True
else:
    PROPAGATE_CONTAINER_PLATFORM = False

writer = None
if TENSORBOARD_ENABLED:
    CONTAINER_LOG_PATH = variables.get("CONTAINER_LOG_PATH")
    assert CONTAINER_LOG_PATH is not None
    TENSORBOARD_JOB_ID = "job_ID_" + variables.get("PA_JOB_ID")
    TENSORBOARD_PATH = os.path.join(CONTAINER_LOG_PATH, TENSORBOARD_JOB_ID)
    print('TENSORBOARD_PATH: ', TENSORBOARD_PATH)
    try:
        if not os.path.exists(TENSORBOARD_PATH):
            os.makedirs(TENSORBOARD_PATH)
        
        writer = SummaryWriter(TENSORBOARD_PATH)
    except:
        print("Error while using: ", TENSORBOARD_PATH)
        print("Deactivating Tensorboard")
        TENSORBOARD_ENABLED = False
        pass


# Workflow to optimize
WORKFLOW_TO_OPTIMIZE = variables.get("WORKFLOW_TO_OPTIMIZE")
bucket_name, workflow_name = WORKFLOW_TO_OPTIMIZE.split('/')
print("bucket_name: ", bucket_name, ", workflow_name: ", workflow_name)

# workflow_url = PA_CATALOG_REST_URL + '/buckets/auto-ml-optimization/resources/Himmelblau_Function/raw'
workflow_url = PA_CATALOG_REST_URL + '/buckets/'+bucket_name+'/resources/'+workflow_name+'/raw'
print("workflow_url: ", workflow_url)

if workflow_url.startswith('https'):
    workflow_xml = urllib.request.urlopen(workflow_url, context=ssl._create_unverified_context()).read()
else:
    workflow_xml = urllib.request.urlopen(workflow_url).read()
# print("workflow_xml: " + str(workflow_xml))

# Define the search space
# space = "space=" + variables.get('SEARCH_SPACE')
# print('SEARCH_SPACE: ', space)
# exec(space)
workflow_root = etree.fromstring(workflow_xml)

search_space_xpath = "string(//*[@name='SEARCH_SPACE']/@value)"
search_space = str(workflow_root.xpath(search_space_xpath))

if len(str(search_space)) <= 0:
    raiser("The objective workflow do not contains a SEARCH_SPACE variable!")

search_space_model_xpath = "string(//*[@name='SEARCH_SPACE']/@model)"
search_space_model = str(workflow_root.xpath(search_space_model_xpath))

if len(str(search_space_model)) <= 0:
    raiser("The SEARCH_SPACE variable of the objective workflow do not contains a model type!")

# search key dict
def key_search(i):
    try:
        keys = list(i.keys())
    except:
         keys = []
    return keys

# get key and value dict
def key_value_get(key, value):
    aux = key.strip() + "(" + str(value) + ")"
    if key.strip() == 'uniform' or key.strip() == "quantized_uniform" or key.strip() == "log" or key.strip() == "quantized_log":
        aux = aux.replace('[', '')
        aux = aux.replace(']', '')
    return aux

# convert json to chocolate format
def json_to_choco_convert(search_space):
    cont_model = 0
    for data in search_space:
        key_list = key_search(data) 
        if not key_list:
            key, value = list(search_space[data].items())[0]
            aux = key_value_get(key, value)
            search_space[data] = eval(aux)
        else:
            for i in key_list:
                try:
                    key, value = list(data[i].items())[0]
                    aux = key_value_get(key, value)
                    search_space[cont_model][i] = eval(aux)
                except:
                    pass
            cont_model += 1
    return search_space


if search_space_model.upper() == 'PA:JSON':
    # Define the search space from a JSON string
    space = "space=" + str(search_space)
    exec(space)
    space = json_to_choco_convert(space)
    print("\nspace: ", space)

if search_space_model.upper() == 'PA:CATALOG_OBJECT':
    # Define the search space from a JSON file stored in the catalog
    search_space_bucket_name, search_space_script_name = search_space.split('/')
    print("search_space_bucket_name: ", search_space_bucket_name, ", search_space_script_name: ", search_space_script_name)
    search_space_script_url = PA_CATALOG_REST_URL + '/buckets/'+search_space_bucket_name+'/resources/'+search_space_script_name+'/raw'
    print("search_space_script_url: ", search_space_script_url)
    if search_space_script_url.startswith('https'):
        search_space_script_json = json.loads(urllib.request.urlopen(search_space_script_url, context=ssl._create_unverified_context()).read())
    else:
        search_space_script_json = json.loads(urllib.request.urlopen(search_space_script_url).read())
    print("\nsearch_space_script_json: ", search_space_script_json)
    space = json_to_choco_convert(search_space_script_json)
    print("\nspace: ", space)


# Establish a connection to a MongoDB local database
MONGODB_URL = variables.get('MONGODB_URL')
print('MONGODB_URL: ', MONGODB_URL)
conn = MongoDBConnection(MONGODB_URL)
if PA_TASK_ITERATION == 0:
    print('Cleaning database for the first iteration')
    conn.clear()  # Clear all data from the database.

TUNING_ALGORITHM = variables.get('TUNING_ALGORITHM')
assert TUNING_ALGORITHM is not None, "TUNING_ALGORITHM must be set!"
TUNING_ALGORITHM = TUNING_ALGORITHM.lower()
print('TUNING_ALGORITHM: ', TUNING_ALGORITHM)

cross_validation = int(variables.get('NUMBER_OF_REPETITIONS'))
cv = None
if cross_validation > 1:
    cv = Repeat(repetitions=cross_validation, reduce=np.mean, rep_col="_repetition_id")

# Construct the optimizer
sampler = None
if TUNING_ALGORITHM == "grid":
    sampler = Grid(conn, space, cv)
if TUNING_ALGORITHM == "random":
    sampler = Random(conn, space, cv)
if TUNING_ALGORITHM == "quasirandom":
    sampler = QuasiRandom(conn, space, cv)
if TUNING_ALGORITHM == "bayes":
    sampler = Bayes(conn, space, cv)
if TUNING_ALGORITHM == "cmaes":
    sampler = CMAES(conn, space, cv)
if TUNING_ALGORITHM == "mocmaes":
    sampler = MOCMAES(conn, space, cv)
assert sampler is not None, "TUNING_ALGORITHM must be selected!"

# Check for previous results
workflow_results = None
if PA_TASK_ITERATION > 0:
    workflow_results = variables.get('workflow_results')

# Add previous loss values to the database
if workflow_results is not None:
    previous_results = json.loads(workflow_results)
    print("Adding previous loss values to the database")
    for i, previous_result in enumerate(previous_results):
        # print(i, previous_result)
        previous_token = previous_result['token']
        previous_loss = previous_result['loss']
        print(i, 'previous_token: ', previous_token, ', previous_loss: ', previous_loss)
        # Add the loss to the database
        # sampler.update(token, loss)
        sampler.update(previous_token, previous_loss)

# Sample the next point and submit job
samples_per_iteration = int(variables.get('PARALLEL_EXECUTIONS_PER_ITERATION'))
results = []
map_converter = MapConverter()
job_id_params = {}
for i in range(samples_per_iteration):
    try:
    	token, params = sampler.next()
    	print("sample: ", i, ", token: ", token, ", params: ", params)
    except StopIteration:
        print("Stopping iteration...")
        break

    token_encoded = base64.b64encode(json.dumps(token).encode('utf-8')).decode("utf-8")
    params_encoded = base64.b64encode(json.dumps(params).encode("utf-8")).decode("utf-8")
    print("token_encoded:  ", token_encoded)
    print("params_encoded: ", params_encoded)

    # variables submitted to the workflow
    NS = variables.get("NS")
    NS_BATCH = variables.get("NS_BATCH")
    NODE_ACCESS_TOKEN = variables.get("NODE_ACCESS_TOKEN")
    NODE_SOURCE_NAME = variables.get("NODE_SOURCE_NAME")
    NATIVE_SCHEDULER = variables.get("NATIVE_SCHEDULER")
    NATIVE_SCHEDULER_PARAMS = variables.get("NATIVE_SCHEDULER_PARAMS")
    workflow_variables = {
        "token_encoded": token_encoded,
        "params_encoded": params_encoded,
        "NS": NS if NS is not None else '',
        "NS_BATCH": NS_BATCH if NS_BATCH is not None else '',
        "NODE_ACCESS_TOKEN": NODE_ACCESS_TOKEN if NODE_ACCESS_TOKEN is not None else '',
        "NODE_SOURCE_NAME": NODE_SOURCE_NAME if NODE_SOURCE_NAME is not None else '',
        "NATIVE_SCHEDULER": NATIVE_SCHEDULER if NATIVE_SCHEDULER is not None else '',
        "NATIVE_SCHEDULER_PARAMS": NATIVE_SCHEDULER_PARAMS if NATIVE_SCHEDULER_PARAMS is not None else ''
    }
    
    # Add generated params from the search space as a workflow variable
    workflow_variables.update(params)

    workflow_variables['TENSORBOARD_ENABLED'] = str(TENSORBOARD_ENABLED).lower()
    if TENSORBOARD_ENABLED:
        print("Adding Tensorboard support to the workflow variables")
        HOST_LOG_PATH = variables.get("HOST_LOG_PATH")
        CONTAINER_LOG_PATH = variables.get("CONTAINER_LOG_PATH")
        INSTANCE_NAME = variables.get("TENSORBOARD_INSTANCE_NAME")
        CONTAINER_ROOTLESS_ENABLED = variables.get("CONTAINER_ROOTLESS_ENABLED")
        workflow_variables['HOST_LOG_PATH'] = HOST_LOG_PATH if HOST_LOG_PATH is not None else ''
        workflow_variables['CONTAINER_LOG_PATH'] = CONTAINER_LOG_PATH if CONTAINER_LOG_PATH is not None else ''
        workflow_variables['INSTANCE_NAME'] = INSTANCE_NAME if INSTANCE_NAME is not None else ''
        workflow_variables['CONTAINER_ROOTLESS_ENABLED'] = CONTAINER_ROOTLESS_ENABLED if CONTAINER_ROOTLESS_ENABLED is not None else ''

    workflow_variables['VISDOM_ENABLED'] = str(VISDOM_ENABLED).lower()
    if VISDOM_ENABLED:
        print("Adding Visdom support to the workflow variables")
        VISDOM_INSTANCE_NAME = variables.get("VISDOM_INSTANCE_NAME")
        VISDOM_ENDPOINT = variables.get("ENDPOINT_" + VISDOM_INSTANCE_NAME)
        workflow_variables['VISDOM_ENDPOINT'] = VISDOM_ENDPOINT if VISDOM_ENDPOINT is not None else ''

    if PROPAGATE_CONTAINER_PLATFORM:
        print("Propagating container platform to the workflow variables")
        CONTAINER_PLATFORM = variables.get("CONTAINER_PLATFORM")
        workflow_variables['CONTAINER_PLATFORM'] = CONTAINER_PLATFORM if CONTAINER_PLATFORM is not None else ''

    workflow_variables_java_map = map_converter.convert(workflow_variables, schedulerapi._gateway_client)
    #print('workflow_variables_java_map: ', workflow_variables_java_map)
    generic_infos_map = {
        "PARENT_JOB_ID": PA_JOB_ID
    }
    generic_infos_java_map = map_converter.convert(generic_infos_map, schedulerapi._gateway_client)
    #print('generic_infos_java_map: ', generic_infos_java_map)

    print("Submitting workflow ", WORKFLOW_TO_OPTIMIZE)
    # submitting the job
    print("-"*30)
    print("PA_CATALOG_REST_URL: ", PA_CATALOG_REST_URL)
    print("bucket_name:         ", bucket_name)
    print("workflow_name:       ", workflow_name)
    print("workflow_variables:  ", workflow_variables)
    print("generic_infos_map:   ", generic_infos_map)
    print("-"*30)
    job_id = schedulerapi.submitFromCatalog(PA_CATALOG_REST_URL, bucket_name, workflow_name, workflow_variables_java_map, generic_infos_java_map).longValue()
    print("Job submitted with job id ", job_id)

    results.append(job_id)
    job_id_params["job_id_"+str(job_id)] = params
# end iterations

parent_job_id = PA_JOB_ID

### BEGIN VISDOM ###
vis = None
if VISDOM_ENABLED:
    VISDOM_HOST = variables.get('VISDOM_HOST')
    VISDOM_PORT = variables.get('VISDOM_PORT')
    print("Connecting to %s:%s" % (VISDOM_HOST, VISDOM_PORT))
    vis = Visdom(server="http://"+VISDOM_HOST, port=int(VISDOM_PORT))
    assert vis.check_connection()
    print("OK")
    win_text_loss = variables.get('VISDOM_win_text_loss')
    win_plot_loss = variables.get('VISDOM_win_plot_loss')
    print("win_text_loss: ", win_text_loss)
    print("win_plot_loss: ", win_plot_loss)
### END VISDOM ###

workflow_results = []
results.sort()
for i, res in enumerate(results):
    job_id = str(res)
    # print(i, job_id)

    # Wait for the job termination
    is_finished = False
    while True:
        is_finished = schedulerapi.isJobFinished(job_id)
        print(i, "job_id: ", job_id, ", is_finished: ", is_finished)
        if is_finished:
            break
        else:
            sleep(0.5)  # 500ms

    # Get job result
    # RESULT_JSON: {"token": {"_token_id": 0}, "loss": 0.009321813276374468}
    result_map = schedulerapi.getJobResult(job_id).getResultMap()
    result_json = result_map['RESULT_JSON']
    job_result = json.loads(result_json)
    print(i, "job_id: ", job_id, ", job_result: ", job_result)
    workflow_results.append(job_result)

    token = job_result['token']        # {'_chocolate_id': 0}
    loss = job_result['loss']          # 450.9434895085956
    token_id = token['_chocolate_id']  # 0

    if VISDOM_ENABLED:
        try:
            # vis.text("{:.4f}\n".format(loss), win=win_text_loss, append=True, env='job_id_'+parent_job_id)
            vis.text("Job ID: {}, Loss: {:.4f}\n".format(job_id, loss), win=win_text_loss, append=True, env='job_id_'+parent_job_id)
            # vis.line(Y=np.array([loss]), X=np.array([token_id]), win=win_plot_loss, update='append', env='job_id_'+parent_job_id)
            vis.line(Y=np.array([loss]), X=np.array([int(job_id)]), win=win_plot_loss, update='append', env='job_id_'+parent_job_id)
        except:
            print("Error while plotting with Visdom!")
            pass

    if TENSORBOARD_ENABLED:
        try:
            writer.add_text('Text/parent_job', 'text logged at job: ' + str(job_id), loss)
            writer.add_scalar('Loss', np.array([loss]), int(job_id))
            # writer.add_scalar('Loss', np.array([loss]), token_id)

            # Parallel Coordinates Plot
            params = job_id_params["job_id_"+str(job_id)]
            writer.add_hparams(params, {'PLoss': loss}, name="job_id_"+str(job_id))
        except:
            print("Error while plotting with Tensorboard!")
            pass

if TENSORBOARD_ENABLED:
    writer.close()

workflow_results = json.dumps(workflow_results)
print('workflow_results: ', workflow_results)

variables.put('workflow_results', workflow_results)
]]>
          </code>
        </script>
      </scriptExecutable>
      <controlFlow block="end"/>
      <metadata>
        <positionTop>
            797.8125
        </positionTop>
        <positionLeft>
            304.62890625
        </positionLeft>
      </metadata>
    </task>
    <task fork="false" name="Check_Visdom_Support">
      <genericInformation>
        <info name="task.icon" value="/automation-dashboard/styles/patterns/img/wf-icons/controls_if.png"/>
      </genericInformation>
      <scriptExecutable>
        <script>
          <code language="groovy">
            <![CDATA[
println("Checking for Visdom support")
]]>
          </code>
        </script>
      </scriptExecutable>
      <controlFlow>
        <if continuation="Continuation1" else="Nothing1" target="Start_Visdom_Service">
          <script>
            <code language="groovy">
              <![CDATA[
if ("true".equalsIgnoreCase(variables.get("VISDOM_ENABLED"))) {
    branch = "if"
} else {
    branch = "else"
}
]]>
            </code>
          </script>
        </if>
      </controlFlow>
      <metadata>
        <positionTop>
            32.8125
        </positionTop>
        <positionLeft>
            602.6171875
        </positionLeft>
      </metadata>
    </task>
    <task fork="false" name="Start_Visdom_Service">
      <description>
        <![CDATA[ Start the Visdom server as a service. ]]>
      </description>
      <variables>
        <variable inherited="false" name="SERVICE_ID" value="Visdom"/>
        <variable inherited="false" name="INSTANCE_NAME" value="$VISDOM_INSTANCE_NAME"/>
        <variable inherited="false" name="ENGINE" value="$CONTAINER_PLATFORM"/>
        <variable inherited="false" name="PROXYFIED" value="$VISDOM_PROXYFIED"/>
        <variable inherited="true" name="NATIVE_SCHEDULER" value=""/>
        <variable inherited="true" name="NATIVE_SCHEDULER_PARAMS" value=""/>
        <variable inherited="true" name="NODE_ACCESS_TOKEN" value=""/>
        <variable inherited="true" name="NODE_SOURCE_NAME" value=""/>
      </variables>
      <genericInformation>
        <info name="task.icon" value="/automation-dashboard/styles/patterns/img/wf-icons/visdom.png"/>
        <info name="task.documentation" value="PML/PMLUserGuide.html"/>
      </genericInformation>
      <scriptExecutable>
        <script>
          <file language="groovy" url="${PA_CATALOG_REST_URL}/buckets/service-automation/resources/Service_Start/raw">
            <arguments>
              <argument value="true"/>
              <argument value="false"/>
              <argument value="PROXYFIED"/>
              <argument value="VISDOM_ENABLE_LOGIN"/>
              <argument value="VISDOM_USERNAME"/>
              <argument value="VISDOM_PASSWORD"/>
              <argument value="NATIVE_SCHEDULER"/>
              <argument value="NATIVE_SCHEDULER_PARAMS"/>
              <argument value="NODE_ACCESS_TOKEN"/>
              <argument value="NODE_SOURCE_NAME"/>
              <argument value="ENGINE"/>
            </arguments>
          </file>
        </script>
      </scriptExecutable>
      <metadata>
        <positionTop>
            160.3125
        </positionTop>
        <positionLeft>
            379.375
        </positionLeft>
      </metadata>
    </task>
    <task fork="false" name="Nothing1">
      <scriptExecutable>
        <script>
          <code language="groovy">
            <![CDATA[
println("Visdom disabled")
]]>
          </code>
        </script>
      </scriptExecutable>
      <metadata>
        <positionTop>
            160.3125
        </positionTop>
        <positionLeft>
            533.8671875
        </positionLeft>
      </metadata>
    </task>
    <task fork="true" name="Continuation1">
      <forkEnvironment javaHome="/usr">
        <envScript>
          <script>
            <file language="groovy" url="${PA_CATALOG_REST_URL}/buckets/scripts/resources/fork_env_cuda_universal/raw"/>
          </script>
        </envScript>
      </forkEnvironment>
      <scriptExecutable>
        <script>
          <code language="cpython">
            <![CDATA[
# Wait for Visdom sever to be up and fully running.
import time
time.sleep(10)

VISDOM_ENABLED = variables.get('VISDOM_ENABLED')

if VISDOM_ENABLED is not None and VISDOM_ENABLED == "true":
    import numpy as np
    from visdom import Visdom
    VISDOM_INSTANCE_NAME = variables.get("VISDOM_INSTANCE_NAME")
    VISDOM_ENDPOINT = variables.get("ENDPOINT_" + VISDOM_INSTANCE_NAME)
    #VISDOM_ENDPOINT = variables.get("VISDOM_ENDPOINT") if variables.get("VISDOM_ENDPOINT") else results[0].__str__()
    print("VISDOM_ENDPOINT: ", VISDOM_ENDPOINT)

    if VISDOM_ENDPOINT is not None:
        VISDOM_ENDPOINT = VISDOM_ENDPOINT.replace("http://", "")
        print(VISDOM_ENDPOINT)

    (VISDOM_HOST, VISDOM_PORT) = VISDOM_ENDPOINT.split(":")

    variables.put('VISDOM_HOST', VISDOM_HOST)
    variables.put('VISDOM_PORT', VISDOM_PORT)
    print("VISDOM_HOST: ", VISDOM_HOST)
    print("VISDOM_PORT: ", VISDOM_PORT)
    print("Connecting to %s:%s" % (VISDOM_HOST, VISDOM_PORT))
    vis = Visdom(server="http://"+VISDOM_HOST, port=int(VISDOM_PORT))
    assert vis.check_connection()
    parent_job_id = variables.get("PA_JOB_ID")
    vis.text('A new experiment was created, please see job_id_'+parent_job_id+' environment in Visdom for more info.')
    win_text_loss = vis.text("Loss (objective to optimize):\n", env='job_id_'+parent_job_id)
    win_plot_loss = vis.line(
        Y = np.array([np.nan]),
        X = np.array([np.nan]),
        opts = dict(
              xlabel = 'Job ID',
              ylabel = 'Loss',
              title = 'Model loss',
              ),
        env='job_id_'+parent_job_id
    )
    variables.put('VISDOM_win_text_loss', win_text_loss)
    variables.put('VISDOM_win_plot_loss', win_plot_loss)
    print("win_text_loss: ", win_text_loss)
    print("win_plot_loss: ", win_plot_loss)
]]>
          </code>
        </script>
      </scriptExecutable>
      <metadata>
        <positionTop>
            160.3125
        </positionTop>
        <positionLeft>
            671.3671875
        </positionLeft>
      </metadata>
    </task>
    <task fork="false" name="Check_Tensorboard_Support">
      <genericInformation>
        <info name="task.icon" value="/automation-dashboard/styles/patterns/img/wf-icons/controls_if.png"/>
      </genericInformation>
      <scriptExecutable>
        <script>
          <code language="groovy">
            <![CDATA[
println("Checking for Tensorboard support")
]]>
          </code>
        </script>
      </scriptExecutable>
      <controlFlow>
        <if continuation="Continuation2" else="Nothing2" target="Start_Tensorboard">
          <script>
            <code language="groovy">
              <![CDATA[
if ("true".equalsIgnoreCase(variables.get("TENSORBOARD_ENABLED"))) {
    branch = "if"
} else {
    branch = "else"
}
]]>
            </code>
          </script>
        </if>
      </controlFlow>
      <metadata>
        <positionTop>
            32.8125
        </positionTop>
        <positionLeft>
            1033.125
        </positionLeft>
      </metadata>
    </task>
    <task fork="false" name="Nothing2">
      <scriptExecutable>
        <script>
          <code language="groovy">
            <![CDATA[
println("Tensorboard disabled")
]]>
          </code>
        </script>
      </scriptExecutable>
      <metadata>
        <positionTop>
            160.3125
        </positionTop>
        <positionLeft>
            964.375
        </positionLeft>
      </metadata>
    </task>
    <task fork="false" name="Continuation2">
      <scriptExecutable>
        <script>
          <code language="groovy">
            <![CDATA[
// Wait for Tensorboard sever to be up and fully running.
sleep(10000)
]]>
          </code>
        </script>
      </scriptExecutable>
      <metadata>
        <positionTop>
            160.3125
        </positionTop>
        <positionLeft>
            1101.89453125
        </positionLeft>
      </metadata>
    </task>
    <task fork="false" name="Start_Tensorboard" onTaskError="cancelJob">
      <description>
        <![CDATA[ Start the Tensorboard server as a service. ]]>
      </description>
      <variables>
        <variable inherited="false" name="SERVICE_ID" value="Tensorboard"/>
        <variable inherited="false" name="INSTANCE_NAME" value="$TENSORBOARD_INSTANCE_NAME"/>
        <variable inherited="false" name="PROXYFIED" value="$TENSORBOARD_PROXYFIED"/>
        <variable inherited="false" name="MOUNT_LOG_PATH" value="$TENSORBOARD_HOST_LOG_PATH"/>
        <variable inherited="false" name="ENGINE" value="$CONTAINER_PLATFORM"/>
        <variable inherited="false" model="PA:Boolean" name="CONTAINER_ROOTLESS_ENABLED" value="False"/>
        <variable inherited="true" name="NATIVE_SCHEDULER" value=""/>
        <variable inherited="true" name="NATIVE_SCHEDULER_PARAMS" value=""/>
        <variable inherited="true" name="NODE_ACCESS_TOKEN" value=""/>
        <variable inherited="true" name="NODE_SOURCE_NAME" value=""/>
      </variables>
      <genericInformation>
        <info name="task.icon" value="/automation-dashboard/styles/patterns/img/wf-icons/tensorboard.png"/>
        <info name="task.documentation" value="PSA/PSAUserGuide.html"/>
      </genericInformation>
      <scriptExecutable>
        <script>
          <file language="groovy" url="${PA_CATALOG_REST_URL}/buckets/service-automation/resources/Service_Start/raw">
            <arguments>
              <argument value="true"/>
              <argument value="false"/>
              <argument value="PROXYFIED"/>
              <argument value="MOUNT_LOG_PATH"/>
              <argument value="NATIVE_SCHEDULER"/>
              <argument value="NATIVE_SCHEDULER_PARAMS"/>
              <argument value="NODE_ACCESS_TOKEN"/>
              <argument value="NODE_SOURCE_NAME"/>
              <argument value="ENGINE"/>
            </arguments>
          </file>
        </script>
      </scriptExecutable>
      <controlFlow block="none"/>
      <post>
        <script>
          <code language="groovy">
            <![CDATA[
variables.put("HOST_LOG_PATH", variables.get("TENSORBOARD_HOST_LOG_PATH"))
variables.put("CONTAINER_LOG_PATH", variables.get("TENSORBOARD_CONTAINER_LOG_PATH"))
variables.put("CONTAINER_ROOTLESS_ENABLED", variables.get("CONTAINER_ROOTLESS_ENABLED"))
]]>
          </code>
        </script>
      </post>
      <metadata>
        <positionTop>
            182.5
        </positionTop>
        <positionLeft>
            752.36328125
        </positionLeft>
      </metadata>
    </task>
    <task fork="true" name="Stop_If_Tensorboard_Enabled" onTaskError="cancelJob">
      <variables>
        <variable inherited="false" model="PA:LIST(Finish_Tensorboard)" name="ACTION" value="Finish_Tensorboard"/>
        <variable inherited="false" name="INSTANCE_ID" value=""/>
        <variable inherited="false" name="INSTANCE_NAME" value="$TENSORBOARD_INSTANCE_NAME"/>
      </variables>
      <genericInformation>
        <info name="task.icon" value="/automation-dashboard/styles/patterns/img/wf-icons/tensorboard.png"/>
        <info name="task.documentation" value="PSA/PSAUserGuide.html"/>
      </genericInformation>
      <depends>
        <task ref="Loop"/>
      </depends>
      <pre>
        <script>
          <code language="groovy">
            <![CDATA[

]]>
          </code>
        </script>
      </pre>
      <scriptExecutable>
        <script>
          <code language="groovy">
            <![CDATA[
import org.ow2.proactive.pca.service.client.ApiClient
import org.ow2.proactive.pca.service.client.api.CatalogRestApi
import org.ow2.proactive.pca.service.client.api.ServiceInstanceRestApi
import org.ow2.proactive.pca.service.client.model.CloudAutomationWorkflow
import org.ow2.proactive.pca.service.client.model.ServiceDescription
import java.util.concurrent.TimeoutException

println("BEGIN " + variables.get("PA_TASK_NAME"))

// Check Tensorboard support
def TENSORBOARD_ENABLED = false
if ("true".equalsIgnoreCase(variables.get("TENSORBOARD_ENABLED"))) {
    TENSORBOARD_ENABLED = true
}

if (TENSORBOARD_ENABLED) {
    // Get schedulerapi access
    schedulerapi.connect()

    // Acquire session id
    def sessionId = schedulerapi.getSession()

    // Define PCA URL
    def pcaUrl = variables.get('PA_CLOUD_AUTOMATION_REST_URL')

    // Connect to APIs
    def apiClient = new ApiClient()
    apiClient.setBasePath(pcaUrl)
    //apiClient.setDebugging(true)
    def serviceInstanceRestApi = new ServiceInstanceRestApi(apiClient)
    def instanceName = variables.get("INSTANCE_NAME")
    def instanceId = (!variables.get("INSTANCE_ID") && instanceName)? variables.get("INSTANCE_ID_" + instanceName) : variables.get("INSTANCE_ID")
    if (!instanceId && !instanceName){
        throw new IllegalArgumentException("You have to specify an INSTANCE_NAME or an INSTANCE_ID. Empty value for both is not allowed.");
    }

    println("INSTANCE_ID: " + instanceId)

    def action = variables.get("ACTION")
    if (action.isEmpty()) {
        throw new IllegalArgumentException("You have to provide an ACTION value. Empty value is not allowed.");
    }

    def bucketName
    def isActionExists = false
    def catalogRestApi = new CatalogRestApi(apiClient)
    def actionVariables = new HashMap()

    Map<String, List<CloudAutomationWorkflow>> listExecutableActionsByInstanceId = catalogRestApi.listExecutableActionsByInstanceIdUsingGET(sessionId)
    List<CloudAutomationWorkflow> listExecutableActions = listExecutableActionsByInstanceId.get(instanceId.toString())
    for (CloudAutomationWorkflow actionIterator : listExecutableActions) {
        if (actionIterator.getName().equals(action)){
            bucketName = actionIterator.getBucket()
            //retrieve default action variables
            actionVariables = actionIterator.getVariables().collectEntries {var -> [var.getName(), var.getValue()]}
            isActionExists = true
            break
        }
    }
    if(!isActionExists){
        throw new IllegalArgumentException("The provided ACTION: " + action + " does not belong to the existing possible actions that can be applied to the current state of the service. You have to specify a valid action.")
    }

    // Retrieve and update workflow variables
    if (binding.variables["args"]){
        for (String var: args){
            actionVariables.put(var, variables.get(var))
        }
    }

    // Execute action on service
    ServiceDescription service = new ServiceDescription()
    service.setBucketName(bucketName)
    service.setWorkflowName(action)
    if( !actionVariables.isEmpty() ){
        actionVariables.each{ k, v -> service.putVariablesItem("${k}", "${v}") }
    }
    def serviceInstanceData = serviceInstanceRestApi.launchServiceInstanceActionUsingPUT(sessionId, instanceId as int, service, variables.get("PA_JOB_ID"))

    if (action.toLowerCase().contains("finish")) {
        try {
            schedulerapi.waitForJob(serviceInstanceData.getJobSubmissions().get(0).getJobId().toString(), 180000)
        } catch (TimeoutException toe) {
            println("[Warning] Timeout reached. Disable to wait until the PCA service " + instanceId + " finishes." )
        }
    }
}

println("END " + variables.get("PA_TASK_NAME"))
]]>
          </code>
        </script>
      </scriptExecutable>
      <controlFlow block="none"/>
      <metadata>
        <positionTop>
            415.3125
        </positionTop>
        <positionLeft>
            888.8671875
        </positionLeft>
      </metadata>
    </task>
    <task fork="true" name="Stop_If_Visdom_Enabled" onTaskError="cancelJob">
      <variables>
        <variable inherited="false" model="PA:LIST(Finish_Visdom)" name="ACTION" value="Finish_Visdom"/>
        <variable inherited="false" name="INSTANCE_ID" value=""/>
        <variable inherited="false" name="INSTANCE_NAME" value="$VISDOM_INSTANCE_NAME"/>
      </variables>
      <genericInformation>
        <info name="task.icon" value="/automation-dashboard/styles/patterns/img/wf-icons/visdom.png"/>
        <info name="task.documentation" value="PSA/PSAUserGuide.html"/>
      </genericInformation>
      <depends>
        <task ref="Loop"/>
      </depends>
      <pre>
        <script>
          <code language="groovy">
            <![CDATA[

]]>
          </code>
        </script>
      </pre>
      <scriptExecutable>
        <script>
          <code language="groovy">
            <![CDATA[
import org.ow2.proactive.pca.service.client.ApiClient
import org.ow2.proactive.pca.service.client.api.CatalogRestApi
import org.ow2.proactive.pca.service.client.api.ServiceInstanceRestApi
import org.ow2.proactive.pca.service.client.model.CloudAutomationWorkflow
import org.ow2.proactive.pca.service.client.model.ServiceDescription
import java.util.concurrent.TimeoutException

println("BEGIN " + variables.get("PA_TASK_NAME"))

// Check Visdom support
def VISDOM_ENABLED = false
if ("true".equalsIgnoreCase(variables.get("VISDOM_ENABLED"))) {
    VISDOM_ENABLED = true
}

if (VISDOM_ENABLED) {
    // Get schedulerapi access
    schedulerapi.connect()

    // Acquire session id
    def sessionId = schedulerapi.getSession()

    // Define PCA URL
    def pcaUrl = variables.get('PA_CLOUD_AUTOMATION_REST_URL')

    // Connect to APIs
    def apiClient = new ApiClient()
    apiClient.setBasePath(pcaUrl)
    //apiClient.setDebugging(true)
    def serviceInstanceRestApi = new ServiceInstanceRestApi(apiClient)
    def instanceName = variables.get("INSTANCE_NAME")
    def instanceId = (!variables.get("INSTANCE_ID") && instanceName)? variables.get("INSTANCE_ID_" + instanceName) : variables.get("INSTANCE_ID")
    if (!instanceId && !instanceName){
        throw new IllegalArgumentException("You have to specify an INSTANCE_NAME or an INSTANCE_ID. Empty value for both is not allowed.");
    }

    println("INSTANCE_ID: " + instanceId)

    def action = variables.get("ACTION")
    if (action.isEmpty()) {
        throw new IllegalArgumentException("You have to provide an ACTION value. Empty value is not allowed.");
    }

    def bucketName
    def isActionExists = false
    def catalogRestApi = new CatalogRestApi(apiClient)
    def actionVariables = new HashMap()

    Map<String, List<CloudAutomationWorkflow>> listExecutableActionsByInstanceId = catalogRestApi.listExecutableActionsByInstanceIdUsingGET(sessionId)
    List<CloudAutomationWorkflow> listExecutableActions = listExecutableActionsByInstanceId.get(instanceId.toString())
    for (CloudAutomationWorkflow actionIterator : listExecutableActions) {
        if (actionIterator.getName().equals(action)){
            bucketName = actionIterator.getBucket()
            //retrieve default action variables
            actionVariables = actionIterator.getVariables().collectEntries {var -> [var.getName(), var.getValue()]}
            isActionExists = true
            break
        }
    }
    if(!isActionExists){
        throw new IllegalArgumentException("The provided ACTION: " + action + " does not belong to the existing possible actions that can be applied to the current state of the service. You have to specify a valid action.")
    }

    // Retrieve and update workflow variables
    if (binding.variables["args"]){
        for (String var: args){
            actionVariables.put(var, variables.get(var))
        }
    }

    // Execute action on service
    ServiceDescription service = new ServiceDescription()
    service.setBucketName(bucketName)
    service.setWorkflowName(action)
    if( !actionVariables.isEmpty() ){
        actionVariables.each{ k, v -> service.putVariablesItem("${k}", "${v}") }
    }
    def serviceInstanceData = serviceInstanceRestApi.launchServiceInstanceActionUsingPUT(sessionId, instanceId as int, service, variables.get("PA_JOB_ID"))

    if (action.toLowerCase().contains("finish")) {
        try {
            schedulerapi.waitForJob(serviceInstanceData.getJobSubmissions().get(0).getJobId().toString(), 180000)
        } catch (TimeoutException toe) {
            println("[Warning] Timeout reached. Disable to wait until the PCA service " + instanceId + " finishes." )
        }
    }
}

println("END " + variables.get("PA_TASK_NAME"))
]]>
          </code>
        </script>
      </scriptExecutable>
      <controlFlow block="none"/>
      <metadata>
        <positionTop>
            415.3125
        </positionTop>
        <positionLeft>
            1071.3671875
        </positionLeft>
      </metadata>
    </task>
  </taskFlow>
  <metadata>
    <visualization>
      <![CDATA[ <html>
    <head>
    <link rel="stylesheet" href="/studio/styles/studio-standalone.css">
        <style>
        #workflow-designer {
            left:0 !important;
            top:0 !important;
            width:2350px;
            height:3071px;
            }
        </style>
    </head>
    <body>
    <div id="workflow-visualization-view"><div id="workflow-visualization" style="position:relative;top:-50px;left:-126.3671875px"><div class="task ui-draggable _jsPlumb_endpoint_anchor_" id="jsPlumb_1_1459" style="top: 816.25px; left: 414.863px;"><a class="task-name" data-toggle="tooltip" data-placement="right" title="This task defines some input, here strings to be processed."><img src="/automation-dashboard/styles/patterns/img/wf-icons/controls_replicate.png" width="20px">&nbsp;<span class="name">Split</span></a></div><div class="task ui-draggable _jsPlumb_endpoint_anchor_" id="jsPlumb_1_1462" style="top: 943.75px; left: 414.863px;"><a class="task-name" data-toggle="tooltip" data-placement="right" title="This task will be replicated according to the 'runs' value specified in the replication script.
The replication index is used in each task's instance to select the input."><img src="/automation-dashboard/styles/patterns/img/wf-icons/controls_submit_job_no_wait.png" width="20px">&nbsp;<span class="name">Submit_Job_No_Wait</span></a></div><div class="task block-end ui-draggable _jsPlumb_endpoint_anchor_" id="jsPlumb_1_1465" style="top: 1069.36px; left: 414.863px;"><a class="task-name" data-toggle="tooltip" data-placement="right" title="As a merge operation, we simply print the results from previous tasks."><img src="/automation-dashboard/styles/patterns/img/wf-icons/controls_replicate.png" width="20px">&nbsp;<span class="name">Merge</span></a></div><div class="task block-start ui-draggable _jsPlumb_endpoint_anchor_" id="jsPlumb_1_1468" style="top: 435.625px; left: 605.859px;"><a class="task-name" data-toggle="tooltip" data-placement="right" title="This task has no description"><img src="/automation-dashboard/styles/patterns/img/wf-icons/controls_loop.png" width="20px">&nbsp;<span class="name">Start</span></a></div><div class="task block-end ui-draggable _jsPlumb_endpoint_anchor_" id="jsPlumb_1_1471" style="top: 816.25px; left: 774.609px;"><a class="task-name" data-toggle="tooltip" data-placement="right" title="This task has no description"><img src="/automation-dashboard/styles/patterns/img/wf-icons/controls_loop.png" width="20px">&nbsp;<span class="name">Loop</span></a></div><div class="task ui-draggable _jsPlumb_endpoint_anchor_" id="jsPlumb_1_1474" style="top: 182.5px; left: 131.367px;"><a class="task-name" data-toggle="tooltip" data-placement="right" title="This task aims to parse PCA endpoint in order to retrieve a HOST and a PORT number to use them as an input in the data connector tasks."><img src="/studio/images/Groovy.png" width="20px">&nbsp;<span class="name">Parse_MongoDB_Endpoint</span></a></div><div class="task _jsPlumb_endpoint_anchor_ ui-draggable" id="jsPlumb_1_1477" style="top: 55px; left: 131.367px;"><a class="task-name" data-toggle="tooltip" data-placement="right" title="Start the MongoDB server as a service."><img src="/automation-dashboard/styles/patterns/img/wf-icons/mongodb.png" width="20px">&nbsp;<span class="name">Start_MongoDB</span></a></div><div class="task ui-draggable _jsPlumb_endpoint_anchor_" id="jsPlumb_1_1480" style="top: 308.984px; left: 605.859px;"><a class="task-name" data-toggle="tooltip" data-placement="right" title="The simplest task, ran by a Groovy engine."><img src="images/Groovy.png" width="20px">&nbsp;<span class="name">Join_Task</span></a></div><div class="task ui-draggable _jsPlumb_endpoint_anchor_" id="jsPlumb_1_1483" style="top: 943.75px; left: 610.371px; z-index: 24;"><a class="task-name" data-toggle="tooltip" data-placement="right" title="This task has no description"><img src="/automation-dashboard/styles/patterns/img/wf-icons/mongodb.png" width="20px">&nbsp;<span class="name">Finish_MongoDB</span></a></div><div class="task ui-draggable _jsPlumb_endpoint_anchor_" id="jsPlumb_1_1486" style="top: 561.25px; left: 553.984px;"><a class="task-name" data-toggle="tooltip" data-placement="right" title="This task has no description"><img src="/automation-dashboard/styles/patterns/img/wf-icons/controls_if.png" width="20px">&nbsp;<span class="name">Check_Algorithm_Condition</span></a></div><div class="task block-start ui-draggable _jsPlumb_endpoint_anchor_" id="jsPlumb_1_1489" style="top: 688.73px; left: 237.871px;"><a class="task-name" data-toggle="tooltip" data-placement="right" title="This task has no description"><img src="/automation-dashboard/styles/patterns/img/wf-icons/controls_if.png" width="20px">&nbsp;<span class="name">If_Bayes</span></a></div><div class="task block-start ui-draggable _jsPlumb_endpoint_anchor_" id="jsPlumb_1_1492" style="top: 688.73px; left: 414.863px;"><a class="task-name" data-toggle="tooltip" data-placement="right" title="This task has no description"><img src="/automation-dashboard/styles/patterns/img/wf-icons/controls_if.png" width="20px">&nbsp;<span class="name">Else</span></a></div><div class="task ui-draggable _jsPlumb_endpoint_anchor_" id="jsPlumb_1_1495" style="top: 688.73px; left: 722.734px;"><a class="task-name" data-toggle="tooltip" data-placement="right" title="This task has no description"><img src="/automation-dashboard/styles/patterns/img/wf-icons/controls_if.png" width="20px">&nbsp;<span class="name">Finally</span></a></div><div class="task block-end ui-draggable _jsPlumb_endpoint_anchor_" id="jsPlumb_1_1498" style="top: 816.23px; left: 237.871px;"><a class="task-name" data-toggle="tooltip" data-placement="right" title="The simplest task, ran by a Python engine."><img src="/automation-dashboard/styles/patterns/img/wf-icons/controls_replicate.png" width="20px">&nbsp;<span class="name">Split_and_Submit_Job_No_Wait</span></a></div><div class="task ui-draggable _jsPlumb_endpoint_anchor_" id="jsPlumb_1_1501" style="top: 55px; left: 465.625px;"><a class="task-name" data-toggle="tooltip" data-placement="right" title="This task has no description"><img src="/automation-dashboard/styles/patterns/img/wf-icons/controls_if.png" width="20px">&nbsp;<span class="name">Check_Visdom_Support</span></a></div><div class="task ui-draggable _jsPlumb_endpoint_anchor_" id="jsPlumb_1_1504" style="top: 182.5px; left: 313.867px;"><a class="task-name" data-toggle="tooltip" data-placement="right" title="Start the Visdom server as a service."><img src="/automation-dashboard/styles/patterns/img/wf-icons/visdom.png" width="20px">&nbsp;<span class="name">Start_Visdom_Service</span></a></div><div class="task ui-draggable _jsPlumb_endpoint_anchor_" id="jsPlumb_1_1507" style="top: 182.5px; left: 468.359px;"><a class="task-name" data-toggle="tooltip" data-placement="right" title="This task has no description"><img src="/studio/images/Groovy.png" width="20px">&nbsp;<span class="name">Nothing1</span></a></div><div class="task ui-draggable _jsPlumb_endpoint_anchor_" id="jsPlumb_1_1510" style="top: 182.5px; left: 605.859px;"><a class="task-name" data-toggle="tooltip" data-placement="right" title="This task has no description"><img src="/studio/images/Python.png" width="20px">&nbsp;<span class="name">Continuation1</span></a></div><div class="task ui-draggable _jsPlumb_endpoint_anchor_" id="jsPlumb_1_1513" style="top: 55px; left: 896.113px;"><a class="task-name" data-toggle="tooltip" data-placement="right" title="This task has no description"><img src="/automation-dashboard/styles/patterns/img/wf-icons/controls_if.png" width="20px">&nbsp;<span class="name">Check_Tensorboard_Support</span></a></div><div class="task ui-draggable _jsPlumb_endpoint_anchor_" id="jsPlumb_1_1516" style="top: 182.5px; left: 898.867px;"><a class="task-name" data-toggle="tooltip" data-placement="right" title="This task has no description"><img src="/studio/images/Groovy.png" width="20px">&nbsp;<span class="name">Nothing2</span></a></div><div class="task ui-draggable _jsPlumb_endpoint_anchor_" id="jsPlumb_1_1519" style="top: 182.5px; left: 1036.37px;"><a class="task-name" data-toggle="tooltip" data-placement="right" title="This task has no description"><img src="/studio/images/Groovy.png" width="20px">&nbsp;<span class="name">Continuation2</span></a></div><div class="task ui-draggable _jsPlumb_endpoint_anchor_" id="jsPlumb_1_1522" style="top: 182.5px; left: 752.363px;"><a class="task-name" data-toggle="tooltip" data-placement="right" title="Start the Tensorboard server as a service."><img src="/automation-dashboard/styles/patterns/img/wf-icons/tensorboard.png" width="20px">&nbsp;<span class="name">Start_Tensorboard</span></a></div><div class="task ui-draggable _jsPlumb_endpoint_anchor_" id="jsPlumb_1_1525" style="top: 943.75px; left: 747.363px;"><a class="task-name" data-toggle="tooltip" data-placement="right" title=""><img src="/automation-dashboard/styles/patterns/img/wf-icons/tensorboard.png" width="20px">&nbsp;<span class="name">Stop_If_Tensorboard_Enabled</span></a></div><div class="task ui-draggable _jsPlumb_endpoint_anchor_" id="jsPlumb_1_1528" style="top: 943.75px; left: 929.863px;"><a class="task-name" data-toggle="tooltip" data-placement="right" title=""><img src="/automation-dashboard/styles/patterns/img/wf-icons/visdom.png" width="20px">&nbsp;<span class="name">Stop_If_Visdom_Enabled</span></a></div><svg style="position:absolute;left:450.0235032915331px;top:728.5px" width="15.47649670846693" height="88" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector"><path d="M 0 87 C -10 37 -10 50 0 0 " transform="translate(14.97649670846693,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#666" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M-4.331249999999999,65.86284375000001 L-1.2275778407318203,44.90175553569722 L-6.970801092219563,52.1139248822649 L-14.97649670846693,47.54130662791678 L-4.331249999999999,65.86284375000001" class="" stroke="#666" fill="#666" transform="translate(14.97649670846693,0.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M-4.331249999999999,65.86284375000001 L-1.2275778407318203,44.90175553569722 L-6.970801092219563,52.1139248822649 L-14.97649670846693,47.54130662791678 L-4.331249999999999,65.86284375000001" class="" stroke="#666" fill="#666" transform="translate(14.97649670846693,0.5)"></path></svg><svg style="position:absolute;left:484.5px;top:845.5px" width="45.799999999999955" height="99" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector"><path d="M 24.799999999999955 88 C 34.799999999999955 88 -10 -10 0 0 " transform="translate(10.5,10.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#e5db3d" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M24.864965599999962,76.942366 L25.922275531898705,55.7791409218625 L20.90516765628988,63.51403772560228 L12.493947257500977,59.738938865572585 L24.864965599999962,76.942366" class="" stroke="rgba(229,219,61,0.5)" fill="rgba(229,219,61,0.5)" transform="translate(10.5,10.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M24.864965599999962,76.942366 L25.922275531898705,55.7791409218625 L20.90516765628988,63.51403772560228 L12.493947257500977,59.738938865572585 L24.864965599999962,76.942366" class="" stroke="rgba(229,219,61,0.5)" fill="rgba(229,219,61,0.5)" transform="translate(10.5,10.5)"></path></svg><div class="_jsPlumb_overlay l1 component label" id="jsPlumb_1_1539" style="position: absolute; transform: translate(-50%, -50%); left: 506.9px; top: 895.75px;">replicate</div><svg style="position:absolute;left:454.5px;top:855.5px" width="36.5" height="89" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector "><path d="M 15.5 88 C 25.5 38 -10 50 0 0 " transform="translate(10.5,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#666" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M17.008112,66.303232 L19.23307240780623,45.23074872954288 L13.796275816661353,52.67663637484854 L5.606476782654781,48.44258491288153 L17.008112,66.303232" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M17.008112,66.303232 L19.23307240780623,45.23074872954288 L13.796275816661353,52.67663637484854 L5.606476782654781,48.44258491288153 L17.008112,66.303232" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path></svg><svg style="position:absolute;left:454.5px;top:983.5px" width="36.5" height="86" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector "><path d="M 0 85 C -10 35 25.5 50 15.5 0 " transform="translate(10.5,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#666" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M-1.5573906250000007,64.02515625000001 L9.898133652916684,46.199024770678385 L1.6955846820003393,50.40832285702475 L-3.7186997400585726,42.946049463678044 L-1.5573906250000007,64.02515625000001" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M-1.5573906250000007,64.02515625000001 L9.898133652916684,46.199024770678385 L1.6955846820003393,50.40832285702475 L-3.7186997400585726,42.946049463678044 L-1.5573906250000007,64.02515625000001" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path></svg><svg style="position:absolute;left:641.0235032915331px;top:348.5px" width="15.47649670846693" height="88" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector "><path d="M 0 87 C -10 37 -10 50 0 0 " transform="translate(14.97649670846693,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#666" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M-4.331249999999999,65.86284375000001 L-1.2275778407318203,44.90175553569722 L-6.970801092219563,52.1139248822649 L-14.97649670846693,47.54130662791678 L-4.331249999999999,65.86284375000001" class="" stroke="#666" fill="#666" transform="translate(14.97649670846693,0.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M-4.331249999999999,65.86284375000001 L-1.2275778407318203,44.90175553569722 L-6.970801092219563,52.1139248822649 L-14.97649670846693,47.54130662791678 L-4.331249999999999,65.86284375000001" class="" stroke="#666" fill="#666" transform="translate(14.97649670846693,0.5)"></path></svg><svg style="position:absolute;left:762.5px;top:728.5px" width="73" height="88" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector"><path d="M 52 87 C 62 37 -10 50 0 0 " transform="translate(10.5,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#666" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M49.472,63.55200000000001 L42.710254917837176,43.47019720633014 L40.87221092030014,52.50466422232605 L31.662919140163222,52.06998628603 L49.472,63.55200000000001" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M49.472,63.55200000000001 L42.710254917837176,43.47019720633014 L40.87221092030014,52.50466422232605 L31.662919140163222,52.06998628603 L49.472,63.55200000000001" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path></svg><svg style="position:absolute;left:695.5px;top:475.5px" width="190" height="341" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector"><path d="M 0 0 C -10 50 179 290 169 340 " transform="translate(10.5,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#316b31" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M28.620968750000003,76.4534375 L44.494510346584526,90.49019913441913 L35.45613357599242,88.67147833319073 L32.2764695133938,97.32536396041155 L28.620968750000003,76.4534375" class="" stroke="#316b31" fill="#316b31" transform="translate(10.5,0.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M28.620968750000003,76.4534375 L44.494510346584526,90.49019913441913 L35.45613357599242,88.67147833319073 L32.2764695133938,97.32536396041155 L28.620968750000003,76.4534375" class="" stroke="#316b31" fill="#316b31" transform="translate(10.5,0.5)"></path></svg><div class="_jsPlumb_overlay l1 component label" id="jsPlumb_1_1557" style="position: absolute; transform: translate(-50%, -50%); left: 790px; top: 645.5px;">loop</div><svg style="position:absolute;left:173.5px;top:94.5px" width="46" height="89" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector "><path d="M 25 88 C 35 38 -10 50 0 0 " transform="translate(10.5,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#666" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M25.59935375,65.8307285 L25.249839212925558,44.64399114880849 L20.757116933078812,52.69479524008836 L12.113905953013912,49.486227965729675 L25.59935375,65.8307285" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M25.59935375,65.8307285 L25.249839212925558,44.64399114880849 L20.757116933078812,52.69479524008836 L12.113905953013912,49.486227965729675 L25.59935375,65.8307285" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path></svg><svg style="position:absolute;left:198.5px;top:222.5px" width="468" height="87" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector"><path d="M 447 86 C 457 36 -10 50 0 0 " transform="translate(10.5,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#666" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M364.15180799999996,56.24294400000001 L345.1919235499879,46.78129606519539 L350.2631462102133,54.48082207206212 L343.42980162205004,60.66995785498207 L364.15180799999996,56.24294400000001" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M364.15180799999996,56.24294400000001 L345.1919235499879,46.78129606519539 L350.2631462102133,54.48082207206212 L343.42980162205004,60.66995785498207 L364.15180799999996,56.24294400000001" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path></svg><svg style="position:absolute;left:640.9783554952701px;top:222.5px" width="15.521644504729927" height="87" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector "><path d="M 0 86 C -10 36 -10 50 0 0 " transform="translate(15.021644504729927,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#666" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M-4.331249999999999,64.94400000000002 L-1.2792764656232984,43.975321988607305 L-7.004697339623629,51.20163196089339 L-15.021644504729927,46.64876932823094 L-4.331249999999999,64.94400000000002" class="" stroke="#666" fill="#666" transform="translate(15.021644504729927,0.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M-4.331249999999999,64.94400000000002 L-1.2792764656232984,43.975321988607305 L-7.004697339623629,51.20163196089339 L-15.021644504729927,46.64876932823094 L-4.331249999999999,64.94400000000002" class="" stroke="#666" fill="#666" transform="translate(15.021644504729927,0.5)"></path></svg><svg style="position:absolute;left:645.5px;top:222.5px" width="451" height="87" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector "><path d="M 0 86 C -10 36 440 50 430 0 " transform="translate(10.5,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#666" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M79.59616000000003,56.24294400000001 L100.33947471166508,60.56901551730304 L93.47607787964793,54.41322280423537 L98.50975351590043,46.68909763765514 L79.59616000000003,56.24294400000001" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M79.59616000000003,56.24294400000001 L100.33947471166508,60.56901551730304 L93.47607787964793,54.41322280423537 L98.50975351590043,46.68909763765514 L79.59616000000003,56.24294400000001" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path></svg><svg style="position:absolute;left:656.37109375px;top:855.5px" width="179.12890625" height="88.75" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector"><path d="M 0 87.75 C -10 37.75 168.12890625 50 158.12890625 0 " transform="translate(10.5,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#666" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M21.8951416015625,59.9765625 L43.07283832819928,59.26581546019066 L34.94659343576514,54.91103143016254 L38.00730725836182,46.21436362598802 L21.8951416015625,59.9765625" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M21.8951416015625,59.9765625 L43.07283832819928,59.26581546019066 L34.94659343576514,54.91103143016254 L38.00730725836182,46.21436362598802 L21.8951416015625,59.9765625" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path></svg><svg style="position:absolute;left:623.5px;top:475.5px" width="43" height="86" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector"><path d="M 0 85 C -10 35 32 50 22 0 " transform="translate(10.5,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#666" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M-0.9521280000000011,63.55984 L12.030386226949592,46.81306943528958 L3.488674824508383,50.28281961612477 L-1.246634156925639,42.372266610781196 L-0.9521280000000011,63.55984" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M-0.9521280000000011,63.55984 L12.030386226949592,46.81306943528958 L3.488674824508383,50.28281961612477 L-1.246634156925639,42.372266610781196 L-0.9521280000000011,63.55984" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path></svg><svg style="position:absolute;left:227.5px;top:600.5px" width="337" height="89" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector"><path d="M 0 88 C -10 38 326 50 316 0 " transform="translate(10.5,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#00f" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M55.8573125,58.23743749999999 L76.80264179354393,61.44573623687142 L69.61924006883228,55.66657196671869 L74.23177626026262,47.68380866803913 L55.8573125,58.23743749999999" class="" stroke="#00f" fill="#00f" transform="translate(10.5,0.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M55.8573125,58.23743749999999 L76.80264179354393,61.44573623687142 L69.61924006883228,55.66657196671869 L74.23177626026262,47.68380866803913 L55.8573125,58.23743749999999" class="" stroke="#00f" fill="#00f" transform="translate(10.5,0.5)"></path></svg><div class="_jsPlumb_overlay l1 component label" id="jsPlumb_1_1577" style="position: absolute; transform: translate(-50%, -50%); left: 395.5px; top: 644.5px;">if</div><svg style="position:absolute;left:404.5px;top:600.5px" width="160" height="89" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector"><path d="M 0 88 C -10 38 149 50 139 0 " transform="translate(10.5,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#00f" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M18.112004749999997,60.59109050000001 L39.22734039599381,58.81835234758633 L30.89277455387912,54.87690436195274 L33.51315425794654,46.0375825437072 L18.112004749999997,60.59109050000001" class="" stroke="#00f" fill="#00f" transform="translate(10.5,0.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M18.112004749999997,60.59109050000001 L39.22734039599381,58.81835234758633 L30.89277455387912,54.87690436195274 L33.51315425794654,46.0375825437072 L18.112004749999997,60.59109050000001" class="" stroke="#00f" fill="#00f" transform="translate(10.5,0.5)"></path></svg><div class="_jsPlumb_overlay l1 component label" id="jsPlumb_1_1581" style="position: absolute; transform: translate(-50%, -50%); left: 484px; top: 644.5px;">else</div><svg style="position:absolute;left:543.5px;top:600.5px" width="190" height="89" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector "><path d="M 169 88 C 179 38 -10 50 0 0 " transform="translate(10.5,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#00f" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M144.42946225,59.788559500000005 L127.99244334436611,46.4160350750519 L131.26048076398126,55.03693592264288 L123.24081976700899,59.585016561070624 L144.42946225,59.788559500000005" class="" stroke="#00f" fill="#00f" transform="translate(10.5,0.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M144.42946225,59.788559500000005 L127.99244334436611,46.4160350750519 L131.26048076398126,55.03693592264288 L123.24081976700899,59.585016561070624 L144.42946225,59.788559500000005" class="" stroke="#00f" fill="#00f" transform="translate(10.5,0.5)"></path></svg><div class="_jsPlumb_overlay l1 component label" id="jsPlumb_1_1585" style="position: absolute; transform: translate(-50%, -50%); left: 638px; top: 644.5px;">continuation</div><svg style="position:absolute;left:277.5px;top:728.5px" width="60.5" height="88" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector "><path d="M 39.5 87 C 49.5 37 -10 50 0 0 " transform="translate(10.5,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#666" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M38.626551000000006,64.458666 L34.63832234779667,43.64775462596968 L31.597211718770815,52.35129678660899 L22.53095313440566,50.677093907198866 L38.626551000000006,64.458666" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M38.626551000000006,64.458666 L34.63832234779667,43.64775462596968 L31.597211718770815,52.35129678660899 L22.53095313440566,50.677093907198866 L38.626551000000006,64.458666" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path></svg><svg style="position:absolute;left:303.5px;top:94.5px" width="173" height="89" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector"><path d="M 0 88 C -10 38 162 50 152 0 " transform="translate(10.5,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#00f" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M20.9375,60.1875 L42.10268688205756,59.17021722339431 L33.914245244696566,54.93354122073222 L36.84872810278977,46.19347197869774 L20.9375,60.1875" class="" stroke="#00f" fill="#00f" transform="translate(10.5,0.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M20.9375,60.1875 L42.10268688205756,59.17021722339431 L33.914245244696566,54.93354122073222 L36.84872810278977,46.19347197869774 L20.9375,60.1875" class="" stroke="#00f" fill="#00f" transform="translate(10.5,0.5)"></path></svg><div class="_jsPlumb_overlay l1 component label" id="jsPlumb_1_1594" style="position: absolute; transform: translate(-50%, -50%); left: 389.5px; top: 138.5px;">if</div><svg style="position:absolute;left:455.5px;top:94.5px" width="24" height="89" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector"><path d="M 3 88 C 13 38 -10 50 0 0 " transform="translate(10.5,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#00f" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M5.571843749999999,66.78168750000002 L11.211873765446198,46.35645649947359 L4.630943452167807,52.813340903872785 L-2.7564728306810355,47.297356797305774 L5.571843749999999,66.78168750000002" class="" stroke="#00f" fill="#00f" transform="translate(10.5,0.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M5.571843749999999,66.78168750000002 L11.211873765446198,46.35645649947359 L4.630943452167807,52.813340903872785 L-2.7564728306810355,47.297356797305774 L5.571843749999999,66.78168750000002" class="" stroke="#00f" fill="#00f" transform="translate(10.5,0.5)"></path></svg><div class="_jsPlumb_overlay l1 component label" id="jsPlumb_1_1598" style="position: absolute; transform: translate(-50%, -50%); left: 467px; top: 138.5px;">else</div><svg style="position:absolute;left:455.5px;top:94.5px" width="161" height="89" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector"><path d="M 140 88 C 150 38 -10 50 0 0 " transform="translate(10.5,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#00f" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M121.7373325,60.59109050000001 L106.29872700381668,46.07732254218772 L108.94187860512932,54.909861792736145 L100.61749829655281,58.8727764370584 L121.7373325,60.59109050000001" class="" stroke="#00f" fill="#00f" transform="translate(10.5,0.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M121.7373325,60.59109050000001 L106.29872700381668,46.07732254218772 L108.94187860512932,54.909861792736145 L100.61749829655281,58.8727764370584 L121.7373325,60.59109050000001" class="" stroke="#00f" fill="#00f" transform="translate(10.5,0.5)"></path></svg><div class="_jsPlumb_overlay l1 component label" id="jsPlumb_1_1602" style="position: absolute; transform: translate(-50%, -50%); left: 535.5px; top: 138.5px;">continuation</div><svg style="position:absolute;left:742.5px;top:94.5px" width="164" height="89" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector "><path d="M 0 88 C -10 38 153 50 143 0 " transform="translate(10.5,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#00f" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M18.71465575,60.59109050000001 L39.84687053125121,59.03240565723435 L31.552671394007362,55.006705634661465 L34.26248566591268,46.19439001322698 L18.71465575,60.59109050000001" class="" stroke="#00f" fill="#00f" transform="translate(10.5,0.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M18.71465575,60.59109050000001 L39.84687053125121,59.03240565723435 L31.552671394007362,55.006705634661465 L34.26248566591268,46.19439001322698 L18.71465575,60.59109050000001" class="" stroke="#00f" fill="#00f" transform="translate(10.5,0.5)"></path></svg><div class="_jsPlumb_overlay l1 component label" id="jsPlumb_1_1608" style="position: absolute; transform: translate(-50%, -50%); left: 824px; top: 138.5px;">if</div><svg style="position:absolute;left:885.5px;top:94.5px" width="24" height="89" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector"><path d="M 3 88 C 13 38 -10 50 0 0 " transform="translate(10.5,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#00f" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M5.571843749999999,66.78168750000002 L11.211873765446198,46.35645649947359 L4.630943452167807,52.813340903872785 L-2.7564728306810355,47.297356797305774 L5.571843749999999,66.78168750000002" class="" stroke="#00f" fill="#00f" transform="translate(10.5,0.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M5.571843749999999,66.78168750000002 L11.211873765446198,46.35645649947359 L4.630943452167807,52.813340903872785 L-2.7564728306810355,47.297356797305774 L5.571843749999999,66.78168750000002" class="" stroke="#00f" fill="#00f" transform="translate(10.5,0.5)"></path></svg><div class="_jsPlumb_overlay l1 component label" id="jsPlumb_1_1612" style="position: absolute; transform: translate(-50%, -50%); left: 897px; top: 138.5px;">else</div><svg style="position:absolute;left:885.5px;top:94.5px" width="161" height="89" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector"><path d="M 140 88 C 150 38 -10 50 0 0 " transform="translate(10.5,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#00f" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M121.7373325,60.59109050000001 L106.29872700381668,46.07732254218772 L108.94187860512932,54.909861792736145 L100.61749829655281,58.8727764370584 L121.7373325,60.59109050000001" class="" stroke="#00f" fill="#00f" transform="translate(10.5,0.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M121.7373325,60.59109050000001 L106.29872700381668,46.07732254218772 L108.94187860512932,54.909861792736145 L100.61749829655281,58.8727764370584 L121.7373325,60.59109050000001" class="" stroke="#00f" fill="#00f" transform="translate(10.5,0.5)"></path></svg><div class="_jsPlumb_overlay l1 component label" id="jsPlumb_1_1616" style="position: absolute; transform: translate(-50%, -50%); left: 965.5px; top: 138.5px;">continuation</div><svg style="position:absolute;left:814.5px;top:855.5px" width="22" height="89" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector"><path d="M 1 88 C 11 38 -10 50 0 0 " transform="translate(10.5,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#666" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M3.7341562499999994,66.78168750000002 L9.900828592736769,46.50923939383077 L3.155021153255475,52.793671109542124 L-4.087187797721125,47.08837449057529 L3.7341562499999994,66.78168750000002" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M3.7341562499999994,66.78168750000002 L9.900828592736769,46.50923939383077 L3.155021153255475,52.793671109542124 L-4.087187797721125,47.08837449057529 L3.7341562499999994,66.78168750000002" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path></svg><svg style="position:absolute;left:814.5px;top:855.5px" width="193" height="89" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector"><path d="M 172 88 C 182 38 -10 50 0 0 " transform="translate(10.5,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#666" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M146.9437255,59.788559500000005 L130.43446404924654,46.505326220761624 L133.74918191965182,55.108386457655 L125.75429100690152,59.69986980110979 L146.9437255,59.788559500000005" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M146.9437255,59.788559500000005 L130.43446404924654,46.505326220761624 L133.74918191965182,55.108386457655 L125.75429100690152,59.69986980110979 L146.9437255,59.788559500000005" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path></svg><div class="_jsPlumb_endpoint source-endpoint dependency-source-endpoint connected _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 455px; top: 846px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint target-endpoint dependency-target-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 455px; top: 806px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint replicate-source-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected _jsPlumb_endpoint_full" style="position: absolute; height: 20px; width: 20px; left: 485px; top: 846px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#e5db3d" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint dependency-source-endpoint connected _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 470.5px; top: 974px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint target-endpoint replicate-target-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected _jsPlumb_endpoint_full" style="position: absolute; height: 20px; width: 20px; left: 509.8px; top: 934px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#e5db3d" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint target-endpoint dependency-target-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 470.5px; top: 934px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint dependency-source-endpoint connected _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable" style="position: absolute; height: 20px; width: 20px; left: 455px; top: 1099px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint target-endpoint dependency-target-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 455px; top: 1059px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint dependency-source-endpoint connected _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 646px; top: 466px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint target-endpoint dependency-target-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 646px; top: 426px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint target-endpoint loop-target-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected _jsPlumb_endpoint_full" style="position: absolute; height: 20px; width: 20px; left: 696px; top: 466px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#316b31" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint dependency-source-endpoint connected _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 815px; top: 846px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint target-endpoint dependency-target-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 815px; top: 806px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint loop-source-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected _jsPlumb_endpoint_full" style="position: absolute; height: 20px; width: 20px; left: 865px; top: 806px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#316b31" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint dependency-source-endpoint connected _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 199px; top: 213px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint target-endpoint dependency-target-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 199px; top: 173px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint dependency-source-endpoint connected _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 174px; top: 85px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint dependency-source-endpoint connected _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 646px; top: 339px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint target-endpoint dependency-target-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 646px; top: 299px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint dependency-source-endpoint connected _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable" style="position: absolute; height: 20px; width: 20px; left: 656.871px; top: 973.75px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint target-endpoint dependency-target-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 656.871px; top: 933.75px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint dependency-source-endpoint connected _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable" style="position: absolute; height: 20px; width: 20px; left: 624px; top: 591px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint target-endpoint dependency-target-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 624px; top: 551px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint if-source-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected _jsPlumb_endpoint_full" style="position: absolute; height: 20px; width: 20px; left: 544px; top: 591px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#00f" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint dependency-source-endpoint connected _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 278px; top: 719px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint target-endpoint if-target-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected _jsPlumb_endpoint_full" style="position: absolute; height: 20px; width: 20px; left: 228px; top: 679px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#00f" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint dependency-source-endpoint connected _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 455px; top: 719px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint target-endpoint if-target-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected _jsPlumb_endpoint_full" style="position: absolute; height: 20px; width: 20px; left: 405px; top: 679px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#00f" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint dependency-source-endpoint connected _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 763px; top: 719px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint target-endpoint if-target-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected _jsPlumb_endpoint_full" style="position: absolute; height: 20px; width: 20px; left: 713px; top: 679px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#00f" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint dependency-source-endpoint connected _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable" style="position: absolute; height: 20px; width: 20px; left: 317.5px; top: 846px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint target-endpoint dependency-target-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 317.5px; top: 806px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint dependency-source-endpoint connected _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable" style="position: absolute; height: 20px; width: 20px; left: 527.5px; top: 85px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint if-source-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected _jsPlumb_endpoint_full" style="position: absolute; height: 20px; width: 20px; left: 456px; top: 85px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#00f" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint dependency-source-endpoint connected _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable" style="position: absolute; height: 20px; width: 20px; left: 371px; top: 213px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint target-endpoint if-target-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected _jsPlumb_endpoint_full" style="position: absolute; height: 20px; width: 20px; left: 304px; top: 173px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#00f" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint dependency-source-endpoint connected _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable" style="position: absolute; height: 20px; width: 20px; left: 509px; top: 213px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint target-endpoint if-target-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected _jsPlumb_endpoint_full" style="position: absolute; height: 20px; width: 20px; left: 459px; top: 173px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#00f" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint dependency-source-endpoint connected _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 646px; top: 213px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint target-endpoint if-target-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected _jsPlumb_endpoint_full" style="position: absolute; height: 20px; width: 20px; left: 596px; top: 173px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#00f" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint dependency-source-endpoint connected _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable" style="position: absolute; height: 20px; width: 20px; left: 968.5px; top: 85px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint if-source-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected _jsPlumb_endpoint_full" style="position: absolute; height: 20px; width: 20px; left: 886px; top: 85px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#00f" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint dependency-source-endpoint connected _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable" style="position: absolute; height: 20px; width: 20px; left: 939px; top: 213px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint target-endpoint if-target-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected _jsPlumb_endpoint_full" style="position: absolute; height: 20px; width: 20px; left: 889px; top: 173px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#00f" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint dependency-source-endpoint connected _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 1076px; top: 213px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint target-endpoint if-target-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected _jsPlumb_endpoint_full" style="position: absolute; height: 20px; width: 20px; left: 1026px; top: 173px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#00f" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint dependency-source-endpoint connected _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable" style="position: absolute; height: 20px; width: 20px; left: 802px; top: 213px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint target-endpoint if-target-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected _jsPlumb_endpoint_full" style="position: absolute; height: 20px; width: 20px; left: 743px; top: 173px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#00f" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint dependency-source-endpoint connected _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable" style="position: absolute; height: 20px; width: 20px; left: 816px; top: 974px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint target-endpoint dependency-target-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 816px; top: 934px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint dependency-source-endpoint connected _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable" style="position: absolute; height: 20px; width: 20px; left: 987px; top: 974px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint target-endpoint dependency-target-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 987px; top: 934px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div></div></div>
    </body>
</html>
 ]]>
    </visualization>
  </metadata>
</job>
