<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<job xmlns="urn:proactive:jobdescriptor:3.14" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" maxNumberOfExecution="2" name="Distributed_Auto_ML" onTaskError="continueJobExecution" priority="normal" projectName="1. Automated Machine Learning" tags="DistributedAutoML,HyperParameterOptimization,AutoML,TunningAlgorithms" xsi:schemaLocation="urn:proactive:jobdescriptor:3.14 http://www.activeeon.com/public_content/schemas/proactive/jobdescriptor/3.14/schedulerjob.xsd">
  <variables>
    <variable advanced="true" description="Container platform used for executing the workflow tasks." group="Container Parameters" hidden="false" model="PA:LIST(no-container,docker,podman,singularity)" name="CONTAINER_PLATFORM" value="docker"/>
    <variable advanced="true" description="Name of the container image being used." group="Container Parameters" hidden="false" model="PA:LIST(,docker://activeeon/dlm3)" name="CONTAINER_IMAGE" value=""/>
    <variable advanced="false" description="Tuner algorithm used for hyperparameter optimization." hidden="false" model="PA:LIST(Bayes,Grid,Random,QuasiRandom,CMAES,MOCMAES)" name="TUNING_ALGORITHM" value="Random"/>
    <variable advanced="false" description="Number of maximum iterations. It should be an integer higher than zero. Set -1 for an infinite loop." hidden="false" model="PA:Integer" name="MAX_ITERATIONS" value="2"/>
    <variable advanced="false" description="Number of parallel executions per iteration. It should be an integer higher than zero." hidden="false" model="PA:Integer" name="PARALLEL_EXECUTIONS_PER_ITERATION" value="2"/>
    <variable advanced="false" description="Number of hyperparameter sampling repetitions, to ensures every experiment is repeated a given number of times. It should be an integer higher than one. Set -1 to never have repetitions." hidden="false" model="PA:Integer" name="NUMBER_OF_REPETITIONS" value="-1"/>
    <variable advanced="false" description="If higher than zero, pause the workflow after every specified number of iterations. Set to -1 not to pause." hidden="false" model="PA:Integer" name="PAUSE_AFTER_EVERY_ITERATIONS" value="-1"/>
    <variable advanced="false" description="If higher than zero, stop the workflow execution if loss is lower than the specified value. Set to -1 to disable." hidden="false" model="PA:JSON" name="STOP_IF_LOSS_IS_LOWER_THAN" value="[-1]"/>
    <variable advanced="false" description="Workflow that should be optimized. Set its path from the catalog." hidden="false" model="PA:CATALOG_OBJECT" name="TARGET_WORKFLOW" value="ai-auto-ml-optimization/Himmelblau_Function"/>
    <variable advanced="true" description="If not empty, the target workflow tasks will be run only on nodes that contains the specified token." group="Target Workflow Resource Management" hidden="false" name="TARGET_NODE_ACCESS_TOKEN" value=""/>
    <variable advanced="true" description="If not empty, the target workflow tasks will be run only on nodes belonging to the specified node source." group="Target Workflow Resource Management" hidden="false" name="TARGET_NODE_SOURCE" value=""/>
    <variable advanced="true" description="Parameters given to the native scheduler (SLURM, LSF, etc) while requesting a ProActive node used to deploy the target workflow tasks." group="Target Workflow Resource Management" hidden="false" name="TARGET_NATIVE_SCHEDULER_PARAMS" value=""/>
    <variable advanced="true" description="Container platform used for executing the target workflow tasks." group="Target Workflow Container Parameters" hidden="false" model="PA:LIST(,no-container,docker,podman,singularity)" name="TARGET_CONTAINER_PLATFORM" value=""/>
    <variable advanced="true" description="Name of the container image being used to run the target workflow tasks." group="Target Workflow Container Parameters" hidden="false" model="PA:LIST(,docker://activeeon/dlm3,docker://activeeon/cuda,docker://activeeon/cuda2,docker://activeeon/rapidsai,docker://activeeon/nvidia:rapidsai,docker://activeeon/nvidia:pytorch,docker://activeeon/nvidia:tensorflow,docker://activeeon/tensorflow:latest,docker://activeeon/tensorflow:latest-gpu,docker://activeeon/pytorch:cpu_latest,docker://activeeon/pytorch:gpu_latest)" name="TARGET_CONTAINER_IMAGE" value=""/>
    <variable advanced="true" description="If True, it will activate the use of GPU for the target workflow tasks on the selected container platform." group="Target Workflow Container Parameters" hidden="false" model="PA:LIST(,True,False)" name="TARGET_CONTAINER_GPU_ENABLED" value=""/>
    <variable advanced="true" description="If True, it will activate the use of NVIDIA RAPIDS for the target workflow tasks on the selected container platform." group="Target Workflow Container Parameters" hidden="false" model="PA:LIST(,True,False)" name="TARGET_NVIDIA_RAPIDS_ENABLED" value=""/>
    <variable advanced="false" description="If True, the Visdom service is started allowing the user to visualize the hyperparameter optimization using the Visdom web interface." hidden="false" model="PA:Boolean" name="VISDOM_ENABLED" value="False"/>
    <variable advanced="false" description="If True, requests to Visdom are sent via a proxy server." hidden="true" model="PA:Boolean" name="VISDOM_PROXYFIED" value="True"/>
    <variable advanced="false" hidden="true" model="PA:SPEL(variables['VISDOM_ENABLED'].toLowerCase() == 'true' ? showVar('VISDOM_PROXYFIED') : hideVar('VISDOM_PROXYFIED'))" name="VISDOM_ENABLED_HANDLER" value=""/>
    <variable advanced="false" description="If True, the TensorBoard service is started allowing the user to visualize the hyperparameter optimization using the TensorBoard web interface." hidden="false" model="PA:Boolean" name="TENSORBOARD_ENABLED" value="False"/>
    <variable advanced="false" description="If True, requests to TensorBoard are sent via a proxy server." hidden="true" model="PA:Boolean" name="TENSORBOARD_PROXYFIED" value="True"/>
    <variable advanced="false" hidden="true" model="PA:SPEL(variables['TENSORBOARD_ENABLED'].toLowerCase() == 'true' ? showVar('TENSORBOARD_PROXYFIED') : hideVar('TENSORBOARD_PROXYFIED'))" name="TENSORBOARD_ENABLED_HANDLER" value=""/>
  </variables>
  <description>
    <![CDATA[ Allow to use six different algorithms for hyperparameter optimization. The choice of the sampling/search strategy depends strongly on the problem tackled. ]]>
  </description>
  <genericInformation>
<info name="bucketName" value="ai-auto-ml-optimization"/>
<info name="workflow.icon" value="/automation-dashboard/styles/patterns/img/wf-icons/tuning_algorithm.png"/>
<info name="Documentation" value="PAIO/PAIOUserGuide.html#_AutoML"/>
<info name="group" value="public-objects"/>
</genericInformation>
  <taskFlow>
    <task fork="true" name="Split">
      <description>
        <![CDATA[ This task defines some input, here strings to be processed. ]]>
      </description>
      <variables>
        <variable description="If True, containers will run based on images containing libraries that are compatible with GPU." inherited="false" model="PA:Boolean" name="CONTAINER_GPU_ENABLED" value="False"/>
        <variable advanced="false" description="Workflow that should be optimized. Set its path from the catalog." hidden="false" inherited="true" model="PA:CATALOG_OBJECT" name="TARGET_WORKFLOW" value="ai-auto-ml-optimization/Himmelblau_Function"/>
      </variables>
      <genericInformation>
        <info name="task.icon" value="/automation-dashboard/styles/patterns/img/wf-icons/controls_replicate.png"/>
      </genericInformation>
      <depends>
        <task ref="Else"/>
      </depends>
      <forkEnvironment javaHome="/usr">
        <envScript>
          <script>
            <file language="groovy" url="${PA_CATALOG_REST_URL}/buckets/scripts/resources/fork_env_ai/raw"/>
          </script>
        </envScript>
      </forkEnvironment>
      <scriptExecutable>
        <script>
          <code language="cpython">
            <![CDATA[
import ssl
import json
import numpy as np

from urllib.request import Request, urlopen
from lxml import etree

import chocolate as choco
from chocolate import uniform, quantized_uniform, log, quantized_log, choice
from chocolate import MongoDBConnection, Bayes, Grid, Random, QuasiRandom, CMAES, MOCMAES, Repeat


def raiser(msg): raise Exception(msg)


PA_JOB_ID = variables.get("PA_JOB_ID")
print('PA_JOB_ID: ', PA_JOB_ID)

PA_TASK_ITERATION = int(variables.get('PA_TASK_ITERATION'))
print("PA_TASK_ITERATION: ", PA_TASK_ITERATION)

PA_CATALOG_REST_URL = variables.get("PA_CATALOG_REST_URL")
print('PA_CATALOG_REST_URL: ', PA_CATALOG_REST_URL)

# Get the workflow to optimize
TARGET_WORKFLOW = variables.get("TARGET_WORKFLOW")
bucket_name, workflow_name = TARGET_WORKFLOW.split('/')
print("bucket_name: ", bucket_name, ", workflow_name: ", workflow_name)

# Set the workflow url
workflow_url = PA_CATALOG_REST_URL + '/buckets/'+bucket_name+'/resources/'+workflow_name+'/raw'
print("workflow_url: ", workflow_url)

# Get schedulerapi access and acquire session id
schedulerapi.connect()
session_id = schedulerapi.getSession()
print("session_id: ", session_id)

# Get the workflow xml
workflow_req = Request(workflow_url)
workflow_req.add_header('sessionid', session_id)
if workflow_url.startswith('https'):
    workflow_xml = urlopen(workflow_req, context=ssl._create_unverified_context()).read()
else:
    workflow_xml = urlopen(workflow_req).read()
# print("workflow_xml: " + str(workflow_xml))

# Define the search space
# space = "space=" + variables.get('SEARCH_SPACE')
# print('SEARCH_SPACE: ', space)
# exec(space)
workflow_root = etree.fromstring(workflow_xml)

search_space_xpath = "string(//*[@name='SEARCH_SPACE']/@value)"
search_space = str(workflow_root.xpath(search_space_xpath))

if len(str(search_space)) <= 0:
    raiser("The objective workflow do not contains a SEARCH_SPACE variable!")

search_space_model_xpath = "string(//*[@name='SEARCH_SPACE']/@model)"
search_space_model = str(workflow_root.xpath(search_space_model_xpath))

if len(str(search_space_model)) <= 0:
    raiser("The SEARCH_SPACE variable of the objective workflow do not contains a model type!")

# search key dict
def key_search(i):
    try:
        keys = list(i.keys())
    except:
        keys = []
    return keys

# get key and value dict
def key_value_get(key, value):
    aux = key.strip() + "(" + str(value) + ")"
    if key.strip() == 'uniform' or key.strip() == "quantized_uniform" or key.strip() == "log" or key.strip() == "quantized_log":
        aux = aux.replace('[', '')
        aux = aux.replace(']', '')
    return aux

# convert json to chocolate format
def json_to_choco_convert(search_space):
    cont_model = 0
    for data in search_space:
        key_list = key_search(data)
        if not key_list:
            key, value = list(search_space[data].items())[0]
            aux = key_value_get(key, value)
            search_space[data] = eval(aux)
        else:
            for i in key_list:
                try:
                    key, value = list(data[i].items())[0]
                    aux = key_value_get(key, value)
                    search_space[cont_model][i] = eval(aux)
                except:
                    pass
            cont_model += 1
    return search_space

if search_space_model.upper() == 'PA:JSON':
    # Define the search space from a JSON string
    space = "space=" + str(search_space)
    exec(space)
    space = json_to_choco_convert(space)
    print("\nspace: ", space)

if search_space_model.upper() == 'PA:CATALOG_OBJECT':
    # Define the search space from a JSON file stored in the catalog
    search_space_bucket_name, search_space_script_name = search_space.split('/')
    print("search_space_bucket_name: ", search_space_bucket_name, ", search_space_script_name: ", search_space_script_name)
    search_space_script_url = PA_CATALOG_REST_URL + '/buckets/'+search_space_bucket_name+'/resources/'+search_space_script_name+'/raw'
    print("search_space_script_url: ", search_space_script_url)
    search_space_script_req = Request(search_space_script_url)
    search_space_script_req.add_header('sessionid', session_id)
    if search_space_script_url.startswith('https'):
        search_space_script_json = json.loads(urlopen(search_space_script_req, context=ssl._create_unverified_context()).read())
    else:
        search_space_script_json = json.loads(urlopen(search_space_script_req).read())
    print("\nsearch_space_script_json: ", search_space_script_json)
    space = json_to_choco_convert(search_space_script_json)
    print("\nspace: ", space)


# Establish a connection to a MongoDB local database
MONGODB_URL = variables.get('MONGODB_URL')
print('MONGODB_URL: ', MONGODB_URL)
conn = MongoDBConnection(MONGODB_URL)
if PA_TASK_ITERATION == 0:
    print('Cleaning database for the first iteration')
    conn.clear() # Clear all data from the database.

TUNING_ALGORITHM = variables.get('TUNING_ALGORITHM')
assert TUNING_ALGORITHM is not None, "TUNING_ALGORITHM must be set!"
TUNING_ALGORITHM = TUNING_ALGORITHM.lower()
print('TUNING_ALGORITHM: ', TUNING_ALGORITHM)

cross_validation = int(variables.get('NUMBER_OF_REPETITIONS'))
cv = None
if cross_validation > 1:
    cv = Repeat(repetitions=cross_validation, reduce=np.mean, rep_col="_repetition_id")

# Construct the optimizer
sampler = None
if TUNING_ALGORITHM == "grid":
    sampler = Grid(connection=conn, space=space, crossvalidation=cv)
if TUNING_ALGORITHM == "random":
    sampler = Random(connection=conn, space=space, crossvalidation=cv)
if TUNING_ALGORITHM == "quasirandom":
    sampler = QuasiRandom(connection=conn, space=space, crossvalidation=cv)
if TUNING_ALGORITHM == "bayes":
    sampler = Bayes(connection=conn, space=space, crossvalidation=cv)
if TUNING_ALGORITHM == "cmaes":
    sampler = CMAES(connection=conn, space=space, crossvalidation=cv)
if TUNING_ALGORITHM == "mocmaes":
    sampler = MOCMAES(connection=conn, space=space, crossvalidation=cv, mu=2)
assert sampler is not None, "TUNING_ALGORITHM must be selected!"

# Check for previous results
workflow_results = None
if PA_TASK_ITERATION > 0:
    workflow_results = variables.get('workflow_results')

# Add previous loss values to the database
if workflow_results is not None:
    previous_results = json.loads(workflow_results)
    print("Adding previous loss values to the database")
    for i, previous_result in enumerate(previous_results):
        # print(i, previous_result)
        previous_token = previous_result['token']
        previous_loss = previous_result['loss']
        print(i, 'previous_token: ', previous_token, ', previous_loss: ', previous_loss)
        # Add the loss to the database
        # sampler.update(token, loss)
        sampler.update(previous_token, previous_loss)

# Sample the next point
samples_per_iteration = int(variables.get('PARALLEL_EXECUTIONS_PER_ITERATION'))
result = []
try:
    for i in range(samples_per_iteration):
        token, params = sampler.next()
        token_params = {
          'token': token,
          'params': params
        }
        token_params_json = json.dumps(token_params)
        print("sample: ", i, ", token_params: ", token_params_json)
        result.append(token_params_json)
except StopIteration:
    print("Stopping iteration...")
    pass

print('result: ', result)
]]>
          </code>
        </script>
      </scriptExecutable>
      <controlFlow>
        <replicate>
          <script>
            <code language="groovy">
              <![CDATA[
runs = result.size()
println "runs: " + runs
]]>
            </code>
          </script>
        </replicate>
      </controlFlow>
      <metadata>
        <positionTop>
            742.234375
        </positionTop>
        <positionLeft>
            504.25
        </positionLeft>
      </metadata>
    </task>
    <task fork="false" name="Submit_Job_No_Wait">
      <description>
        <![CDATA[ This task will be replicated according to the 'runs' value specified in the replication script.
The replication index is used in each task's instance to select the input. ]]>
      </description>
      <variables>
        <variable advanced="false" description="Workflow that should be optimized. Set its path from the catalog." hidden="false" inherited="true" model="PA:CATALOG_OBJECT" name="TARGET_WORKFLOW" value="ai-auto-ml-optimization/Himmelblau_Function"/>
      </variables>
      <genericInformation>
        <info name="task.icon" value="/automation-dashboard/styles/patterns/img/wf-icons/controls_submit_job_no_wait.png"/>
      </genericInformation>
      <depends>
        <task ref="Split"/>
      </depends>
      <scriptExecutable>
        <script>
          <code language="groovy">
            <![CDATA[
import groovy.json.JsonSlurper
import groovy.json.JsonOutput

def jsonSlurper = new JsonSlurper()

int replication = variables.get('PA_TASK_REPLICATION')
token_params_json = results[0].value()[replication]
println "token_params_json: " + token_params_json

def object = jsonSlurper.parseText(token_params_json)
token = object.token
params = object.params
println "token:  " + token
println "params: " + params

//String token_encoded = JsonOutput.toJson([token: token]).bytes.encodeBase64().toString()
//String params_encoded = JsonOutput.toJson([params: params]).bytes.encodeBase64().toString()
String token_encoded = JsonOutput.toJson(token).bytes.encodeBase64().toString()
String params_encoded = JsonOutput.toJson(params).bytes.encodeBase64().toString()
println "token_encoded:  " + token_encoded
println "params_encoded: " + params_encoded

// Check Visdom support
def VISDOM_ENABLED = false
if ("true".equalsIgnoreCase(variables.get("VISDOM_ENABLED"))) {
    VISDOM_ENABLED = true
}

// Check Tensorboard support
def TENSORBOARD_ENABLED = false
if ("true".equalsIgnoreCase(variables.get("TENSORBOARD_ENABLED"))) {
    TENSORBOARD_ENABLED = true
}

// Submit a workflow referenced in the ProActive Catalog (or accessible by url)
// Please add the bucket and workflow names that you want to execute as Task Variables 'call_workflow'
// connect to the scheduler
schedulerapi.connect()

// Get the workflow information
def target_workflow = variables.get("TARGET_WORKFLOW")

// Variables submitted to the workflow: Empty in the example, modify this map to give parameters to the submitted workflow
// workflow_variables = Collections.EMPTY_MAP
workflow_variables = [:]
workflow_variables.put("token_encoded", token_encoded)
workflow_variables.put("params_encoded", params_encoded)

def TARGET_NODE_SOURCE = variables.get("TARGET_NODE_SOURCE")
if (TARGET_NODE_SOURCE?.trim()) { workflow_variables.put("NODE_SOURCE", TARGET_NODE_SOURCE) }

def TARGET_NATIVE_SCHEDULER_PARAMS = variables.get("TARGET_NATIVE_SCHEDULER_PARAMS")
if (TARGET_NATIVE_SCHEDULER_PARAMS?.trim()) { workflow_variables.put("NATIVE_SCHEDULER_PARAMS", TARGET_NATIVE_SCHEDULER_PARAMS) }

def TARGET_NODE_ACCESS_TOKEN = variables.get("TARGET_NODE_ACCESS_TOKEN")
if (TARGET_NODE_ACCESS_TOKEN?.trim()) { workflow_variables.put("NODE_ACCESS_TOKEN", TARGET_NODE_ACCESS_TOKEN) }

def TARGET_CONTAINER_PLATFORM = variables.get("TARGET_CONTAINER_PLATFORM")
if (TARGET_CONTAINER_PLATFORM?.trim()) { workflow_variables.put("CONTAINER_PLATFORM", TARGET_CONTAINER_PLATFORM) }

def TARGET_CONTAINER_IMAGE = variables.get("TARGET_CONTAINER_IMAGE")
if (TARGET_CONTAINER_IMAGE?.trim()) { workflow_variables.put("CONTAINER_IMAGE", TARGET_CONTAINER_IMAGE) }

def TARGET_CONTAINER_GPU_ENABLED = variables.get("TARGET_CONTAINER_GPU_ENABLED")
if (TARGET_CONTAINER_GPU_ENABLED?.trim()) { workflow_variables.put("CONTAINER_GPU_ENABLED", TARGET_CONTAINER_GPU_ENABLED) }

def TARGET_NVIDIA_RAPIDS_ENABLED = variables.get("TARGET_NVIDIA_RAPIDS_ENABLED")
if (TARGET_NVIDIA_RAPIDS_ENABLED?.trim()) { workflow_variables.put("USE_NVIDIA_RAPIDS", TARGET_NVIDIA_RAPIDS_ENABLED) }

// Add generated params from search space as a workflow variable
params.each {
    workflow_variables.put(it.key, it.value)
}

workflow_variables.put("TENSORBOARD_ENABLED", variables.get("TENSORBOARD_ENABLED"))
if (TENSORBOARD_ENABLED) {
    println "Adding Tensorboard support to the workflow variables"
    def TENSORBOARD_HOST_LOG_PATH = variables.get("TENSORBOARD_HOST_LOG_PATH")
	if (TENSORBOARD_HOST_LOG_PATH?.trim()) { workflow_variables.put("TENSORBOARD_HOST_LOG_PATH", TENSORBOARD_HOST_LOG_PATH) }

    def TENSORBOARD_CONTAINER_LOG_PATH = variables.get("TENSORBOARD_CONTAINER_LOG_PATH")
	if (TENSORBOARD_CONTAINER_LOG_PATH?.trim()) { workflow_variables.put("TENSORBOARD_CONTAINER_LOG_PATH", TENSORBOARD_CONTAINER_LOG_PATH) }

    def TENSORBOARD_INSTANCE_NAME = variables.get("TENSORBOARD_INSTANCE_NAME")
	if (TENSORBOARD_INSTANCE_NAME?.trim()) { workflow_variables.put("TENSORBOARD_INSTANCE_NAME", TENSORBOARD_INSTANCE_NAME) }

    def CONTAINER_ROOTLESS_ENABLED = variables.get("CONTAINER_ROOTLESS_ENABLED")
	if (CONTAINER_ROOTLESS_ENABLED?.trim()) { workflow_variables.put("CONTAINER_ROOTLESS_ENABLED", CONTAINER_ROOTLESS_ENABLED) }
}

workflow_variables.put("VISDOM_ENABLED", VISDOM_ENABLED)
if (VISDOM_ENABLED) {
    println "[visdom] Adding Visdom support to the workflow variables"
    def VISDOM_INSTANCE_NAME = variables.get("VISDOM_INSTANCE_NAME")
    def VISDOM_ENDPOINT = variables.get("ENDPOINT_" + VISDOM_INSTANCE_NAME)
    if (VISDOM_ENDPOINT?.trim()) { workflow_variables.put("VISDOM_ENDPOINT", VISDOM_ENDPOINT) }
}

println "Submitting workflow " + target_workflow

// submitting the job
def PA_CATALOG_REST_URL = variables.get("PA_CATALOG_REST_URL")
def generic_infos_map = ["PARENT_JOB_ID" : variables.get("PA_JOB_ID")]
println "------------------------------"
println "PA_CATALOG_REST_URL:  " + PA_CATALOG_REST_URL
println "bucket_workflow_name: " + target_workflow
println "workflow_variables:   " + workflow_variables
println "generic_infos_map:    " + generic_infos_map
println "------------------------------"
jobid = schedulerapi.submitFromCatalog(PA_CATALOG_REST_URL, target_workflow, workflow_variables, generic_infos_map)

// alternatively you can submit a workflow from a direct url
// // add sessionId to request header map
// requestHeader = Collections.singletonMap("sessionId", schedulerapi.getSession()
// jobUrl = "https://try.activeeon.com/catalog/buckets/basic-examples/resources/distributed_computing_Pi/raw"
// jobid = schedulerapi.submit(jobURL, variables, generic_infos_map, requestHeader)

println "Job submitted with job id " + jobid
jobid_params = JsonOutput.toJson(params)
result = [jobid, jobid_params]
]]>
          </code>
        </script>
      </scriptExecutable>
      <metadata>
        <positionTop>
            870.234375
        </positionTop>
        <positionLeft>
            504.25
        </positionLeft>
      </metadata>
    </task>
    <task fork="true" name="Merge">
      <description>
        <![CDATA[ As a merge operation, we simply print the results from previous tasks. ]]>
      </description>
      <variables>
        <variable description="If True, containers will run based on images containing libraries that are compatible with GPU." inherited="false" model="PA:Boolean" name="CONTAINER_GPU_ENABLED" value="False"/>
      </variables>
      <genericInformation>
        <info name="task.icon" value="/automation-dashboard/styles/patterns/img/wf-icons/controls_replicate.png"/>
      </genericInformation>
      <depends>
        <task ref="Submit_Job_No_Wait"/>
      </depends>
      <forkEnvironment javaHome="/usr">
        <envScript>
          <script>
            <file language="groovy" url="${PA_CATALOG_REST_URL}/buckets/scripts/resources/fork_env_ai/raw"/>
          </script>
        </envScript>
      </forkEnvironment>
      <scriptExecutable>
        <script>
          <code language="cpython">
            <![CDATA[
import json, os, math, shutil
import numpy as np
import ast

from io import BytesIO
from PIL import Image
from argparse import ArgumentParser
from time import sleep

# Connect to the scheduler
schedulerapi.connect()

PA_JOB_ID = variables.get("PA_JOB_ID")
print('PA_JOB_ID: ', PA_JOB_ID)

PA_TASK_ITERATION = int(variables.get("PA_TASK_ITERATION"))
print('PA_TASK_ITERATION: ', PA_TASK_ITERATION)

EARLY_STOPPING = 0
STOP_IF_LOSS_IS_LOWER_THAN = variables.get("STOP_IF_LOSS_IS_LOWER_THAN")
try:
    STOP_IF_LOSS_IS_LOWER_THAN = ast.literal_eval(STOP_IF_LOSS_IS_LOWER_THAN)
except Exception:
    STOP_IF_LOSS_IS_LOWER_THAN = [-1.0]
print('STOP_IF_LOSS_IS_LOWER_THAN: ', STOP_IF_LOSS_IS_LOWER_THAN)

# Compare two list 
def compare_loss(list_value, hope_value):
    if(list_value == hope_value):
        return True
    else:
        return False

# Create a dict from a loss list
def create_loss_dict(loss, string):
    count = 0
    lahs =[]
    for l in loss:
        count +=1
        lahs+= [(string+str(count), l)]
    lossdict = {k: v for k, v in lahs}
    return lossdict

# Check Visdom support
VISDOM_ENABLED = variables.get("VISDOM_ENABLED")
if VISDOM_ENABLED is not None and VISDOM_ENABLED.lower() == "true":
    VISDOM_ENABLED = True
    from visdom import Visdom
else:
    VISDOM_ENABLED = False

# Check Tensorboard support
TENSORBOARD_ENABLED = variables.get("TENSORBOARD_ENABLED")
if TENSORBOARD_ENABLED is not None and TENSORBOARD_ENABLED.lower() == "true":
    TENSORBOARD_ENABLED = True
    from tensorboardX import SummaryWriter
else:
    TENSORBOARD_ENABLED = False

writer = None
if TENSORBOARD_ENABLED:
    TENSORBOARD_CONTAINER_LOG_PATH = variables.get("TENSORBOARD_CONTAINER_LOG_PATH")
    assert TENSORBOARD_CONTAINER_LOG_PATH is not None
    TENSORBOARD_JOB_ID = "job_ID_" + PA_JOB_ID
    TENSORBOARD_PATH = os.path.join(TENSORBOARD_CONTAINER_LOG_PATH, TENSORBOARD_JOB_ID)
    print('TENSORBOARD_PATH: ', TENSORBOARD_PATH)
    try:
        if not os.path.exists(TENSORBOARD_PATH):
            os.makedirs(TENSORBOARD_PATH)
        writer = SummaryWriter(TENSORBOARD_PATH)
    except:
        print("Error while using: ", TENSORBOARD_PATH)
        print("Deactivating Tensorboard")
        TENSORBOARD_ENABLED = False
        pass

# print('received results: ', results)

parent_job_id = PA_JOB_ID

### BEGIN VISDOM ###
vis = None
if VISDOM_ENABLED:
    try:
        VISDOM_HOST = variables.get('VISDOM_HOST')
        VISDOM_PORT = variables.get('VISDOM_PORT')
        print("[visdom] Connecting to %s:%s" % (VISDOM_HOST, VISDOM_PORT))
        vis = Visdom(server="http://"+VISDOM_HOST, port=int(VISDOM_PORT))
        if vis.check_connection(timeout_seconds=10):
            print("[visdom] Connected to Visdom")
            win_text_loss = variables.get('VISDOM_win_text_loss')
            # win_plot_loss = variables.get('VISDOM_win_plot_loss')
            print("[visdom] [debug] win_text_loss: ", win_text_loss)
            # print("[visdom] [debug] win_plot_loss: ", win_plot_loss)
        else:
            raise Exception('[visdom] Visdom server seems to be down. TimeoutError.')
    except Exception as e:
        print("[visdom] Error while connecting to Visdom: ", e)
        print("[visdom] Deactivating Visdom")
        VISDOM_ENABLED = False
        variables.put("VISDOM_ENABLED", "False")
        pass
### END VISDOM ###

results_list = []
job_id_params = {}
for r in results:
    # v = int(str(r.value()))
    job_id = int(str(r.value()[0]))
    params = json.loads(str(r.value()[1]))
    job_id_params["job_id_"+str(job_id)] = params
    results_list.append(job_id)
results_list.sort()

workflow_results = []
# for i, res in enumerate(results):
for i, job_id in enumerate(results_list):
    job_id = str(job_id)
    # job_id = str(res.getValue())
    # print(i, job_id)

    # Wait for the job termination
    is_finished = False
    while True:
        is_finished = schedulerapi.isJobFinished(job_id)
        print(i, "job_id: ", job_id, ", is_finished: ", is_finished)
        if is_finished:
            break
        else:
            sleep(0.5)  # 500ms

    # Get job result
    # RESULT_JSON: {"token": {"_token_id": 0}, "loss": 0.009321813276374468}
    result_map = schedulerapi.getJobResult(job_id).getResultMap()
    result_json = result_map['RESULT_JSON']
    job_result = json.loads(result_json)
    print(i, "job_id: ", job_id, ", job_result: ", job_result)
    workflow_results.append(job_result)

    token = job_result['token']        # {'_chocolate_id': 0}
    loss = job_result['loss']          # 450.9434895085956
    token_id = token['_chocolate_id']  # 0

    # Convert loss float to a loss list
    if type(loss) is not list:   
        loss = [float(loss)]
    
    try:
        if -1.0 not in STOP_IF_LOSS_IS_LOWER_THAN and len(loss) == len(STOP_IF_LOSS_IS_LOWER_THAN):
            is_it_equal_loss = list(map(lambda a, b: a <= b, loss, STOP_IF_LOSS_IS_LOWER_THAN))
            hope_value =  [True] * len(loss)
            result_stop_loss = compare_loss(is_it_equal_loss, hope_value)
            if result_stop_loss:
                EARLY_STOPPING = 1  
    except:
        print("Error while checking the early stopping mechanism!")
        pass

    if VISDOM_ENABLED:
        try:
            VISDOM_JOB_ID = 'job_id_' + parent_job_id
            vis.text("Job ID: {}, Loss: {}\n".format(job_id, loss), win=win_text_loss, append=True, env=VISDOM_JOB_ID)
            job_ids = [int(job_id)] * len(loss)
            print(job_ids, loss)
            if PA_TASK_ITERATION == 0 and i == 0:
                win_plot_loss = vis.line(
                    Y=np.column_stack(tuple(loss)),
                    X=np.column_stack(tuple(job_ids)),
                    opts = dict(
                        xlabel = 'Job ID',
                        ylabel = 'Loss',
                        title = 'Model loss',
                        markers = True
                        ),
                    env=VISDOM_JOB_ID,
                )
                variables.put('VISDOM_win_plot_loss', win_plot_loss)
                print("[visdom] [debug] win_plot_loss: ", win_plot_loss)
            else:
                win_plot_loss = variables.get('VISDOM_win_plot_loss') if PA_TASK_ITERATION > 0 else win_plot_loss
                print("[visdom] [debug] win_plot_loss: ", win_plot_loss)
                vis.line(
                    Y=np.column_stack(tuple(loss)),
                    X=np.column_stack(tuple(job_ids)),
                    win=win_plot_loss, 
                    update='append', 
                    env=VISDOM_JOB_ID
                )
        except:
            print("[visdom] Error while plotting with Visdom!")
            pass
    
    if TENSORBOARD_ENABLED:
        try:
            lossDict = create_loss_dict(loss, 'Loss_')
            writer.add_scalars('Loss', lossDict, int(job_id)) 
            
            # Parallel Coordinates Plot
            plossDict = create_loss_dict(loss, 'hparam/PLoss_')
            params = job_id_params["job_id_" + job_id]
            writer.add_hparams(params, plossDict, name="job_id_" + job_id)
        except:
            print("Error while plotting with Tensorboard!")
            pass

if TENSORBOARD_ENABLED:
    writer.close()

workflow_results = json.dumps(workflow_results)
print('workflow_results: ', workflow_results)

variables.put('workflow_results', workflow_results)
variables.put('EARLY_STOPPING', str(EARLY_STOPPING))
]]>
          </code>
        </script>
      </scriptExecutable>
      <controlFlow block="end"/>
      <metadata>
        <positionTop>
            998.234375
        </positionTop>
        <positionLeft>
            504.25
        </positionLeft>
      </metadata>
    </task>
    <task fork="false" name="Start">
      <genericInformation>
        <info name="task.icon" value="/automation-dashboard/styles/patterns/img/wf-icons/controls_loop.png"/>
      </genericInformation>
      <depends>
        <task ref="Join_Task"/>
      </depends>
      <scriptExecutable>
        <script>
          <code language="groovy">
            <![CDATA[
PA_TASK_ITERATION = variables.get('PA_TASK_ITERATION')
println '\n\nLoop block start ' + PA_TASK_ITERATION
]]>
          </code>
        </script>
      </scriptExecutable>
      <controlFlow block="start"/>
      <metadata>
        <positionTop>
            360.234375
        </positionTop>
        <positionLeft>
            611
        </positionLeft>
      </metadata>
    </task>
    <task fork="false" name="Loop">
      <genericInformation>
        <info name="task.icon" value="/automation-dashboard/styles/patterns/img/wf-icons/controls_loop.png"/>
      </genericInformation>
      <depends>
        <task ref="Finally"/>
      </depends>
      <scriptExecutable>
        <script>
          <code language="javascript">
            <![CDATA[
print('Loop block end ' + variables.get('PA_TASK_ITERATION'))
]]>
          </code>
        </script>
      </scriptExecutable>
      <controlFlow block="end">
        <loop target="Start">
          <script>
            <code language="groovy">
              <![CDATA[
import com.google.common.base.Splitter;

MAX_ITERATIONS = variables.get('MAX_ITERATIONS') as Integer
PA_TASK_ITERATION = variables.get('PA_TASK_ITERATION') as Integer
PAUSE_AFTER_EVERY_ITERATIONS = variables.get('PAUSE_AFTER_EVERY_ITERATIONS') as Integer
EARLY_STOPPING = variables.get('EARLY_STOPPING') as Integer
println("MAX_ITERATIONS:               " + MAX_ITERATIONS)
println("PA_TASK_ITERATION:            " + PA_TASK_ITERATION)
println("PAUSE_AFTER_EVERY_ITERATIONS: " + PAUSE_AFTER_EVERY_ITERATIONS)
println("EARLY_STOPPING:               " + EARLY_STOPPING)

def pauseIsEnabled() {
    return PAUSE_AFTER_EVERY_ITERATIONS > 0 && ((PA_TASK_ITERATION + 1) % PAUSE_AFTER_EVERY_ITERATIONS == 0)
}

def waitForSignals() {
    // Read the variable SIGNALS
    signals = "Continue_Optimization,Stop_Optimization"
    signals2remove = "Continue_Optimization"

    // Split the value of the variable SIGNALS and transform it into a list
    Set signalsSet = new HashSet<>(Splitter.on(',').trimResults().omitEmptyStrings().splitToList(signals))
    Set signalsSet2remove = new HashSet<>(Splitter.on(',').trimResults().omitEmptyStrings().splitToList(signals2remove))

    // Send a ready notification for each signal in the set
    println("[signal] Ready for signals "+ signalsSet)
    signalsSet.each { signal ->
        signalapi.readyForSignal(signal)
    }

    // Wait until one signal among those specified is received
    println("[signal] Waiting for any signal among "+ signalsSet)
    receivedSignal = signalapi.waitForAny(signalsSet)

    // Remove ready signals
    // signalapi.removeManySignals(new HashSet<>(signalsSet.collect { signal -> "ready_"+signal }))
    signalapi.removeManySignals(new HashSet<>(signalsSet2remove.collect { signal -> "ready_"+signal }))

    // Display the received signal and add it to the job result
    println("[signal] Received signal: "+ receivedSignal.getName())
    if ("Continue_Optimization".equalsIgnoreCase(receivedSignal.getName())) {
        println("[signal] Received signal to continue the workflow optimization!")
        return true
    } else {
        println("[signal] Received signal to stop the workflow optimization!")
        return false
    }
}

public static boolean containsIgnoreCase(String str, String searchStr) {
    if (str == null || searchStr == null) return false;
    final int length = searchStr.length();
    if (length == 0)
        return true;
    for (int i = str.length() - length; i >= 0; i--) {
        if (str.regionMatches(true, i, searchStr, 0, length))
            return true;
    }
    return false;
}

def checkForSignals() {
    // Read the variable SIGNALS_SET
    Set signalsSet = variables.get("SIGNALS_SET")

    // Check whether one signal among those specified as input is received
    println("[signal] Checking whether one signal in the set " + signalsSet + " is received")
    receivedSignals = signalapi.checkForSignals(signalsSet)

    // If a signal is received, remove ready signals and break the loop, else sleep 10 seconds then restart
    if (receivedSignals != null && !receivedSignals.isEmpty()) {
        // Remove ready signals
        signalapi.removeManySignals(new HashSet<>(signalsSet.collect { signal -> "ready_"+signal }))

        // Print the received signal
        println("[signal] Received signals: " + receivedSignals.toString())
        for (String s : Arrays.asList(receivedSignals.keySet())) {
            if (containsIgnoreCase(s, "Stop_Optimization")) {
                println("[signal] Received signal to stop the workflow optimization!")
                return false
            }
        }
        return true
    } else {
        return true
    }
}

// Check if loop should be true or false
println("[signal] Checking the loop condition...")
if((MAX_ITERATIONS < 0) || (MAX_ITERATIONS > 0 && PA_TASK_ITERATION < (MAX_ITERATIONS - 1))) {
    loop = checkForSignals()
    if (loop && pauseIsEnabled()) {
        loop = waitForSignals()
    }
} else {
    loop = false
}

if (EARLY_STOPPING) {
    println("[signal] Early stopping mechanism reached!")
    loop = false
}

if (loop) {
    println("[signal] Continuing the workflow optimization...")
} else {
    println("[signal] Stopping the workflow optimization!")
}
]]>
            </code>
          </script>
        </loop>
      </controlFlow>
      <metadata>
        <positionTop>
            742.234375
        </positionTop>
        <positionLeft>
            777.5
        </positionLeft>
      </metadata>
    </task>
    <task fork="false" name="Parse_MongoDB_Endpoint">
      <description>
        <![CDATA[ This task aims to parse PCA endpoint in order to retrieve a HOST and a PORT number to use them as an input in the data connector tasks. ]]>
      </description>
      <depends>
        <task ref="Start_MongoDB"/>
      </depends>
      <scriptExecutable>
        <script>
          <code language="groovy">
            <![CDATA[
def endpoint = new URI(results[0].toString())
variables.put("MONGODB_HOST", endpoint.getHost())
variables.put("MONGODB_PORT", endpoint.getPort())

// Wait for database sever to be up and fully running.
sleep(10000)

MONGODB_HOST = variables.get("MONGODB_HOST")
MONGODB_PORT = variables.get("MONGODB_PORT")
MONGODB_USER = variables.get("MONGODB_USER")
MONGODB_PASS = variables.get("MONGODB_PASS")

MONGODB_URL  = "mongodb://"+MONGODB_USER+":"+MONGODB_PASS+"@"+MONGODB_HOST+":"+MONGODB_PORT
variables.put("MONGODB_URL", MONGODB_URL)
]]>
          </code>
        </script>
      </scriptExecutable>
      <metadata>
        <positionTop>
            106.234375
        </positionTop>
        <positionLeft>
            165
        </positionLeft>
      </metadata>
    </task>
    <task fork="false" name="Start_MongoDB" onTaskError="cancelJob">
      <description>
        <![CDATA[ Start the MongoDB server as a service. ]]>
      </description>
      <variables>
        <variable advanced="false" description="The MongoDB service activation workflow. Please keep the default value for this variable." hidden="false" inherited="false" model="PA:CATALOG_OBJECT(Workflow/psa,,,MongoDB%)" name="SERVICE_ACTIVATION_WORKFLOW" value="service-automation/MongoDB"/>
        <variable description="Instance name of the server to be used." inherited="false" name="INSTANCE_NAME" value="mongodb-server-${PA_JOB_ID}"/>
        <variable description="Container platform used for executing the workflow tasks." inherited="false" name="ENGINE" value="$CONTAINER_PLATFORM"/>
        <variable description="Database user name" inherited="false" name="USER" value="activeeon"/>
        <variable description="User password needed to access the MongoDB service" inherited="false" model="PA:HIDDEN" name="PASSWORD" value="ENC(T11vzCF5nEz9mzCTXMOeqjTzBLOp2Axu)"/>
      </variables>
      <genericInformation>
        <info name="task.icon" value="/automation-dashboard/styles/patterns/img/wf-icons/mongodb.png"/>
        <info name="task.documentation" value="PSA/PSAUserGuide.html"/>
      </genericInformation>
      <scriptExecutable>
        <script>
          <file language="groovy" url="${PA_CATALOG_REST_URL}/buckets/service-automation/resources/Service_Start/raw">
            <arguments>
              <argument value="false"/>
              <argument value="false"/>
              <argument value="USER"/>
              <argument value="PASSWORD"/>
              <argument value="NODE_SOURCE"/>
              <argument value="NATIVE_SCHEDULER_PARAMS"/>
              <argument value="NODE_ACCESS_TOKEN"/>
              <argument value="ENGINE"/>
            </arguments>
          </file>
        </script>
      </scriptExecutable>
      <controlFlow block="none"/>
      <post>
        <script>
          <code language="groovy">
            <![CDATA[
variables.put('MONGODB_USER', variables.get("USER"))
variables.put('MONGODB_PASS', variables.get("PASSWORD"))
variables.put('MONGODB_INSTANCE_NAME', variables.get("INSTANCE_NAME"))
]]>
          </code>
        </script>
      </post>
      <metadata>
        <positionTop>
            -21.765625
        </positionTop>
        <positionLeft>
            165
        </positionLeft>
      </metadata>
    </task>
    <task fork="false" name="Join_Task">
      <description>
        <![CDATA[ The simplest task, ran by a Groovy engine. ]]>
      </description>
      <depends>
        <task ref="Parse_MongoDB_Endpoint"/>
        <task ref="Continuation1"/>
        <task ref="Continuation2"/>
      </depends>
      <scriptExecutable>
        <script>
          <code language="groovy">
            <![CDATA[
import com.google.common.base.Splitter;

if (variables.get("READY_SENT") == null) {
    // Read the variable SIGNALS
    signals = "Stop_Optimization"

    // Split the value of the variable SIGNALS and transform it into a list
    Set signalsSet = new HashSet<>(Splitter.on(',').trimResults().omitEmptyStrings().splitToList(signals))

    // Send a ready notification for each signal in the set
    println("[signal] Ready for signals "+ signalsSet)
    signalsSet.each {
        signal -> signalapi.readyForSignal(signal)
    }

    // Add a variable to avoid sending ready notifications again
    variables.put("READY_SENT", true)

    // Add the signals set as a variable to be used by next tasks
    variables.put("SIGNALS_SET", signalsSet)
}
]]>
          </code>
        </script>
      </scriptExecutable>
      <metadata>
        <positionTop>
            234.234375
        </positionTop>
        <positionLeft>
            611
        </positionLeft>
      </metadata>
    </task>
    <task fork="false" name="Stop_MongoDB" onTaskError="cancelJob">
      <variables>
        <variable description="Service instance ID." inherited="false" name="INSTANCE_ID" value=""/>
        <variable description="Service instance name." inherited="false" name="INSTANCE_NAME" value="mongodb-server-${PA_JOB_ID}"/>
        <variable advanced="false" description="The action that will be processed regarding the service status." hidden="false" inherited="false" model="PA:CATALOG_OBJECT(Workflow/psa,,,%MongoDB)" name="SERVICE_ACTION_WORKFLOW" value="service-automation/Finish_MongoDB"/>
      </variables>
      <genericInformation>
        <info name="task.icon" value="/automation-dashboard/styles/patterns/img/wf-icons/mongodb.png"/>
        <info name="task.documentation" value="PSA/PSAUserGuide.html"/>
      </genericInformation>
      <depends>
        <task ref="Loop"/>
      </depends>
      <scriptExecutable>
        <script>
          <file language="groovy" url="${PA_CATALOG_REST_URL}/buckets/service-automation/resources/Service_Action/raw">
            <arguments>
              <argument value="MONGODB_INSTANCE_NAME"/>
            </arguments>
          </file>
        </script>
      </scriptExecutable>
      <controlFlow block="none"/>
      <metadata>
        <positionTop>
            870.234375
        </positionTop>
        <positionLeft>
            679.5
        </positionLeft>
      </metadata>
    </task>
    <task fork="false" name="Check_Algorithm_Condition">
      <genericInformation>
        <info name="task.icon" value="/automation-dashboard/styles/patterns/img/wf-icons/controls_if.png"/>
      </genericInformation>
      <depends>
        <task ref="Start"/>
      </depends>
      <scriptExecutable>
        <script>
          <code language="groovy">
            <![CDATA[
println("Checking the branch condition of the algorithm")
]]>
          </code>
        </script>
      </scriptExecutable>
      <controlFlow>
        <if continuation="Finally" else="Else" target="If_Bayes">
          <script>
            <code language="groovy">
              <![CDATA[
TUNING_ALGORITHM = variables.get('TUNING_ALGORITHM')

if(TUNING_ALGORITHM.toLowerCase().contains("bayes")) {
    branch = "if";
} else {
    branch = "else";
}
]]>
            </code>
          </script>
        </if>
      </controlFlow>
      <metadata>
        <positionTop>
            486.234375
        </positionTop>
        <positionLeft>
            558
        </positionLeft>
      </metadata>
    </task>
    <task fork="false" name="If_Bayes">
      <genericInformation>
        <info name="task.icon" value="/automation-dashboard/styles/patterns/img/wf-icons/controls_if.png"/>
      </genericInformation>
      <scriptExecutable>
        <script>
          <code language="groovy">
            <![CDATA[
println("Running the If_Bayes branch")
]]>
          </code>
        </script>
      </scriptExecutable>
      <controlFlow block="start"/>
      <metadata>
        <positionTop>
            614.234375
        </positionTop>
        <positionLeft>
            333.25
        </positionLeft>
      </metadata>
    </task>
    <task fork="false" name="Else">
      <genericInformation>
        <info name="task.icon" value="/automation-dashboard/styles/patterns/img/wf-icons/controls_if.png"/>
      </genericInformation>
      <scriptExecutable>
        <script>
          <code language="groovy">
            <![CDATA[
println("Running the Else branch")
]]>
          </code>
        </script>
      </scriptExecutable>
      <controlFlow block="start"/>
      <metadata>
        <positionTop>
            614.234375
        </positionTop>
        <positionLeft>
            504.25
        </positionLeft>
      </metadata>
    </task>
    <task fork="false" name="Finally">
      <genericInformation>
        <info name="task.icon" value="/automation-dashboard/styles/patterns/img/wf-icons/controls_if.png"/>
      </genericInformation>
      <scriptExecutable>
        <script>
          <code language="groovy">
            <![CDATA[
println("Running the continuation branch [Finally task]")
]]>
          </code>
        </script>
      </scriptExecutable>
      <metadata>
        <positionTop>
            614.234375
        </positionTop>
        <positionLeft>
            724.5
        </positionLeft>
      </metadata>
    </task>
    <task fork="true" name="Split_Submit_Job_and_Wait">
      <description>
        <![CDATA[ The simplest task, ran by a Python engine. ]]>
      </description>
      <variables>
        <variable description="If True, containers will run based on images containing libraries that are compatible with GPU." inherited="false" model="PA:Boolean" name="CONTAINER_GPU_ENABLED" value="False"/>
        <variable advanced="false" description="Workflow that should be optimized. Set its path from the catalog." hidden="false" inherited="true" model="PA:CATALOG_OBJECT" name="TARGET_WORKFLOW" value="ai-auto-ml-optimization/Himmelblau_Function"/>
      </variables>
      <genericInformation>
        <info name="task.icon" value="/automation-dashboard/styles/patterns/img/wf-icons/controls_replicate.png"/>
      </genericInformation>
      <depends>
        <task ref="If_Bayes"/>
      </depends>
      <forkEnvironment javaHome="/usr">
        <envScript>
          <script>
            <file language="groovy" url="${PA_CATALOG_REST_URL}/buckets/scripts/resources/fork_env_ai/raw"/>
          </script>
        </envScript>
      </forkEnvironment>
      <scriptExecutable>
        <script>
          <code language="cpython">
            <![CDATA[
import os, math, json, base64, shutil
import numpy as np
import ssl
import ast

from urllib.request import Request, urlopen
from lxml import etree
from io import BytesIO
from PIL import Image
from argparse import ArgumentParser
from time import sleep

import chocolate as choco
from chocolate import uniform, quantized_uniform, log, quantized_log, choice
from chocolate import MongoDBConnection, Bayes, Grid, Random, QuasiRandom, CMAES, MOCMAES

from py4j.java_collections import SetConverter, MapConverter, ListConverter


def raiser(msg): raise Exception(msg)


def is_not_none_and_not_empty(p): return bool(p and not p.isspace())


PA_JOB_ID = variables.get("PA_JOB_ID")
print('PA_JOB_ID: ', PA_JOB_ID)

PA_TASK_ITERATION = int(variables.get('PA_TASK_ITERATION'))
print("PA_TASK_ITERATION: ", PA_TASK_ITERATION)

PA_CATALOG_REST_URL = variables.get("PA_CATALOG_REST_URL")
print('PA_CATALOG_REST_URL: ', PA_CATALOG_REST_URL)

EARLY_STOPPING = 0
STOP_IF_LOSS_IS_LOWER_THAN = variables.get("STOP_IF_LOSS_IS_LOWER_THAN")
try:
    STOP_IF_LOSS_IS_LOWER_THAN = ast.literal_eval(STOP_IF_LOSS_IS_LOWER_THAN)
except Exception:
    STOP_IF_LOSS_IS_LOWER_THAN = [-1.0]
print('STOP_IF_LOSS_IS_LOWER_THAN: ', STOP_IF_LOSS_IS_LOWER_THAN)

# Compare two list 
def compare_loss(list_value, hope_value):
    if(list_value == hope_value):
        return True
    else:
        return False

# Create a dict from a loss list
def create_loss_dict(loss, string):
    count = 0
    lahs =[]
    for l in loss:
        count +=1
        lahs+= [(string+str(count), l)]
    lossdict = {k: v for k, v in lahs}
    return lossdict

# Check Visdom support
VISDOM_ENABLED = variables.get("VISDOM_ENABLED")
if VISDOM_ENABLED is not None and VISDOM_ENABLED.lower() == "true":
    VISDOM_ENABLED = True
    from visdom import Visdom
else:
    VISDOM_ENABLED = False

# Check Tensorboard support
TENSORBOARD_ENABLED = variables.get("TENSORBOARD_ENABLED")
if TENSORBOARD_ENABLED is not None and TENSORBOARD_ENABLED.lower() == "true":
    TENSORBOARD_ENABLED = True
    from tensorboardX import SummaryWriter
else:
    TENSORBOARD_ENABLED = False

writer = None
if TENSORBOARD_ENABLED:
    TENSORBOARD_CONTAINER_LOG_PATH = variables.get("TENSORBOARD_CONTAINER_LOG_PATH")
    assert TENSORBOARD_CONTAINER_LOG_PATH is not None
    TENSORBOARD_JOB_ID = "job_ID_" + variables.get("PA_JOB_ID")
    TENSORBOARD_PATH = os.path.join(TENSORBOARD_CONTAINER_LOG_PATH, TENSORBOARD_JOB_ID)
    print('TENSORBOARD_PATH: ', TENSORBOARD_PATH)
    try:
        if not os.path.exists(TENSORBOARD_PATH):
            os.makedirs(TENSORBOARD_PATH)
        writer = SummaryWriter(TENSORBOARD_PATH)
    except:
        print("Error while using: ", TENSORBOARD_PATH)
        print("Deactivating Tensorboard")
        TENSORBOARD_ENABLED = False
        pass


# Get the workflow to optimize
TARGET_WORKFLOW = variables.get("TARGET_WORKFLOW")
bucket_name, workflow_name = TARGET_WORKFLOW.split('/')
print("bucket_name: ", bucket_name, ", workflow_name: ", workflow_name)

# Set the workflow url
workflow_url = PA_CATALOG_REST_URL + '/buckets/'+bucket_name+'/resources/'+workflow_name+'/raw'
print("workflow_url: ", workflow_url)

# Get schedulerapi access and acquire session id
schedulerapi.connect()
session_id = schedulerapi.getSession()
print("session_id: ", session_id)

# Get the workflow xml
workflow_req = Request(workflow_url)
workflow_req.add_header('sessionid', session_id)
if workflow_url.startswith('https'):
    workflow_xml = urlopen(workflow_req, context=ssl._create_unverified_context()).read()
else:
    workflow_xml = urlopen(workflow_req).read()
# print("workflow_xml: " + str(workflow_xml))

# Define the search space
# space = "space=" + variables.get('SEARCH_SPACE')
# print('SEARCH_SPACE: ', space)
# exec(space)
workflow_root = etree.fromstring(workflow_xml)

search_space_xpath = "string(//*[@name='SEARCH_SPACE']/@value)"
search_space = str(workflow_root.xpath(search_space_xpath))

if len(str(search_space)) <= 0:
    raiser("The objective workflow do not contains a SEARCH_SPACE variable!")

search_space_model_xpath = "string(//*[@name='SEARCH_SPACE']/@model)"
search_space_model = str(workflow_root.xpath(search_space_model_xpath))

if len(str(search_space_model)) <= 0:
    raiser("The SEARCH_SPACE variable of the objective workflow do not contains a model type!")

# search key dict
def key_search(i):
    try:
        keys = list(i.keys())
    except:
        keys = []
    return keys

# get key and value dict
def key_value_get(key, value):
    aux = key.strip() + "(" + str(value) + ")"
    if key.strip() == 'uniform' or key.strip() == "quantized_uniform" or key.strip() == "log" or key.strip() == "quantized_log":
        aux = aux.replace('[', '')
        aux = aux.replace(']', '')
    return aux

# convert json to chocolate format
def json_to_choco_convert(search_space):
    cont_model = 0
    for data in search_space:
        key_list = key_search(data)
        if not key_list:
            key, value = list(search_space[data].items())[0]
            aux = key_value_get(key, value)
            search_space[data] = eval(aux)
        else:
            for i in key_list:
                try:
                    key, value = list(data[i].items())[0]
                    aux = key_value_get(key, value)
                    search_space[cont_model][i] = eval(aux)
                except:
                    pass
            cont_model += 1
    return search_space


if search_space_model.upper() == 'PA:JSON':
    # Define the search space from a JSON string
    space = "space=" + str(search_space)
    exec(space)
    space = json_to_choco_convert(space)
    print("\nspace: ", space)

if search_space_model.upper() == 'PA:CATALOG_OBJECT':
    # Define the search space from a JSON file stored in the catalog
    search_space_bucket_name, search_space_script_name = search_space.split('/')
    print("search_space_bucket_name: ", search_space_bucket_name, ", search_space_script_name: ", search_space_script_name)
    search_space_script_url = PA_CATALOG_REST_URL + '/buckets/'+search_space_bucket_name+'/resources/'+search_space_script_name+'/raw'
    print("search_space_script_url: ", search_space_script_url)
    search_space_script_req = Request(search_space_script_url)
    search_space_script_req.add_header('sessionid', session_id)
    if search_space_script_url.startswith('https'):
        search_space_script_json = json.loads(urlopen(search_space_script_req, context=ssl._create_unverified_context()).read())
    else:
        search_space_script_json = json.loads(urlopen(search_space_script_req).read())
    print("\nsearch_space_script_json: ", search_space_script_json)
    space = json_to_choco_convert(search_space_script_json)
    print("\nspace: ", space)


# Establish a connection to a MongoDB local database
MONGODB_URL = variables.get('MONGODB_URL')
print('MONGODB_URL: ', MONGODB_URL)
conn = MongoDBConnection(MONGODB_URL)
if PA_TASK_ITERATION == 0:
    print('Cleaning database for the first iteration')
    conn.clear()  # Clear all data from the database.

TUNING_ALGORITHM = variables.get('TUNING_ALGORITHM')
assert TUNING_ALGORITHM is not None, "TUNING_ALGORITHM must be set!"
TUNING_ALGORITHM = TUNING_ALGORITHM.lower()
print('TUNING_ALGORITHM: ', TUNING_ALGORITHM)

cross_validation = int(variables.get('NUMBER_OF_REPETITIONS'))
cv = None
if cross_validation > 1:
    cv = Repeat(repetitions=cross_validation, reduce=np.mean, rep_col="_repetition_id")

# Construct the optimizer
sampler = None
if TUNING_ALGORITHM == "grid":
    sampler = Grid(conn, space, cv)
if TUNING_ALGORITHM == "random":
    sampler = Random(conn, space, cv)
if TUNING_ALGORITHM == "quasirandom":
    sampler = QuasiRandom(conn, space, cv)
if TUNING_ALGORITHM == "bayes":
    sampler = Bayes(conn, space, cv)
if TUNING_ALGORITHM == "cmaes":
    sampler = CMAES(conn, space, cv)
if TUNING_ALGORITHM == "mocmaes":
    sampler = MOCMAES(conn, space, cv)
assert sampler is not None, "TUNING_ALGORITHM must be selected!"

# Check for previous results
workflow_results = None
if PA_TASK_ITERATION > 0:
    workflow_results = variables.get('workflow_results')

# Add previous loss values to the database
if workflow_results is not None:
    previous_results = json.loads(workflow_results)
    print("Adding previous loss values to the database")
    for i, previous_result in enumerate(previous_results):
        # print(i, previous_result)
        previous_token = previous_result['token']
        previous_loss = previous_result['loss']
        print(i, 'previous_token: ', previous_token, ', previous_loss: ', previous_loss)
        # Add the loss to the database
        # sampler.update(token, loss)
        sampler.update(previous_token, previous_loss)

# Sample the next point and submit job
samples_per_iteration = int(variables.get('PARALLEL_EXECUTIONS_PER_ITERATION'))
results = []
map_converter = MapConverter()
job_id_params = {}
for i in range(samples_per_iteration):
    try:
        token, params = sampler.next()
        print("sample: ", i, ", token: ", token, ", params: ", params)
    except StopIteration:
        print("Stopping iteration...")
        break

    token_encoded = base64.b64encode(json.dumps(token).encode('utf-8')).decode("utf-8")
    params_encoded = base64.b64encode(json.dumps(params).encode("utf-8")).decode("utf-8")
    print("token_encoded:  ", token_encoded)
    print("params_encoded: ", params_encoded)

    # variables submitted to the workflow
    workflow_variables = {
        "token_encoded": token_encoded,
        "params_encoded": params_encoded
    }

    # Add generated params from the search space as a workflow variable
    workflow_variables.update(params)

    TARGET_NATIVE_SCHEDULER_PARAMS = variables.get("TARGET_NATIVE_SCHEDULER_PARAMS")
    TARGET_NODE_ACCESS_TOKEN = variables.get("TARGET_NODE_ACCESS_TOKEN")
    TARGET_NODE_SOURCE = variables.get("TARGET_NODE_SOURCE")
    TARGET_CONTAINER_PLATFORM = variables.get("TARGET_CONTAINER_PLATFORM")
    TARGET_CONTAINER_IMAGE = variables.get("TARGET_CONTAINER_IMAGE")
    TARGET_CONTAINER_GPU_ENABLED = variables.get("TARGET_CONTAINER_GPU_ENABLED")
    TARGET_NVIDIA_RAPIDS_ENABLED = variables.get("TARGET_NVIDIA_RAPIDS_ENABLED")

    if is_not_none_and_not_empty(TARGET_NATIVE_SCHEDULER_PARAMS): workflow_variables['NATIVE_SCHEDULER_PARAMS'] = TARGET_NATIVE_SCHEDULER_PARAMS
    if is_not_none_and_not_empty(TARGET_NODE_ACCESS_TOKEN): workflow_variables['NODE_ACCESS_TOKEN'] = TARGET_NODE_ACCESS_TOKEN
    if is_not_none_and_not_empty(TARGET_NODE_SOURCE): workflow_variables['NODE_SOURCE'] = TARGET_NODE_SOURCE
    if is_not_none_and_not_empty(TARGET_CONTAINER_PLATFORM): workflow_variables['CONTAINER_PLATFORM'] = TARGET_CONTAINER_PLATFORM
    if is_not_none_and_not_empty(TARGET_CONTAINER_IMAGE): workflow_variables['CONTAINER_IMAGE'] = TARGET_CONTAINER_IMAGE
    if is_not_none_and_not_empty(TARGET_CONTAINER_GPU_ENABLED): workflow_variables['CONTAINER_GPU_ENABLED'] = TARGET_CONTAINER_GPU_ENABLED
    if is_not_none_and_not_empty(TARGET_NVIDIA_RAPIDS_ENABLED): workflow_variables['USE_NVIDIA_RAPIDS'] = TARGET_NVIDIA_RAPIDS_ENABLED

    workflow_variables['TENSORBOARD_ENABLED'] = str(TENSORBOARD_ENABLED).lower()
    if TENSORBOARD_ENABLED:
        print("Adding Tensorboard support to the workflow variables")
        TENSORBOARD_INSTANCE_NAME = variables.get("TENSORBOARD_INSTANCE_NAME")
        TENSORBOARD_HOST_LOG_PATH = variables.get("TENSORBOARD_HOST_LOG_PATH")
        TENSORBOARD_CONTAINER_LOG_PATH = variables.get("TENSORBOARD_CONTAINER_LOG_PATH")
        CONTAINER_ROOTLESS_ENABLED = variables.get("CONTAINER_ROOTLESS_ENABLED")
        if is_not_none_and_not_empty(TENSORBOARD_INSTANCE_NAME): workflow_variables['TENSORBOARD_INSTANCE_NAME'] = TENSORBOARD_INSTANCE_NAME
        if is_not_none_and_not_empty(TENSORBOARD_HOST_LOG_PATH): workflow_variables['TENSORBOARD_HOST_LOG_PATH'] = TENSORBOARD_HOST_LOG_PATH
        if is_not_none_and_not_empty(TENSORBOARD_CONTAINER_LOG_PATH): workflow_variables['TENSORBOARD_CONTAINER_LOG_PATH'] = TENSORBOARD_CONTAINER_LOG_PATH
        if is_not_none_and_not_empty(CONTAINER_ROOTLESS_ENABLED): workflow_variables['CONTAINER_ROOTLESS_ENABLED'] = CONTAINER_ROOTLESS_ENABLED

    workflow_variables['VISDOM_ENABLED'] = str(VISDOM_ENABLED).lower()
    if VISDOM_ENABLED:
        print("[visdom] Adding Visdom support to the workflow variables")
        VISDOM_INSTANCE_NAME = variables.get("VISDOM_INSTANCE_NAME")
        VISDOM_ENDPOINT = variables.get("ENDPOINT_" + VISDOM_INSTANCE_NAME)
        if is_not_none_and_not_empty(VISDOM_ENDPOINT): workflow_variables['VISDOM_ENDPOINT'] = VISDOM_ENDPOINT

    workflow_variables_java_map = map_converter.convert(workflow_variables, schedulerapi._gateway_client)
    # print('workflow_variables_java_map: ', workflow_variables_java_map)
    generic_infos_map = {
        "PARENT_JOB_ID": PA_JOB_ID
    }
    generic_infos_java_map = map_converter.convert(generic_infos_map, schedulerapi._gateway_client)
    # print('generic_infos_java_map: ', generic_infos_java_map)

    print("Submitting workflow ", TARGET_WORKFLOW)
    # submitting the job
    print("-"*30)
    print("PA_CATALOG_REST_URL: ", PA_CATALOG_REST_URL)
    print("bucket_name:         ", bucket_name)
    print("workflow_name:       ", workflow_name)
    print("workflow_variables:  ", workflow_variables)
    print("generic_infos_map:   ", generic_infos_map)
    print("-"*30)
    job_id = schedulerapi.submitFromCatalog(PA_CATALOG_REST_URL, bucket_name, workflow_name, workflow_variables_java_map, generic_infos_java_map).longValue()
    print("Job submitted with job id ", job_id)

    results.append(job_id)
    job_id_params["job_id_"+str(job_id)] = params
# end iterations

parent_job_id = PA_JOB_ID

### BEGIN VISDOM ###
vis = None
if VISDOM_ENABLED:
    try:
        VISDOM_HOST = variables.get('VISDOM_HOST')
        VISDOM_PORT = variables.get('VISDOM_PORT')
        print("[visdom] Connecting to %s:%s" % (VISDOM_HOST, VISDOM_PORT))
        vis = Visdom(server="http://"+VISDOM_HOST, port=int(VISDOM_PORT))
        if vis.check_connection(timeout_seconds=10):
            print("[visdom] Connected to Visdom")
            win_text_loss = variables.get('VISDOM_win_text_loss')
            # win_plot_loss = variables.get('VISDOM_win_plot_loss')
            print("[visdom] [debug] win_text_loss: ", win_text_loss)
            # print("[visdom] [debug] win_plot_loss: ", win_plot_loss)
        else:
            raise Exception('[visdom] Visdom server seems to be down. TimeoutError.')
    except Exception as e:
        print("[visdom] Error while connecting to Visdom: ", e)
        print("[visdom] Deactivating Visdom")
        VISDOM_ENABLED = False
        variables.put("VISDOM_ENABLED", "False")
        pass
### END VISDOM ###

workflow_results = []
results.sort()
for i, res in enumerate(results):
    job_id = str(res)
    # print(i, job_id)

    # Wait for the job termination
    is_finished = False
    while True:
        is_finished = schedulerapi.isJobFinished(job_id)
        print(i, "job_id: ", job_id, ", is_finished: ", is_finished)
        if is_finished:
            break
        else:
            sleep(0.5)  # 500ms

    # Get job result
    # RESULT_JSON: {"token": {"_token_id": 0}, "loss": 0.009321813276374468}
    result_map = schedulerapi.getJobResult(job_id).getResultMap()
    result_json = result_map['RESULT_JSON']
    job_result = json.loads(result_json)
    print(i, "job_id: ", job_id, ", job_result: ", job_result)
    workflow_results.append(job_result)

    token = job_result['token']        # {'_chocolate_id': 0}
    loss = job_result['loss']          # 450.9434895085956
    token_id = token['_chocolate_id']  # 0

    # Convert loss float to a loss list
    if type(loss) is not list:   
        loss = [float(loss)]
    
    try:
        if -1.0 not in STOP_IF_LOSS_IS_LOWER_THAN and len(loss) == len(STOP_IF_LOSS_IS_LOWER_THAN):
            is_it_equal_loss = list(map(lambda a, b: a <= b, loss, STOP_IF_LOSS_IS_LOWER_THAN))
            hope_value =  [True] * len(loss)
            result_stop_loss = compare_loss(is_it_equal_loss, hope_value)
            if result_stop_loss:
                EARLY_STOPPING = 1  
    except:
        print("Error while checking the early stopping mechanism!")
        pass

    if VISDOM_ENABLED:
        try:
            VISDOM_JOB_ID = 'job_id_' + parent_job_id
            vis.text("Job ID: {}, Loss: {}\n".format(job_id, loss), win=win_text_loss, append=True, env=VISDOM_JOB_ID)
            job_ids = [int(job_id)] * len(loss)
            print(job_ids, loss)
            if PA_TASK_ITERATION == 0 and i == 0:
                win_plot_loss = vis.line(
                    Y=np.column_stack(tuple(loss)),
                    X=np.column_stack(tuple(job_ids)),
                    opts = dict(
                        xlabel = 'Job ID',
                        ylabel = 'Loss',
                        title = 'Model loss',
                        markers = True
                        ),
                    env=VISDOM_JOB_ID,
                )
                variables.put('VISDOM_win_plot_loss', win_plot_loss)
                print("[visdom] [debug] win_plot_loss: ", win_plot_loss)
            else:
                win_plot_loss = variables.get('VISDOM_win_plot_loss') if PA_TASK_ITERATION > 0 else win_plot_loss
                print("[visdom] [debug] win_plot_loss: ", win_plot_loss)
                vis.line(
                    Y=np.column_stack(tuple(loss)),
                    X=np.column_stack(tuple(job_ids)),
                    win=win_plot_loss, 
                    update='append', 
                    env=VISDOM_JOB_ID
                )
        except:
            print("[visdom] Error while plotting with Visdom!")
            pass
    
    if TENSORBOARD_ENABLED:
        try:
            lossDict = create_loss_dict(loss, 'Loss_')
            writer.add_scalars('Loss', lossDict, int(job_id))
            
            # Parallel Coordinates Plot
            plossDict = create_loss_dict(loss, 'hparam/PLoss_')
            params = job_id_params["job_id_" + job_id]
            writer.add_hparams(params, plossDict, name="job_id_" + job_id)
        except:
            print("Error while plotting with Tensorboard!")
            pass

if TENSORBOARD_ENABLED:
    writer.close()

workflow_results = json.dumps(workflow_results)
print('workflow_results: ', workflow_results)

variables.put('workflow_results', workflow_results)
variables.put('EARLY_STOPPING', str(EARLY_STOPPING))
]]>
          </code>
        </script>
      </scriptExecutable>
      <controlFlow block="end"/>
      <metadata>
        <positionTop>
            742.234375
        </positionTop>
        <positionLeft>
            333.25
        </positionLeft>
      </metadata>
    </task>
    <task fork="false" name="Check_Visdom_Support">
      <genericInformation>
        <info name="task.icon" value="/automation-dashboard/styles/patterns/img/wf-icons/controls_if.png"/>
      </genericInformation>
      <scriptExecutable>
        <script>
          <code language="groovy">
            <![CDATA[
println("[visdom] Checking for Visdom support")
]]>
          </code>
        </script>
      </scriptExecutable>
      <controlFlow>
        <if continuation="Continuation1" else="Nothing1" target="Start_Visdom">
          <script>
            <code language="groovy">
              <![CDATA[
if ("true".equalsIgnoreCase(variables.get("VISDOM_ENABLED"))) {
    println("[visdom] Visdom is enabled!")
    branch = "if"
} else {
    println("[visdom] Visdom is disabled!")
    branch = "else"
}
]]>
            </code>
          </script>
        </if>
      </controlFlow>
      <metadata>
        <positionTop>
            -21.765625
        </positionTop>
        <positionLeft>
            541.5
        </positionLeft>
      </metadata>
    </task>
    <task fork="false" name="Start_Visdom">
      <description>
        <![CDATA[ Start the Visdom server as a service. ]]>
      </description>
      <variables>
        <variable description="Name of the Visdom service instance to use." inherited="false" model="PA:NOT_EMPTY_STRING" name="VISDOM_INSTANCE_NAME" value="visdom-server-${PA_JOB_ID}"/>
        <variable description="If True, a login in required for accessing the Visdom service." inherited="false" model="PA:Boolean" name="VISDOM_ENABLE_LOGIN" value="False"/>
        <variable description="Username to access the Visdom service." inherited="false" name="VISDOM_USERNAME" value=""/>
        <variable description="Password to access the Visdom service." inherited="false" model="PA:HIDDEN" name="VISDOM_PASSWORD" value=""/>
        <variable advanced="false" description="The Visdom service activation workflow. Please keep the default value for this variable." hidden="false" inherited="false" model="PA:CATALOG_OBJECT(Workflow/psa,,,Visdom%)" name="SERVICE_ACTIVATION_WORKFLOW" value="service-automation/Visdom"/>
        <variable description="Instance name of the server to be used to broadcast the visualization." inherited="false" name="INSTANCE_NAME" value="$VISDOM_INSTANCE_NAME"/>
        <variable description="Container platform used for executing the workflow tasks." inherited="false" name="ENGINE" value="$CONTAINER_PLATFORM"/>
        <variable description="If True, requests to Visdom are sent via a proxy server." inherited="false" name="PROXYFIED" value="$VISDOM_PROXYFIED"/>
      </variables>
      <genericInformation>
        <info name="task.icon" value="/automation-dashboard/styles/patterns/img/wf-icons/visdom.png"/>
        <info name="task.documentation" value="PAIO/PAIOUserGuide.html"/>
      </genericInformation>
      <scriptExecutable>
        <script>
          <file language="groovy" url="${PA_CATALOG_REST_URL}/buckets/service-automation/resources/Service_Start/raw">
            <arguments>
              <argument value="true"/>
              <argument value="false"/>
              <argument value="PROXYFIED"/>
              <argument value="VISDOM_ENABLE_LOGIN"/>
              <argument value="VISDOM_USERNAME"/>
              <argument value="VISDOM_PASSWORD"/>
              <argument value="NODE_SOURCE"/>
              <argument value="NATIVE_SCHEDULER_PARAMS"/>
              <argument value="NODE_ACCESS_TOKEN"/>
              <argument value="ENGINE"/>
            </arguments>
          </file>
        </script>
      </scriptExecutable>
      <post>
        <script>
          <code language="groovy">
            <![CDATA[
variables.put("VISDOM_INSTANCE_NAME", variables.get("VISDOM_INSTANCE_NAME"))
variables.put("VISDOM_ENABLE_LOGIN", variables.get("VISDOM_ENABLE_LOGIN"))
variables.put("VISDOM_USERNAME", variables.get("VISDOM_USERNAME"))
variables.put("VISDOM_PASSWORD", variables.get("VISDOM_PASSWORD"))
]]>
          </code>
        </script>
      </post>
      <metadata>
        <positionTop>
            106.234375
        </positionTop>
        <positionLeft>
            334
        </positionLeft>
      </metadata>
    </task>
    <task fork="false" name="Nothing1">
      <scriptExecutable>
        <script>
          <code language="groovy">
            <![CDATA[
println("[visdom] Visdom disabled!")
]]>
          </code>
        </script>
      </scriptExecutable>
      <metadata>
        <positionTop>
            106.234375
        </positionTop>
        <positionLeft>
            472
        </positionLeft>
      </metadata>
    </task>
    <task fork="true" name="Continuation1">
      <variables>
        <variable description="If True, containers will run based on images containing libraries that are compatible with GPU." inherited="false" model="PA:Boolean" name="CONTAINER_GPU_ENABLED" value="False"/>
      </variables>
      <forkEnvironment javaHome="/usr">
        <envScript>
          <script>
            <file language="groovy" url="${PA_CATALOG_REST_URL}/buckets/scripts/resources/fork_env_ai/raw"/>
          </script>
        </envScript>
      </forkEnvironment>
      <scriptExecutable>
        <script>
          <code language="cpython">
            <![CDATA[
# Wait for Visdom sever to be up and fully running.
import time
time.sleep(10)

VISDOM_ENABLED = variables.get('VISDOM_ENABLED')

if VISDOM_ENABLED is not None and VISDOM_ENABLED == "true":
    import numpy as np
    from visdom import Visdom
    VISDOM_INSTANCE_NAME = variables.get("VISDOM_INSTANCE_NAME")
    VISDOM_ENDPOINT = variables.get("ENDPOINT_" + VISDOM_INSTANCE_NAME)
    # VISDOM_ENDPOINT = variables.get("VISDOM_ENDPOINT") if variables.get("VISDOM_ENDPOINT") else results[0].__str__()
    print("[visdom] [debug] VISDOM_ENDPOINT: ", VISDOM_ENDPOINT)

    if VISDOM_ENDPOINT is not None:
        VISDOM_ENDPOINT = VISDOM_ENDPOINT.replace("http://", "")
        print(VISDOM_ENDPOINT)

    (VISDOM_HOST, VISDOM_PORT) = VISDOM_ENDPOINT.split(":")

    variables.put('VISDOM_HOST', VISDOM_HOST)
    variables.put('VISDOM_PORT', VISDOM_PORT)
    print("[visdom] [debug] VISDOM_HOST: ", VISDOM_HOST)
    print("[visdom] [debug] VISDOM_PORT: ", VISDOM_PORT)
    try:
        print("[visdom] Connecting to %s:%s" % (VISDOM_HOST, VISDOM_PORT))
        vis = Visdom(server="http://"+VISDOM_HOST, port=int(VISDOM_PORT))
        if vis.check_connection(timeout_seconds=10):
            parent_job_id = variables.get("PA_JOB_ID")
            vis.text('A new experiment was created, please see job_id_'+parent_job_id+' environment in Visdom for more info.')
            win_text_loss = vis.text("Loss (objective to optimize):\n", env='job_id_'+parent_job_id)
            # win_plot_loss = vis.line(
            #     Y = np.array([np.nan]),
            #     X = np.array([np.nan]),
            #     opts = dict(
            #         xlabel = 'Job ID',
            #         ylabel = 'Loss',
            #         title = 'Model loss',
            #         ),
            #     env='job_id_'+parent_job_id
            # )
            variables.put('VISDOM_win_text_loss', win_text_loss)
            # variables.put('VISDOM_win_plot_loss', win_plot_loss)
            print("[visdom] [debug] win_text_loss: ", win_text_loss)
            # print("[visdom] [debug] win_plot_loss: ", win_plot_loss)
        else:
            raise Exception('[visdom] Visdom server seems to be down. TimeoutError.')
    except Exception as e:
        print("[visdom] Error while connecting to Visdom: ", e)
        print("[visdom] Deactivating Visdom")
        VISDOM_ENABLED = False
        variables.put("VISDOM_ENABLED", "False")
        pass
]]>
          </code>
        </script>
      </scriptExecutable>
      <metadata>
        <positionTop>
            106.234375
        </positionTop>
        <positionLeft>
            611
        </positionLeft>
      </metadata>
    </task>
    <task fork="false" name="Check_Tensorboard_Support">
      <genericInformation>
        <info name="task.icon" value="/automation-dashboard/styles/patterns/img/wf-icons/controls_if.png"/>
      </genericInformation>
      <scriptExecutable>
        <script>
          <code language="groovy">
            <![CDATA[
println("Checking for Tensorboard support")
]]>
          </code>
        </script>
      </scriptExecutable>
      <controlFlow>
        <if continuation="Continuation2" else="Nothing2" target="Start_Tensorboard">
          <script>
            <code language="groovy">
              <![CDATA[
if ("true".equalsIgnoreCase(variables.get("TENSORBOARD_ENABLED"))) {
    branch = "if"
} else {
    branch = "else"
}
]]>
            </code>
          </script>
        </if>
      </controlFlow>
      <metadata>
        <positionTop>
            -21.765625
        </positionTop>
        <positionLeft>
            980.5
        </positionLeft>
      </metadata>
    </task>
    <task fork="false" name="Nothing2">
      <scriptExecutable>
        <script>
          <code language="groovy">
            <![CDATA[
println("Tensorboard disabled")
]]>
          </code>
        </script>
      </scriptExecutable>
      <metadata>
        <positionTop>
            106.234375
        </positionTop>
        <positionLeft>
            911
        </positionLeft>
      </metadata>
    </task>
    <task fork="false" name="Continuation2">
      <scriptExecutable>
        <script>
          <code language="groovy">
            <![CDATA[
// Wait for Tensorboard sever to be up and fully running.
sleep(10000)
]]>
          </code>
        </script>
      </scriptExecutable>
      <metadata>
        <positionTop>
            106.234375
        </positionTop>
        <positionLeft>
            1050
        </positionLeft>
      </metadata>
    </task>
    <task fork="false" name="Start_Tensorboard" onTaskError="cancelJob">
      <description>
        <![CDATA[ Start the Tensorboard server as a service. ]]>
      </description>
      <variables>
        <variable description="Name of the Tensorboard service instance to use." inherited="false" model="PA:NOT_EMPTY_STRING" name="TENSORBOARD_INSTANCE_NAME" value="tensorboard-server-${PA_JOB_ID}"/>
        <variable description="Specifies the path where Tensorboard logs are created and stored on the host." inherited="false" model="PA:NOT_EMPTY_STRING" name="TENSORBOARD_HOST_LOG_PATH" value="/shared/$TENSORBOARD_INSTANCE_NAME"/>
        <variable description="Specifies the path where Tensorboard logs are created and stored in the container." inherited="false" model="PA:NOT_EMPTY_STRING" name="TENSORBOARD_CONTAINER_LOG_PATH" value="/tmp/$TENSORBOARD_INSTANCE_NAME"/>
        <variable advanced="false" description="The Tensorboard service activation workflow. Please keep the default value for this variable." hidden="false" inherited="false" model="PA:CATALOG_OBJECT(Workflow/psa,,,Tensorboard%)" name="SERVICE_ACTIVATION_WORKFLOW" value="service-automation/Tensorboard"/>
        <variable description="Instance name of the server to be used to broadcast the visualization." inherited="false" name="INSTANCE_NAME" value="$TENSORBOARD_INSTANCE_NAME"/>
        <variable description="If True, requests to Tensorboard are sent via a proxy server." inherited="false" name="PROXYFIED" value="$TENSORBOARD_PROXYFIED"/>
        <variable description="Path where Tensorboard logs are created and stored on the host." inherited="false" name="MOUNT_LOG_PATH" value="$TENSORBOARD_HOST_LOG_PATH"/>
        <variable description="Container platform used for executing the workflow tasks." inherited="false" name="ENGINE" value="$CONTAINER_PLATFORM"/>
        <variable description="If True, the user will be able to run the workflow in a rootless mode." inherited="false" model="PA:Boolean" name="CONTAINER_ROOTLESS_ENABLED" value="False"/>
      </variables>
      <genericInformation>
        <info name="task.icon" value="/automation-dashboard/styles/patterns/img/wf-icons/tensorboard.png"/>
        <info name="task.documentation" value="PSA/PSAUserGuide.html"/>
      </genericInformation>
      <scriptExecutable>
        <script>
          <file language="groovy" url="${PA_CATALOG_REST_URL}/buckets/service-automation/resources/Service_Start/raw">
            <arguments>
              <argument value="true"/>
              <argument value="false"/>
              <argument value="PROXYFIED"/>
              <argument value="MOUNT_LOG_PATH"/>
              <argument value="NODE_SOURCE"/>
              <argument value="NATIVE_SCHEDULER_PARAMS"/>
              <argument value="NODE_ACCESS_TOKEN"/>
              <argument value="ENGINE"/>
            </arguments>
          </file>
        </script>
      </scriptExecutable>
      <controlFlow block="none"/>
      <post>
        <script>
          <code language="groovy">
            <![CDATA[
variables.put("TENSORBOARD_INSTANCE_NAME", variables.get("TENSORBOARD_INSTANCE_NAME"))
variables.put("TENSORBOARD_HOST_LOG_PATH", variables.get("TENSORBOARD_HOST_LOG_PATH"))
variables.put("TENSORBOARD_CONTAINER_LOG_PATH", variables.get("TENSORBOARD_CONTAINER_LOG_PATH"))
variables.put("CONTAINER_ROOTLESS_ENABLED", variables.get("CONTAINER_ROOTLESS_ENABLED"))
]]>
          </code>
        </script>
      </post>
      <metadata>
        <positionTop>
            106.234375
        </positionTop>
        <positionLeft>
            761.5
        </positionLeft>
      </metadata>
    </task>
    <task fork="true" name="Stop_If_Tensorboard_Enabled" onTaskError="cancelJob">
      <variables>
        <variable description="Service instance ID." inherited="false" name="INSTANCE_ID" value=""/>
        <variable description="Service instance name." inherited="false" name="INSTANCE_NAME" value="$TENSORBOARD_INSTANCE_NAME"/>
        <variable advanced="false" description="The action that will be processed regarding the service status." hidden="false" inherited="false" model="PA:CATALOG_OBJECT(Workflow/psa,,,%Tensorboard)" name="SERVICE_ACTION_WORKFLOW" value="service-automation/Finish_Tensorboard"/>
      </variables>
      <genericInformation>
        <info name="task.icon" value="/automation-dashboard/styles/patterns/img/wf-icons/tensorboard.png"/>
        <info name="task.documentation" value="PSA/PSAUserGuide.html"/>
      </genericInformation>
      <depends>
        <task ref="Wait_Signal_If_Services_Enabled"/>
      </depends>
      <scriptExecutable>
        <script>
          <code language="groovy">
            <![CDATA[
import org.ow2.proactive.pca.service.client.ApiClient
import org.ow2.proactive.pca.service.client.api.CatalogRestApi
import org.ow2.proactive.pca.service.client.api.ServiceInstanceRestApi
import org.ow2.proactive.pca.service.client.model.CloudAutomationWorkflow
import org.ow2.proactive.pca.service.client.model.ServiceDescription
import java.util.concurrent.TimeoutException
import com.google.common.base.Strings

println("BEGIN " + variables.get("PA_TASK_NAME"))

// Check Tensorboard support
def TENSORBOARD_ENABLED = false
if ("true".equalsIgnoreCase(variables.get("TENSORBOARD_ENABLED"))) {
    TENSORBOARD_ENABLED = true
}

if (TENSORBOARD_ENABLED) {
    try {
        // Get schedulerapi access
        schedulerapi.connect()

        // Acquire session id
        def sessionId = schedulerapi.getSession()

        // Define PCA URL
        def pcaUrl = variables.get('PA_CLOUD_AUTOMATION_REST_URL')

        // Connect to APIs
        def apiClient = new ApiClient()
        apiClient.setBasePath(pcaUrl)
        //apiClient.setDebugging(true)
        def serviceInstanceRestApi = new ServiceInstanceRestApi(apiClient)
        def instanceName = variables.get("INSTANCE_NAME")
        def instanceId = (!variables.get("INSTANCE_ID") && instanceName)? variables.get("INSTANCE_ID_" + instanceName) : variables.get("INSTANCE_ID")
        if (!instanceId && !instanceName){
            throw new IllegalArgumentException("You have to specify an INSTANCE_NAME or an INSTANCE_ID. Empty value for both is not allowed.");
        }

        println("INSTANCE_ID: " + instanceId)

        def bucketName
        def isActionExists = false
        def catalogRestApi = new CatalogRestApi(apiClient)
        def actionVariables = new HashMap()

        def action = variables.get("ACTION")
        def serviceActionWorkflow = variables.get("SERVICE_ACTION_WORKFLOW")

        if (Strings.isNullOrEmpty(action) && Strings.isNullOrEmpty(serviceActionWorkflow)) {
            throw new IllegalArgumentException("You have to provide an ACTION value or a SERVICE_ACTION_WORKFLOW. Empty value is not allowed.");
        }

        if (!Strings.isNullOrEmpty(action)) {
            List<CloudAutomationWorkflow> listExecutableActions = catalogRestApi.listExecutableActionsByInstance(sessionId, instanceId.toString()).get(instanceId.toString())
            for (CloudAutomationWorkflow actionIterator : listExecutableActions) {
                if (actionIterator.getName().equals(action)){
                    bucketName = actionIterator.getBucket()
                    //retrieve default action variables
                    actionVariables = actionIterator.getVariables().collectEntries {var -> [var.getName(), var.getValue()]}
                    isActionExists = true
                    break
                }
            }
        } else if (!Strings.isNullOrEmpty(serviceActionWorkflow)) {
            def serviceActionWorkflowSplits = serviceActionWorkflow.split('/')
            bucketName = serviceActionWorkflowSplits[0]
            action = serviceActionWorkflowSplits[1]
            CloudAutomationWorkflow executableAction = catalogRestApi.getExecutableActionByCatalogObject(sessionId, instanceId, bucketName, action)
            println("Action Bucket_name: " + bucketName + ", Action_workflow_name: " + action)
            if (executableAction != null) {
                actionVariables = executableAction.getVariables().collectEntries {var -> [var.getName(), var.getValue()]}
                isActionExists = true
            }
        }
        if(!isActionExists){
            throw new IllegalArgumentException("The provided ACTION: " + action + " does not belong to the existing possible actions that can be applied to the current state of the service. You have to specify a valid action.")
        }

        // Retrieve and update workflow variables
        if (binding.variables["args"]){
            for (String var: args){
                actionVariables.put(var, variables.get(var))
            }
        }

        // Execute action on service
        ServiceDescription service = new ServiceDescription()
        service.setBucketName(bucketName)
        service.setWorkflowName(action)
        if( !actionVariables.isEmpty() ){
            actionVariables.each{ k, v -> service.putVariablesItem("${k}", "${v}") }
        }
        def serviceInstanceData = serviceInstanceRestApi.launchServiceInstanceAction(sessionId, Long.parseLong(instanceId), service, Integer.parseInt(variables.get("PA_JOB_ID")))

        if (action.toLowerCase().contains("finish")) {
            try {
                schedulerapi.waitForJob(serviceInstanceData.getJobSubmissions().get(0).getJobId().toString(), 180000)
            } catch (TimeoutException toe) {
                println("[warning] Timeout reached. Disable to wait until the PCA service " + instanceId + " finishes." )
            }
        }
    }
    catch (Throwable ex) {
        println("[error] Unable to finalize the PCA service. It was already finished?" )
    }
    catch (Exception ex) {
        println("[error] Unable to finalize the PCA service. It was already finished?" )
    }
}

println("END " + variables.get("PA_TASK_NAME"))
]]>
          </code>
          <arguments>
            <argument value="TENSORBOARD_INSTANCE_NAME"/>
          </arguments>
        </script>
      </scriptExecutable>
      <controlFlow block="none"/>
      <metadata>
        <positionTop>
            998.234375
        </positionTop>
        <positionLeft>
            767.5
        </positionLeft>
      </metadata>
    </task>
    <task fork="true" name="Stop_If_Visdom_Enabled" onTaskError="cancelJob">
      <variables>
        <variable description="Service instance ID." inherited="false" name="INSTANCE_ID" value=""/>
        <variable description="Service instance name." inherited="false" name="INSTANCE_NAME" value="$VISDOM_INSTANCE_NAME"/>
        <variable advanced="false" description="The action that will be processed regarding the service status." hidden="false" inherited="false" model="PA:CATALOG_OBJECT(Workflow/psa,,,%Visdom)" name="SERVICE_ACTION_WORKFLOW" value="service-automation/Finish_Visdom"/>
      </variables>
      <genericInformation>
        <info name="task.icon" value="/automation-dashboard/styles/patterns/img/wf-icons/visdom.png"/>
        <info name="task.documentation" value="PSA/PSAUserGuide.html"/>
      </genericInformation>
      <depends>
        <task ref="Wait_Signal_If_Services_Enabled"/>
      </depends>
      <scriptExecutable>
        <script>
          <code language="groovy">
            <![CDATA[
import org.ow2.proactive.pca.service.client.ApiClient
import org.ow2.proactive.pca.service.client.api.CatalogRestApi
import org.ow2.proactive.pca.service.client.api.ServiceInstanceRestApi
import org.ow2.proactive.pca.service.client.model.CloudAutomationWorkflow
import org.ow2.proactive.pca.service.client.model.ServiceDescription
import java.util.concurrent.TimeoutException
import com.google.common.base.Strings

println("BEGIN " + variables.get("PA_TASK_NAME"))

// Check Visdom support
def VISDOM_ENABLED = false
if ("true".equalsIgnoreCase(variables.get("VISDOM_ENABLED"))) {
    VISDOM_ENABLED = true
}

if (VISDOM_ENABLED) {
    try {
        // Get schedulerapi access
        schedulerapi.connect()

        // Acquire session id
        def sessionId = schedulerapi.getSession()

        // Define PCA URL
        def pcaUrl = variables.get('PA_CLOUD_AUTOMATION_REST_URL')

        // Connect to APIs
        def apiClient = new ApiClient()
        apiClient.setBasePath(pcaUrl)
        //apiClient.setDebugging(true)
        def serviceInstanceRestApi = new ServiceInstanceRestApi(apiClient)
        def instanceName = variables.get("INSTANCE_NAME")
        def instanceId = (!variables.get("INSTANCE_ID") && instanceName)? variables.get("INSTANCE_ID_" + instanceName) : variables.get("INSTANCE_ID")
        if (!instanceId && !instanceName){
            throw new IllegalArgumentException("You have to specify an INSTANCE_NAME or an INSTANCE_ID. Empty value for both is not allowed.");
        }

        println("INSTANCE_ID: " + instanceId)

        def bucketName
        def isActionExists = false
        def catalogRestApi = new CatalogRestApi(apiClient)
        def actionVariables = new HashMap()

        def action = variables.get("ACTION")
        def serviceActionWorkflow = variables.get("SERVICE_ACTION_WORKFLOW")

        if (Strings.isNullOrEmpty(action) && Strings.isNullOrEmpty(serviceActionWorkflow)) {
            throw new IllegalArgumentException("You have to provide an ACTION value or a SERVICE_ACTION_WORKFLOW. Empty value is not allowed.");
        }

        if (!Strings.isNullOrEmpty(action)) {
            List<CloudAutomationWorkflow> listExecutableActions = catalogRestApi.listExecutableActionsByInstanceId(sessionId, Long.parseLong(instanceId)).get(instanceId.toString())
            for (CloudAutomationWorkflow actionIterator : listExecutableActions) {
                if (actionIterator.getName().equals(action)){
                    bucketName = actionIterator.getBucket()
                    //retrieve default action variables
                    actionVariables = actionIterator.getVariables().collectEntries {var -> [var.getName(), var.getValue()]}
                    isActionExists = true
                    break
                }
            }
        } else if (!Strings.isNullOrEmpty(serviceActionWorkflow)) {
            def serviceActionWorkflowSplits = serviceActionWorkflow.split('/')
            bucketName = serviceActionWorkflowSplits[0]
            action = serviceActionWorkflowSplits[1]
            CloudAutomationWorkflow executableAction = catalogRestApi.getExecutableActionByCatalogObject(sessionId, instanceId, bucketName, action)
            println("Action Bucket_name: " + bucketName + ", Action_workflow_name: " + action)
            if (executableAction != null) {
                actionVariables = executableAction.getVariables().collectEntries {var -> [var.getName(), var.getValue()]}
                isActionExists = true
            }
        }

        if(!isActionExists){
            throw new IllegalArgumentException("The provided ACTION: " + action + " does not belong to the existing possible actions that can be applied to the current state of the service. You have to specify a valid action.")
        }

        // Retrieve and update workflow variables
        if (binding.variables["args"]){
            for (String var: args){
                actionVariables.put(var, variables.get(var))
            }
        }

        // Execute action on service
        ServiceDescription service = new ServiceDescription()
        service.setBucketName(bucketName)
        service.setWorkflowName(action)
        if( !actionVariables.isEmpty() ){
            actionVariables.each{ k, v -> service.putVariablesItem("${k}", "${v}") }
        }
        def serviceInstanceData = serviceInstanceRestApi.launchServiceInstanceAction(sessionId, Long.parseLong(instanceId), service, Integer.parseInt(variables.get("PA_JOB_ID")))

        if (action.toLowerCase().contains("finish")) {
            try {
                schedulerapi.waitForJob(serviceInstanceData.getJobSubmissions().get(0).getJobId().toString(), 180000)
            } catch (TimeoutException toe) {
                println("[warning] Timeout reached. Disable to wait until the PCA service " + instanceId + " finishes." )
            }
        }
    }
    catch (Throwable ex) {
        println("[error] Unable to finalize the PCA service. It was already finished?" )
    }
    catch (Exception ex) {
        println("[error] Unable to finalize the PCA service. It was already finished?" )
    }
}

println("END " + variables.get("PA_TASK_NAME"))
]]>
          </code>
          <arguments>
            <argument value="VISDOM_INSTANCE_NAME"/>
          </arguments>
        </script>
      </scriptExecutable>
      <controlFlow block="none"/>
      <metadata>
        <positionTop>
            998.234375
        </positionTop>
        <positionLeft>
            969.5
        </positionLeft>
      </metadata>
    </task>
    <task fork="true" name="Wait_Signal_If_Services_Enabled">
      <description>
        <![CDATA[ The simplest task, ran by a Groovy engine. ]]>
      </description>
      <depends>
        <task ref="Loop"/>
      </depends>
      <scriptExecutable>
        <script>
          <code language="groovy">
            <![CDATA[
import com.google.common.base.Splitter;

println("BEGIN " + variables.get("PA_TASK_NAME"))

// Remove Stop_Optimization signal
Set prevSignalsSet = variables.get("SIGNALS_SET")
signalapi.removeManySignals(new HashSet<>(prevSignalsSet.collect { signal -> "ready_"+signal }))

// Check Tensorboard support
def TENSORBOARD_ENABLED = false
if ("true".equalsIgnoreCase(variables.get("TENSORBOARD_ENABLED"))) {
    TENSORBOARD_ENABLED = true
}

// Check Visdom support
def VISDOM_ENABLED = false
if ("true".equalsIgnoreCase(variables.get("VISDOM_ENABLED"))) {
    VISDOM_ENABLED = true
}

if (TENSORBOARD_ENABLED || VISDOM_ENABLED) {
    // Read the variable SIGNALS
    signals = "Terminate_Job_And_Services"

    // Split the value of the variable SIGNALS and transform it into a list
    Set signalsSet = new HashSet<>(Splitter.on(',').trimResults().omitEmptyStrings().splitToList(signals))

    // Send a ready notification for each signal in the set
    println("[signal] Ready for signals "+ signalsSet)
    signalsSet.each { signal ->
        signalapi.readyForSignal(signal)
    }

    // Wait until one signal among those specified is received
    println("[signal] Waiting for any signal among "+ signalsSet)
    receivedSignal = signalapi.waitForAny(signalsSet)

    // Remove ready signals
    signalapi.removeManySignals(new HashSet<>(signalsSet.collect { signal -> "ready_"+signal }))

    // Display the received signal and add it to the job result
    println("[signal] Received signal: "+ receivedSignal.getName())
}

println("END " + variables.get("PA_TASK_NAME"))
]]>
          </code>
        </script>
      </scriptExecutable>
      <metadata>
        <positionTop>
            870.234375
        </positionTop>
        <positionLeft>
            868.5
        </positionLeft>
      </metadata>
    </task>
  </taskFlow>
  <metadata>
    <visualization>
      <![CDATA[ <html>
    <head>
    <link rel="stylesheet" href="/studio/styles/studio-standalone.css">
        <style>
        #workflow-designer {
            left:0 !important;
            top:0 !important;
            width:2970px;
            height:4484px;
            }
        </style>
    </head>
    <body>
    <div id="workflow-visualization-view"><div id="workflow-visualization" style="position:relative;top:26.765625px;left:-160px"><div class="task ui-draggable _jsPlumb_endpoint_anchor_" id="jsPlumb_1_407" style="top: 742.235px; left: 504.25px;"><a class="task-name" data-toggle="tooltip" data-placement="right" title="This task defines some input, here strings to be processed."><img src="/automation-dashboard/styles/patterns/img/wf-icons/controls_replicate.png" width="20px">&nbsp;<span class="name">Split</span></a>&nbsp;&nbsp;<a id="called-icon-a" href="javascript:void(0)" class="pointer" style=" position: inherit; top: 17px; right: 3px;"><i title="Workflows being Called by this Task" id="called-icon" class="glyphicon glyphicon-arrow-right"></i></a><a title="Scripts being Called by this Task" id="reference-icon-a" href="javascript:void(0)" class="pointer" style=" position: inherit; top: -7px; right: 3px;"><i id="reference-icon" class="glyphicon glyphicon-list-alt"></i></a></div><div class="task ui-draggable _jsPlumb_endpoint_anchor_" id="jsPlumb_1_410" style="top: 870.235px; left: 504.25px;"><a class="task-name" data-toggle="tooltip" data-placement="right" title="This task will be replicated according to the 'runs' value specified in the replication script.
The replication index is used in each task's instance to select the input."><img src="/automation-dashboard/styles/patterns/img/wf-icons/controls_submit_job_no_wait.png" width="20px">&nbsp;<span class="name">Submit_Job_No_Wait</span></a>&nbsp;&nbsp;<a id="called-icon-a" href="javascript:void(0)" class="pointer" style=" position: inherit; top: 17px; right: 3px;"><i title="Workflows being Called by this Task" id="called-icon" class="glyphicon glyphicon-arrow-right"></i></a><a title="Scripts being Called by this Task" id="reference-icon-a" href="javascript:void(0)" class="pointer" style=" position: inherit; top: -7px; right: 3px;"><i id="reference-icon"></i></a></div><div class="task block-end ui-draggable _jsPlumb_endpoint_anchor_" id="jsPlumb_1_413" style="top: 998.238px; left: 504.25px;"><a class="task-name" data-toggle="tooltip" data-placement="right" title="As a merge operation, we simply print the results from previous tasks."><img src="/automation-dashboard/styles/patterns/img/wf-icons/controls_replicate.png" width="20px">&nbsp;<span class="name">Merge</span></a>&nbsp;&nbsp;<a id="called-icon-a" href="javascript:void(0)" class="pointer" style=" position: inherit; top: 17px; right: 3px;"><i title="Workflows being Called by this Task" id="called-icon"></i></a><a title="Scripts being Called by this Task" id="reference-icon-a" href="javascript:void(0)" class="pointer" style=" position: inherit; top: -7px; right: 3px;"><i id="reference-icon" class="glyphicon glyphicon-list-alt"></i></a></div><div class="task block-start ui-draggable _jsPlumb_endpoint_anchor_" id="jsPlumb_1_416" style="top: 360.235px; left: 611px;"><a class="task-name" data-toggle="tooltip" data-placement="right" title="This task has no description"><img src="/automation-dashboard/styles/patterns/img/wf-icons/controls_loop.png" width="20px">&nbsp;<span class="name">Start</span></a>&nbsp;&nbsp;<a id="called-icon-a" href="javascript:void(0)" class="pointer" style=" position: inherit; top: 17px; right: 3px;"><i title="Workflows being Called by this Task" id="called-icon"></i></a><a title="Scripts being Called by this Task" id="reference-icon-a" href="javascript:void(0)" class="pointer" style=" position: inherit; top: -7px; right: 3px;"><i id="reference-icon"></i></a></div><div class="task block-end ui-draggable _jsPlumb_endpoint_anchor_" id="jsPlumb_1_419" style="top: 742.235px; left: 777.5px;"><a class="task-name" data-toggle="tooltip" data-placement="right" title="This task has no description"><img src="/automation-dashboard/styles/patterns/img/wf-icons/controls_loop.png" width="20px">&nbsp;<span class="name">Loop</span></a>&nbsp;&nbsp;<a id="called-icon-a" href="javascript:void(0)" class="pointer" style=" position: inherit; top: 17px; right: 3px;"><i title="Workflows being Called by this Task" id="called-icon"></i></a><a title="Scripts being Called by this Task" id="reference-icon-a" href="javascript:void(0)" class="pointer" style=" position: inherit; top: -7px; right: 3px;"><i id="reference-icon"></i></a></div><div class="task ui-draggable _jsPlumb_endpoint_anchor_" id="jsPlumb_1_422" style="top: 106.235px; left: 165.015px;"><a class="task-name" data-toggle="tooltip" data-placement="right" title="This task aims to parse PCA endpoint in order to retrieve a HOST and a PORT number to use them as an input in the data connector tasks."><img src="/studio/images/Groovy.png" width="20px">&nbsp;<span class="name">Parse_MongoDB_Endpoint</span></a>&nbsp;&nbsp;<a id="called-icon-a" href="javascript:void(0)" class="pointer" style=" position: inherit; top: 17px; right: 3px;"><i title="Workflows being Called by this Task" id="called-icon"></i></a><a title="Scripts being Called by this Task" id="reference-icon-a" href="javascript:void(0)" class="pointer" style=" position: inherit; top: -7px; right: 3px;"><i id="reference-icon"></i></a></div><div class="task _jsPlumb_endpoint_anchor_ ui-draggable" id="jsPlumb_1_425" style="top: -21.781px; left: 165.015px;"><a class="task-name" data-toggle="tooltip" data-placement="right" title="Start the MongoDB server as a service."><img src="/automation-dashboard/styles/patterns/img/wf-icons/mongodb.png" width="20px">&nbsp;<span class="name">Start_MongoDB</span></a>&nbsp;&nbsp;<a id="called-icon-a" href="javascript:void(0)" class="pointer" style=" position: inherit; top: 17px; right: 3px;"><i title="Workflows being Called by this Task" id="called-icon" class="glyphicon glyphicon-arrow-right"></i></a><a title="Scripts being Called by this Task" id="reference-icon-a" href="javascript:void(0)" class="pointer" style=" position: inherit; top: -7px; right: 3px;"><i id="reference-icon" class="glyphicon glyphicon-list-alt"></i></a></div><div class="task ui-draggable _jsPlumb_endpoint_anchor_" id="jsPlumb_1_428" style="top: 234.235px; left: 611px;"><a class="task-name" data-toggle="tooltip" data-placement="right" title="The simplest task, ran by a Groovy engine."><img src="/studio/images/Groovy.png" width="20px">&nbsp;<span class="name">Join_Task</span></a>&nbsp;&nbsp;<a id="called-icon-a" href="javascript:void(0)" class="pointer" style=" position: inherit; top: 17px; right: 3px;"><i title="Workflows being Called by this Task" id="called-icon"></i></a><a title="Scripts being Called by this Task" id="reference-icon-a" href="javascript:void(0)" class="pointer" style=" position: inherit; top: -7px; right: 3px;"><i id="reference-icon"></i></a></div><div class="task ui-draggable _jsPlumb_endpoint_anchor_" id="jsPlumb_1_431" style="top: 870.235px; left: 679.5px;"><a class="task-name" data-toggle="tooltip" data-placement="right" title="This task has no description"><img src="/automation-dashboard/styles/patterns/img/wf-icons/mongodb.png" width="20px">&nbsp;<span class="name">Stop_MongoDB</span></a>&nbsp;&nbsp;<a id="called-icon-a" href="javascript:void(0)" class="pointer" style=" position: inherit; top: 17px; right: 3px;"><i title="Workflows being Called by this Task" id="called-icon" class="glyphicon glyphicon-arrow-right"></i></a><a title="Scripts being Called by this Task" id="reference-icon-a" href="javascript:void(0)" class="pointer" style=" position: inherit; top: -7px; right: 3px;"><i id="reference-icon" class="glyphicon glyphicon-list-alt"></i></a></div><div class="task ui-draggable _jsPlumb_endpoint_anchor_" id="jsPlumb_1_434" style="top: 486.235px; left: 558px;"><a class="task-name" data-toggle="tooltip" data-placement="right" title="This task has no description"><img src="/automation-dashboard/styles/patterns/img/wf-icons/controls_if.png" width="20px">&nbsp;<span class="name">Check_Algorithm_Condition</span></a>&nbsp;&nbsp;<a id="called-icon-a" href="javascript:void(0)" class="pointer" style=" position: inherit; top: 17px; right: 3px;"><i title="Workflows being Called by this Task" id="called-icon"></i></a><a title="Scripts being Called by this Task" id="reference-icon-a" href="javascript:void(0)" class="pointer" style=" position: inherit; top: -7px; right: 3px;"><i id="reference-icon"></i></a></div><div class="task block-start ui-draggable _jsPlumb_endpoint_anchor_" id="jsPlumb_1_437" style="top: 614.235px; left: 333.265px;"><a class="task-name" data-toggle="tooltip" data-placement="right" title="This task has no description"><img src="/automation-dashboard/styles/patterns/img/wf-icons/controls_if.png" width="20px">&nbsp;<span class="name">If_Bayes</span></a>&nbsp;&nbsp;<a id="called-icon-a" href="javascript:void(0)" class="pointer" style=" position: inherit; top: 17px; right: 3px;"><i title="Workflows being Called by this Task" id="called-icon"></i></a><a title="Scripts being Called by this Task" id="reference-icon-a" href="javascript:void(0)" class="pointer" style=" position: inherit; top: -7px; right: 3px;"><i id="reference-icon"></i></a></div><div class="task block-start ui-draggable _jsPlumb_endpoint_anchor_" id="jsPlumb_1_440" style="top: 614.235px; left: 504.25px;"><a class="task-name" data-toggle="tooltip" data-placement="right" title="This task has no description"><img src="/automation-dashboard/styles/patterns/img/wf-icons/controls_if.png" width="20px">&nbsp;<span class="name">Else</span></a>&nbsp;&nbsp;<a id="called-icon-a" href="javascript:void(0)" class="pointer" style=" position: inherit; top: 17px; right: 3px;"><i title="Workflows being Called by this Task" id="called-icon"></i></a><a title="Scripts being Called by this Task" id="reference-icon-a" href="javascript:void(0)" class="pointer" style=" position: inherit; top: -7px; right: 3px;"><i id="reference-icon"></i></a></div><div class="task ui-draggable _jsPlumb_endpoint_anchor_" id="jsPlumb_1_443" style="top: 614.235px; left: 724.5px;"><a class="task-name" data-toggle="tooltip" data-placement="right" title="This task has no description"><img src="/automation-dashboard/styles/patterns/img/wf-icons/controls_if.png" width="20px">&nbsp;<span class="name">Finally</span></a>&nbsp;&nbsp;<a id="called-icon-a" href="javascript:void(0)" class="pointer" style=" position: inherit; top: 17px; right: 3px;"><i title="Workflows being Called by this Task" id="called-icon"></i></a><a title="Scripts being Called by this Task" id="reference-icon-a" href="javascript:void(0)" class="pointer" style=" position: inherit; top: -7px; right: 3px;"><i id="reference-icon"></i></a></div><div class="task block-end ui-draggable _jsPlumb_endpoint_anchor_" id="jsPlumb_1_446" style="top: 742.235px; left: 333.265px;"><a class="task-name" data-toggle="tooltip" data-placement="right" title="The simplest task, ran by a Python engine."><img src="/automation-dashboard/styles/patterns/img/wf-icons/controls_replicate.png" width="20px">&nbsp;<span class="name">Split_Submit_Job_and_Wait</span></a>&nbsp;&nbsp;<a id="called-icon-a" href="javascript:void(0)" class="pointer" style=" position: inherit; top: 17px; right: 3px;"><i title="Workflows being Called by this Task" id="called-icon" class="glyphicon glyphicon-arrow-right"></i></a><a title="Scripts being Called by this Task" id="reference-icon-a" href="javascript:void(0)" class="pointer" style=" position: inherit; top: -7px; right: 3px;"><i id="reference-icon" class="glyphicon glyphicon-list-alt"></i></a></div><div class="task ui-draggable _jsPlumb_endpoint_anchor_" id="jsPlumb_1_449" style="top: -21.781px; left: 541.5px;"><a class="task-name" data-toggle="tooltip" data-placement="right" title="This task has no description"><img src="/automation-dashboard/styles/patterns/img/wf-icons/controls_if.png" width="20px">&nbsp;<span class="name">Check_Visdom_Support</span></a>&nbsp;&nbsp;<a id="called-icon-a" href="javascript:void(0)" class="pointer" style=" position: inherit; top: 17px; right: 3px;"><i title="Workflows being Called by this Task" id="called-icon"></i></a><a title="Scripts being Called by this Task" id="reference-icon-a" href="javascript:void(0)" class="pointer" style=" position: inherit; top: -7px; right: 3px;"><i id="reference-icon"></i></a></div><div class="task ui-draggable _jsPlumb_endpoint_anchor_" id="jsPlumb_1_452" style="top: 106.235px; left: 334.015px;"><a class="task-name" data-toggle="tooltip" data-placement="right" title="Start the Visdom server as a service."><img src="/automation-dashboard/styles/patterns/img/wf-icons/visdom.png" width="20px">&nbsp;<span class="name">Start_Visdom</span></a>&nbsp;&nbsp;<a id="called-icon-a" href="javascript:void(0)" class="pointer" style=" position: inherit; top: 17px; right: 3px;"><i title="Workflows being Called by this Task" id="called-icon" class="glyphicon glyphicon-arrow-right"></i></a><a title="Scripts being Called by this Task" id="reference-icon-a" href="javascript:void(0)" class="pointer" style=" position: inherit; top: -7px; right: 3px;"><i id="reference-icon" class="glyphicon glyphicon-list-alt"></i></a></div><div class="task ui-draggable _jsPlumb_endpoint_anchor_" id="jsPlumb_1_455" style="top: 106.235px; left: 472px;"><a class="task-name" data-toggle="tooltip" data-placement="right" title="This task has no description"><img src="/studio/images/Groovy.png" width="20px">&nbsp;<span class="name">Nothing1</span></a>&nbsp;&nbsp;<a id="called-icon-a" href="javascript:void(0)" class="pointer" style=" position: inherit; top: 17px; right: 3px;"><i title="Workflows being Called by this Task" id="called-icon"></i></a><a title="Scripts being Called by this Task" id="reference-icon-a" href="javascript:void(0)" class="pointer" style=" position: inherit; top: -7px; right: 3px;"><i id="reference-icon"></i></a></div><div class="task ui-draggable _jsPlumb_endpoint_anchor_" id="jsPlumb_1_458" style="top: 106.235px; left: 611px;"><a class="task-name" data-toggle="tooltip" data-placement="right" title="This task has no description"><img src="/studio/images/Python.png" width="20px">&nbsp;<span class="name">Continuation1</span></a>&nbsp;&nbsp;<a id="called-icon-a" href="javascript:void(0)" class="pointer" style=" position: inherit; top: 17px; right: 3px;"><i title="Workflows being Called by this Task" id="called-icon"></i></a><a title="Scripts being Called by this Task" id="reference-icon-a" href="javascript:void(0)" class="pointer" style=" position: inherit; top: -7px; right: 3px;"><i id="reference-icon" class="glyphicon glyphicon-list-alt"></i></a></div><div class="task ui-draggable _jsPlumb_endpoint_anchor_" id="jsPlumb_1_461" style="top: -21.781px; left: 980.5px;"><a class="task-name" data-toggle="tooltip" data-placement="right" title="This task has no description"><img src="/automation-dashboard/styles/patterns/img/wf-icons/controls_if.png" width="20px">&nbsp;<span class="name">Check_Tensorboard_Support</span></a>&nbsp;&nbsp;<a id="called-icon-a" href="javascript:void(0)" class="pointer" style=" position: inherit; top: 17px; right: 3px;"><i title="Workflows being Called by this Task" id="called-icon"></i></a><a title="Scripts being Called by this Task" id="reference-icon-a" href="javascript:void(0)" class="pointer" style=" position: inherit; top: -7px; right: 3px;"><i id="reference-icon"></i></a></div><div class="task ui-draggable _jsPlumb_endpoint_anchor_" id="jsPlumb_1_464" style="top: 106.235px; left: 911px;"><a class="task-name" data-toggle="tooltip" data-placement="right" title="This task has no description"><img src="/studio/images/Groovy.png" width="20px">&nbsp;<span class="name">Nothing2</span></a>&nbsp;&nbsp;<a id="called-icon-a" href="javascript:void(0)" class="pointer" style=" position: inherit; top: 17px; right: 3px;"><i title="Workflows being Called by this Task" id="called-icon"></i></a><a title="Scripts being Called by this Task" id="reference-icon-a" href="javascript:void(0)" class="pointer" style=" position: inherit; top: -7px; right: 3px;"><i id="reference-icon"></i></a></div><div class="task ui-draggable _jsPlumb_endpoint_anchor_" id="jsPlumb_1_467" style="top: 106.235px; left: 1050px;"><a class="task-name" data-toggle="tooltip" data-placement="right" title="This task has no description"><img src="/studio/images/Groovy.png" width="20px">&nbsp;<span class="name">Continuation2</span></a>&nbsp;&nbsp;<a id="called-icon-a" href="javascript:void(0)" class="pointer" style=" position: inherit; top: 17px; right: 3px;"><i title="Workflows being Called by this Task" id="called-icon"></i></a><a title="Scripts being Called by this Task" id="reference-icon-a" href="javascript:void(0)" class="pointer" style=" position: inherit; top: -7px; right: 3px;"><i id="reference-icon"></i></a></div><div class="task ui-draggable _jsPlumb_endpoint_anchor_" id="jsPlumb_1_470" style="top: 106.235px; left: 761.5px;"><a class="task-name" data-toggle="tooltip" data-placement="right" title="Start the Tensorboard server as a service."><img src="/automation-dashboard/styles/patterns/img/wf-icons/tensorboard.png" width="20px">&nbsp;<span class="name">Start_Tensorboard</span></a>&nbsp;&nbsp;<a id="called-icon-a" href="javascript:void(0)" class="pointer" style=" position: inherit; top: 17px; right: 3px;"><i title="Workflows being Called by this Task" id="called-icon" class="glyphicon glyphicon-arrow-right"></i></a><a title="Scripts being Called by this Task" id="reference-icon-a" href="javascript:void(0)" class="pointer" style=" position: inherit; top: -7px; right: 3px;"><i id="reference-icon" class="glyphicon glyphicon-list-alt"></i></a></div><div class="task ui-draggable _jsPlumb_endpoint_anchor_" id="jsPlumb_1_473" style="top: 998.238px; left: 767.5px;"><a class="task-name" data-toggle="tooltip" data-placement="right" title=""><img src="/automation-dashboard/styles/patterns/img/wf-icons/tensorboard.png" width="20px">&nbsp;<span class="name">Stop_If_Tensorboard_Enabled</span></a>&nbsp;&nbsp;<a id="called-icon-a" href="javascript:void(0)" class="pointer" style=" position: inherit; top: 17px; right: 3px;"><i title="Workflows being Called by this Task" id="called-icon" class="glyphicon glyphicon-arrow-right"></i></a><a title="Scripts being Called by this Task" id="reference-icon-a" href="javascript:void(0)" class="pointer" style=" position: inherit; top: -7px; right: 3px;"><i id="reference-icon"></i></a></div><div class="task ui-draggable _jsPlumb_endpoint_anchor_" id="jsPlumb_1_476" style="top: 998.238px; left: 969.5px;"><a class="task-name" data-toggle="tooltip" data-placement="right" title=""><img src="/automation-dashboard/styles/patterns/img/wf-icons/visdom.png" width="20px">&nbsp;<span class="name">Stop_If_Visdom_Enabled</span></a>&nbsp;&nbsp;<a id="called-icon-a" href="javascript:void(0)" class="pointer" style=" position: inherit; top: 17px; right: 3px;"><i title="Workflows being Called by this Task" id="called-icon" class="glyphicon glyphicon-arrow-right"></i></a><a title="Scripts being Called by this Task" id="reference-icon-a" href="javascript:void(0)" class="pointer" style=" position: inherit; top: -7px; right: 3px;"><i id="reference-icon"></i></a></div><div class="task ui-draggable _jsPlumb_endpoint_anchor_" id="jsPlumb_1_479" style="top: 870.235px; left: 868.5px;"><a class="task-name" data-toggle="tooltip" data-placement="right" title="The simplest task, ran by a Groovy engine."><img src="/studio/images/Groovy.png" width="20px">&nbsp;<span class="name">Wait_Signal_If_Services_Enabled</span></a>&nbsp;&nbsp;<a id="called-icon-a" href="javascript:void(0)" class="pointer" style=" position: inherit; top: 17px; right: 3px;"><i title="Workflows being Called by this Task" id="called-icon"></i></a><a title="Scripts being Called by this Task" id="reference-icon-a" href="javascript:void(0)" class="pointer" style=" position: inherit; top: -7px; right: 3px;"><i id="reference-icon"></i></a></div><svg style="position:absolute;left:538.9817132113825px;top:653.5px" width="15.518286788617468" height="89" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector "><path d="M 0 88 C -10 38 -10 50 0 0 " transform="translate(15.018286788617468,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#666" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M-4.427999999999998,66.303232 L-1.2615185838583702,45.35154005301801 L-7.026331880366543,52.546463795240896 L-15.018286788617468,47.94987193338456 L-4.427999999999998,66.303232" class="" stroke="#666" fill="#666" transform="translate(15.018286788617468,0.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M-4.427999999999998,66.303232 L-1.2615185838583702,45.35154005301801 L-7.026331880366543,52.546463795240896 L-15.018286788617468,47.94987193338456 L-4.427999999999998,66.303232" class="" stroke="#666" fill="#666" transform="translate(15.018286788617468,0.5)"></path></svg><svg style="position:absolute;left:573.5px;top:771.5px" width="50.60000000000002" height="99" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector"><path d="M 29.600000000000023 88 C 39.60000000000002 88 -10 -10 0 0 " transform="translate(10.5,10.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#e5db3d" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M29.118831200000024,76.942366 L29.218165055102745,55.75297873218996 L24.555921460987502,63.706813321187354 L15.982612376290097,60.315888471202484 L29.118831200000024,76.942366" class="" stroke="rgba(229,219,61,0.5)" fill="rgba(229,219,61,0.5)" transform="translate(10.5,10.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M29.118831200000024,76.942366 L29.218165055102745,55.75297873218996 L24.555921460987502,63.706813321187354 L15.982612376290097,60.315888471202484 L29.118831200000024,76.942366" class="" stroke="rgba(229,219,61,0.5)" fill="rgba(229,219,61,0.5)" transform="translate(10.5,10.5)"></path></svg><div class="_jsPlumb_overlay l1 component label" id="jsPlumb_1_490" style="position: absolute; transform: translate(-50%, -50%); left: 598.3px; top: 821.75px;">replicate</div><svg style="position:absolute;left:543.5px;top:781.5px" width="39.5" height="89" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector "><path d="M 18.5 88 C 28.5 38 -10 50 0 0 " transform="translate(10.5,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#666" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M19.751504,66.303232 L21.19401443018702,45.162769288441346 L16.036888353495808,52.805023578185406 L7.695806008372434,48.87738493494553 L19.751504,66.303232" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M19.751504,66.303232 L21.19401443018702,45.162769288441346 L16.036888353495808,52.805023578185406 L7.695806008372434,48.87738493494553 L19.751504,66.303232" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path></svg><svg style="position:absolute;left:543.5px;top:909.5px" width="39.5" height="89" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector"><path d="M 0 88 C -10 38 28.5 50 18.5 0 " transform="translate(10.5,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#666" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M-1.2515040000000008,66.303232 L10.804193991627564,48.87738493494553 L2.4631116465041876,52.805023578185406 L-2.6940144301870257,45.162769288441346 L-1.2515040000000008,66.303232" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M-1.2515040000000008,66.303232 L10.804193991627564,48.87738493494553 L2.4631116465041876,52.805023578185406 L-2.6940144301870257,45.162769288441346 L-1.2515040000000008,66.303232" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path></svg><svg style="position:absolute;left:645.9783554952701px;top:273.5px" width="15.521644504729927" height="87" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector "><path d="M 0 86 C -10 36 -10 50 0 0 " transform="translate(15.021644504729927,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#666" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M-4.331249999999999,64.94400000000002 L-1.2792764656232984,43.975321988607305 L-7.004697339623629,51.20163196089339 L-15.021644504729927,46.64876932823094 L-4.331249999999999,64.94400000000002" class="" stroke="#666" fill="#666" transform="translate(15.021644504729927,0.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M-4.331249999999999,64.94400000000002 L-1.2792764656232984,43.975321988607305 L-7.004697339623629,51.20163196089339 L-15.021644504729927,46.64876932823094 L-4.331249999999999,64.94400000000002" class="" stroke="#666" fill="#666" transform="translate(15.021644504729927,0.5)"></path></svg><svg style="position:absolute;left:764.5px;top:653.5px" width="74" height="89" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector "><path d="M 53 88 C 63 38 -10 50 0 0 " transform="translate(10.5,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#666" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M50.368,64.44800000000001 L43.56780946572745,44.37918317644038 L41.74707038239386,53.41715358967042 L32.53696305539786,53.00011279404653 L50.368,64.44800000000001" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M50.368,64.44800000000001 L43.56780946572745,44.37918317644038 L41.74707038239386,53.41715358967042 L32.53696305539786,53.00011279404653 L50.368,64.44800000000001" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path></svg><svg style="position:absolute;left:710.5px;top:349.5px" width="168" height="443" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector "><path d="M 0 0 C 50 -50 157 392 167 342 " transform="translate(0.5,50.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#316b31" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M52.02579200000002,52.11763200000002 L66.73673558555049,67.36847259397226 L57.870963104108824,64.83903030221866 L54.01533728333185,73.21364369808106 L52.02579200000002,52.11763200000002" class="" stroke="#316b31" fill="#316b31" transform="translate(0.5,50.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M52.02579200000002,52.11763200000002 L66.73673558555049,67.36847259397226 L57.870963104108824,64.83903030221866 L54.01533728333185,73.21364369808106 L52.02579200000002,52.11763200000002" class="" stroke="#316b31" fill="#316b31" transform="translate(0.5,50.5)"></path></svg><div class="_jsPlumb_overlay l1 component label" id="jsPlumb_1_508" style="position: absolute; transform: translate(-50%, -50%); left: 809px; top: 570.5px;">loop</div><svg style="position:absolute;left:210.5px;top:17.5px" width="46" height="89" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector "><path d="M 25 88 C 35 38 -10 50 0 0 " transform="translate(10.5,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#666" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M25.59935375,65.8307285 L25.249839212925558,44.64399114880849 L20.757116933078812,52.69479524008836 L12.113905953013912,49.486227965729675 L25.59935375,65.8307285" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M25.59935375,65.8307285 L25.249839212925558,44.64399114880849 L20.757116933078812,52.69479524008836 L12.113905953013912,49.486227965729675 L25.59935375,65.8307285" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path></svg><svg style="position:absolute;left:235.5px;top:145.5px" width="436" height="89" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector "><path d="M 415 88 C 425 38 -10 50 0 0 " transform="translate(10.5,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#666" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M338.27328,57.860352000000006 L319.4491669783908,48.13138653857071 L324.4109408880387,55.90189486618597 L317.49070984457677,61.99372565053204 L338.27328,57.860352000000006" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M338.27328,57.860352000000006 L319.4491669783908,48.13138653857071 L324.4109408880387,55.90189486618597 L317.49070984457677,61.99372565053204 L338.27328,57.860352000000006" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path></svg><svg style="position:absolute;left:650.5px;top:145.5px" width="22" height="89" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector "><path d="M 0 88 C -10 38 11 50 1 0 " transform="translate(10.5,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#666" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M-2.73415625,66.78168750000002 L5.087187797721125,47.08837449057529 L-2.1550211532554755,52.793671109542124 L-8.900828592736769,46.50923939383077 L-2.73415625,66.78168750000002" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M-2.73415625,66.78168750000002 L5.087187797721125,47.08837449057529 L-2.1550211532554755,52.793671109542124 L-8.900828592736769,46.50923939383077 L-2.73415625,66.78168750000002" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path></svg><svg style="position:absolute;left:650.5px;top:145.5px" width="461" height="89" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector "><path d="M 0 88 C -10 38 450 50 440 0 " transform="translate(10.5,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#666" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M81.50912000000002,57.860352000000006 L102.258913993454,62.155238404693534 L95.38627186153028,56.009769331749894 L100.40833132520387,48.2780865431633 L81.50912000000002,57.860352000000006" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M81.50912000000002,57.860352000000006 L102.258913993454,62.155238404693534 L95.38627186153028,56.009769331749894 L100.40833132520387,48.2780865431633 L81.50912000000002,57.860352000000006" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path></svg><svg style="position:absolute;left:725px;top:781.5px" width="113.5" height="89" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector "><path d="M 0 88 C -10 38 102.5 50 92.5 0 " transform="translate(10.5,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#666" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M9.063984374999999,62.2538125 L29.46990845470991,56.54432369161135 L20.543113192587278,54.2394752479724 L21.455571202682307,45.06519487402407 L9.063984374999999,62.2538125" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M9.063984374999999,62.2538125 L29.46990845470991,56.54432369161135 L20.543113192587278,54.2394752479724 L21.455571202682307,45.06519487402407 L9.063984374999999,62.2538125" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path></svg><svg style="position:absolute;left:629.5px;top:399.5px" width="42" height="87" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector "><path d="M 0 86 C -10 36 31 50 21 0 " transform="translate(10.5,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#666" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M-1.037664000000001,64.474304 L11.669947692909087,47.51798939268512 L3.185971729393507,51.126611269591855 L-1.6777450374990641,43.29435366329161 L-1.037664000000001,64.474304" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M-1.037664000000001,64.474304 L11.669947692909087,47.51798939268512 L3.185971729393507,51.126611269591855 L-1.6777450374990641,43.29435366329161 L-1.037664000000001,64.474304" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path></svg><svg style="position:absolute;left:322.5px;top:525.5px" width="246" height="89" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector "><path d="M 0 88 C -10 38 235 50 225 0 " transform="translate(10.5,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#00f" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M36.28121625,59.00425649999999 L57.40943807950248,60.61616292511751 L49.80876400483788,55.397949283388996 L53.80313086289148,47.088615170279624 L36.28121625,59.00425649999999" class="" stroke="#00f" fill="#00f" transform="translate(10.5,0.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M36.28121625,59.00425649999999 L57.40943807950248,60.61616292511751 L49.80876400483788,55.397949283388996 L53.80313086289148,47.088615170279624 L36.28121625,59.00425649999999" class="" stroke="#00f" fill="#00f" transform="translate(10.5,0.5)"></path></svg><div class="_jsPlumb_overlay l1 component label" id="jsPlumb_1_528" style="position: absolute; transform: translate(-50%, -50%); left: 445px; top: 569.5px;">if</div><svg style="position:absolute;left:493.5px;top:525.5px" width="75" height="89" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector "><path d="M 0 88 C -10 38 64 50 54 0 " transform="translate(10.5,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#00f" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M2.735999999999998,64.44800000000001 L20.664522571639516,53.15339604951939 L11.451178469737112,53.49146477025559 L9.707987341895093,44.438217579782275 L2.735999999999998,64.44800000000001" class="" stroke="#00f" fill="#00f" transform="translate(10.5,0.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M2.735999999999998,64.44800000000001 L20.664522571639516,53.15339604951939 L11.451178469737112,53.49146477025559 L9.707987341895093,44.438217579782275 L2.735999999999998,64.44800000000001" class="" stroke="#00f" fill="#00f" transform="translate(10.5,0.5)"></path></svg><div class="_jsPlumb_overlay l1 component label" id="jsPlumb_1_532" style="position: absolute; transform: translate(-50%, -50%); left: 530.5px; top: 569.5px;">else</div><svg style="position:absolute;left:547.5px;top:525.5px" width="188" height="89" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector "><path d="M 167 88 C 177 38 -10 50 0 0 " transform="translate(10.5,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#00f" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M143.71875,60.1875 L127.38516590924273,46.68883226017616 L130.5867388999671,55.33463646713483 L122.53230237637756,59.82084336020906 L143.71875,60.1875" class="" stroke="#00f" fill="#00f" transform="translate(10.5,0.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M143.71875,60.1875 L127.38516590924273,46.68883226017616 L130.5867388999671,55.33463646713483 L122.53230237637756,59.82084336020906 L143.71875,60.1875" class="" stroke="#00f" fill="#00f" transform="translate(10.5,0.5)"></path></svg><div class="_jsPlumb_overlay l1 component label" id="jsPlumb_1_536" style="position: absolute; transform: translate(-50%, -50%); left: 641px; top: 569.5px;">continuation</div><svg style="position:absolute;left:372.5px;top:653.5px" width="54" height="89" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector "><path d="M 33 88 C 43 38 -10 50 0 0 " transform="translate(10.5,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#666" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M32.741334,65.364084 L30.316020322158163,44.31371931042578 L26.63437727533633,52.766263570930334 L17.718199893088492,50.42067603508946 L32.741334,65.364084" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M32.741334,65.364084 L30.316020322158163,44.31371931042578 L26.63437727533633,52.766263570930334 L17.718199893088492,50.42067603508946 L32.741334,65.364084" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path></svg><svg style="position:absolute;left:323.5px;top:17.5px" width="229" height="89" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector "><path d="M 0 88 C -10 38 218 50 208 0 " transform="translate(10.5,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#00f" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M32.100224,59.394175999999995 L53.25979596743044,60.52223369140218 L45.54171576979496,55.47929426455329 L49.34491423198373,47.08074192160721 L32.100224,59.394175999999995" class="" stroke="#00f" fill="#00f" transform="translate(10.5,0.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M32.100224,59.394175999999995 L53.25979596743044,60.52223369140218 L45.54171576979496,55.47929426455329 L49.34491423198373,47.08074192160721 L32.100224,59.394175999999995" class="" stroke="#00f" fill="#00f" transform="translate(10.5,0.5)"></path></svg><div class="_jsPlumb_overlay l1 component label" id="jsPlumb_1_545" style="position: absolute; transform: translate(-50%, -50%); left: 437.5px; top: 61.5px;">if</div><svg style="position:absolute;left:461.5px;top:17.5px" width="91" height="89" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector "><path d="M 0 88 C -10 38 80 50 70 0 " transform="translate(10.5,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#00f" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M5.077799999999998,63.554236 L24.38921760733801,54.8324729904362 L15.216918385562117,53.900310458358604 L14.735292065696612,44.69335460487409 L5.077799999999998,63.554236" class="" stroke="#00f" fill="#00f" transform="translate(10.5,0.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M5.077799999999998,63.554236 L24.38921760733801,54.8324729904362 L15.216918385562117,53.900310458358604 L14.735292065696612,44.69335460487409 L5.077799999999998,63.554236" class="" stroke="#00f" fill="#00f" transform="translate(10.5,0.5)"></path></svg><div class="_jsPlumb_overlay l1 component label" id="jsPlumb_1_549" style="position: absolute; transform: translate(-50%, -50%); left: 506.5px; top: 61.5px;">else</div><svg style="position:absolute;left:531.5px;top:17.5px" width="90" height="89" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector "><path d="M 69 88 C 79 38 -10 50 0 0 " transform="translate(10.5,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#00f" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M64.035978,63.554236 L54.507627275196064,44.627785396013834 L53.96308187052173,53.83123422252709 L44.78462549772315,54.700681525492115 L64.035978,63.554236" class="" stroke="#00f" fill="#00f" transform="translate(10.5,0.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M64.035978,63.554236 L54.507627275196064,44.627785396013834 L53.96308187052173,53.83123422252709 L44.78462549772315,54.700681525492115 L64.035978,63.554236" class="" stroke="#00f" fill="#00f" transform="translate(10.5,0.5)"></path></svg><div class="_jsPlumb_overlay l1 component label" id="jsPlumb_1_553" style="position: absolute; transform: translate(-50%, -50%); left: 576px; top: 61.5px;">continuation</div><svg style="position:absolute;left:751.5px;top:17.5px" width="240" height="89" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector "><path d="M 0 88 C -10 38 229 50 219 0 " transform="translate(10.5,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#00f" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M33.944352,59.394175999999995 L55.08715757614283,60.80193037112585 L47.43643549596955,55.657374836198755 L51.35035641234158,47.30984687515631 L33.944352,59.394175999999995" class="" stroke="#00f" fill="#00f" transform="translate(10.5,0.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M33.944352,59.394175999999995 L55.08715757614283,60.80193037112585 L47.43643549596955,55.657374836198755 L51.35035641234158,47.30984687515631 L33.944352,59.394175999999995" class="" stroke="#00f" fill="#00f" transform="translate(10.5,0.5)"></path></svg><div class="_jsPlumb_overlay l1 component label" id="jsPlumb_1_559" style="position: absolute; transform: translate(-50%, -50%); left: 871px; top: 61.5px;">if</div><svg style="position:absolute;left:900.5px;top:17.5px" width="91" height="89" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector "><path d="M 0 88 C -10 38 80 50 70 0 " transform="translate(10.5,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#00f" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M5.077799999999998,63.554236 L24.38921760733801,54.8324729904362 L15.216918385562117,53.900310458358604 L14.735292065696612,44.69335460487409 L5.077799999999998,63.554236" class="" stroke="#00f" fill="#00f" transform="translate(10.5,0.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M5.077799999999998,63.554236 L24.38921760733801,54.8324729904362 L15.216918385562117,53.900310458358604 L14.735292065696612,44.69335460487409 L5.077799999999998,63.554236" class="" stroke="#00f" fill="#00f" transform="translate(10.5,0.5)"></path></svg><div class="_jsPlumb_overlay l1 component label" id="jsPlumb_1_563" style="position: absolute; transform: translate(-50%, -50%); left: 945.5px; top: 61.5px;">else</div><svg style="position:absolute;left:970.5px;top:17.5px" width="90" height="89" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector "><path d="M 69 88 C 79 38 -10 50 0 0 " transform="translate(10.5,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#00f" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M64.035978,63.554236 L54.507627275196064,44.627785396013834 L53.96308187052173,53.83123422252709 L44.78462549772315,54.700681525492115 L64.035978,63.554236" class="" stroke="#00f" fill="#00f" transform="translate(10.5,0.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M64.035978,63.554236 L54.507627275196064,44.627785396013834 L53.96308187052173,53.83123422252709 L44.78462549772315,54.700681525492115 L64.035978,63.554236" class="" stroke="#00f" fill="#00f" transform="translate(10.5,0.5)"></path></svg><div class="_jsPlumb_overlay l1 component label" id="jsPlumb_1_567" style="position: absolute; transform: translate(-50%, -50%); left: 1015px; top: 61.5px;">continuation</div><svg style="position:absolute;left:845px;top:909.5px" width="130" height="89" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector"><path d="M 0 88 C -10 38 119 50 109 0 " transform="translate(10.5,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#666" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M12.370975749999998,61.4125935 L33.182993008414144,57.430139779556825 L24.480295054571336,54.386614139089815 L26.157013647503955,45.320820474985496 L12.370975749999998,61.4125935" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M12.370975749999998,61.4125935 L33.182993008414144,57.430139779556825 L24.480295054571336,54.386614139089815 L26.157013647503955,45.320820474985496 L12.370975749999998,61.4125935" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path></svg><svg style="position:absolute;left:954px;top:909.5px" width="103" height="89" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector "><path d="M 82 88 C 92 38 -10 50 0 0 " transform="translate(10.5,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#666" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M74.722752,62.682047999999995 L63.420378697591296,44.758422313967635 L63.76244054809442,53.9716190279443 L54.7099497255356,55.71873376587322 L74.722752,62.682047999999995" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M74.722752,62.682047999999995 L63.420378697591296,44.758422313967635 L63.76244054809442,53.9716190279443 L54.7099497255356,55.71873376587322 L74.722752,62.682047999999995" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path></svg><svg style="position:absolute;left:817.5px;top:781.5px" width="157.5" height="89" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector "><path d="M 136.5 88 C 146.5 38 -10 50 0 0 " transform="translate(10.5,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#666" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M118.764652125,60.59109050000001 L103.45953239943657,45.93662666858778 L106.02173235075466,54.79298773899732 L97.66142963843387,58.67954644283313 L118.764652125,60.59109050000001" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M118.764652125,60.59109050000001 L103.45953239943657,45.93662666858778 L106.02173235075466,54.79298773899732 L97.66142963843387,58.67954644283313 L118.764652125,60.59109050000001" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path></svg><div class="_jsPlumb_endpoint source-endpoint dependency-source-endpoint connected _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 544px; top: 772px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint target-endpoint dependency-target-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 544px; top: 732px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint replicate-source-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected _jsPlumb_endpoint_full" style="position: absolute; height: 20px; width: 20px; left: 574px; top: 772px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#e5db3d" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint dependency-source-endpoint connected _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 562.5px; top: 900px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint target-endpoint replicate-target-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected _jsPlumb_endpoint_full" style="position: absolute; height: 20px; width: 20px; left: 603.6px; top: 860px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#e5db3d" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint target-endpoint dependency-target-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 562.5px; top: 860px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint dependency-source-endpoint connected _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable" style="position: absolute; height: 20px; width: 20px; left: 544px; top: 1028px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint target-endpoint dependency-target-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 544px; top: 988px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint dependency-source-endpoint connected _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 651px; top: 390px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint target-endpoint dependency-target-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 651px; top: 350px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint target-endpoint loop-target-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected _jsPlumb_endpoint_full" style="position: absolute; height: 20px; width: 20px; left: 701px; top: 390px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#316b31" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint dependency-source-endpoint connected _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 818px; top: 772px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint target-endpoint dependency-target-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 818px; top: 732px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint loop-source-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected _jsPlumb_endpoint_full" style="position: absolute; height: 20px; width: 20px; left: 868px; top: 732px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#316b31" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint dependency-source-endpoint connected _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 236px; top: 136px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint target-endpoint dependency-target-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 236px; top: 96px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint dependency-source-endpoint connected _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 211px; top: 8px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint dependency-source-endpoint connected _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 651px; top: 264px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint target-endpoint dependency-target-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 651px; top: 224px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint dependency-source-endpoint connected _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable" style="position: absolute; height: 20px; width: 20px; left: 725.5px; top: 900px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint target-endpoint dependency-target-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 725.5px; top: 860px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint dependency-source-endpoint connected _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable" style="position: absolute; height: 20px; width: 20px; left: 630px; top: 516px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint target-endpoint dependency-target-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 630px; top: 476px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint if-source-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected _jsPlumb_endpoint_full" style="position: absolute; height: 20px; width: 20px; left: 548px; top: 516px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#00f" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint dependency-source-endpoint connected _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 373px; top: 644px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint target-endpoint if-target-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected _jsPlumb_endpoint_full" style="position: absolute; height: 20px; width: 20px; left: 323px; top: 604px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#00f" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint dependency-source-endpoint connected _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 544px; top: 644px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint target-endpoint if-target-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected _jsPlumb_endpoint_full" style="position: absolute; height: 20px; width: 20px; left: 494px; top: 604px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#00f" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint dependency-source-endpoint connected _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 765px; top: 644px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint target-endpoint if-target-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected _jsPlumb_endpoint_full" style="position: absolute; height: 20px; width: 20px; left: 715px; top: 604px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#00f" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint dependency-source-endpoint connected _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable" style="position: absolute; height: 20px; width: 20px; left: 406px; top: 772px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint target-endpoint dependency-target-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 406px; top: 732px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint dependency-source-endpoint connected _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable" style="position: absolute; height: 20px; width: 20px; left: 606px; top: 8px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint if-source-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected _jsPlumb_endpoint_full" style="position: absolute; height: 20px; width: 20px; left: 532px; top: 8px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#00f" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint dependency-source-endpoint connected _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable" style="position: absolute; height: 20px; width: 20px; left: 374px; top: 136px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint target-endpoint if-target-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected _jsPlumb_endpoint_full" style="position: absolute; height: 20px; width: 20px; left: 324px; top: 96px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#00f" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint dependency-source-endpoint connected _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable" style="position: absolute; height: 20px; width: 20px; left: 512px; top: 136px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint target-endpoint if-target-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected _jsPlumb_endpoint_full" style="position: absolute; height: 20px; width: 20px; left: 462px; top: 96px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#00f" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint dependency-source-endpoint connected _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 652px; top: 136px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint target-endpoint if-target-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected _jsPlumb_endpoint_full" style="position: absolute; height: 20px; width: 20px; left: 601px; top: 96px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#00f" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint dependency-source-endpoint connected _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable" style="position: absolute; height: 20px; width: 20px; left: 1056px; top: 8px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint if-source-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected _jsPlumb_endpoint_full" style="position: absolute; height: 20px; width: 20px; left: 971px; top: 8px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#00f" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint dependency-source-endpoint connected _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable" style="position: absolute; height: 20px; width: 20px; left: 951px; top: 136px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint target-endpoint if-target-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected _jsPlumb_endpoint_full" style="position: absolute; height: 20px; width: 20px; left: 901px; top: 96px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#00f" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint dependency-source-endpoint connected _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 1091px; top: 136px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint target-endpoint if-target-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected _jsPlumb_endpoint_full" style="position: absolute; height: 20px; width: 20px; left: 1040px; top: 96px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#00f" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint dependency-source-endpoint connected _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable" style="position: absolute; height: 20px; width: 20px; left: 813.5px; top: 136px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint target-endpoint if-target-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected _jsPlumb_endpoint_full" style="position: absolute; height: 20px; width: 20px; left: 752px; top: 96px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#00f" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint dependency-source-endpoint connected _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable" style="position: absolute; height: 20px; width: 20px; left: 845.5px; top: 1028px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint target-endpoint dependency-target-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 845.5px; top: 988px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint dependency-source-endpoint connected _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable" style="position: absolute; height: 20px; width: 20px; left: 1036.5px; top: 1028px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint target-endpoint dependency-target-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 1036.5px; top: 988px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint dependency-source-endpoint connected _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 954.5px; top: 900px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint target-endpoint dependency-target-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 954.5px; top: 860px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div></div></div>
    </body>
</html>
 ]]>
    </visualization>
  </metadata>
</job>
