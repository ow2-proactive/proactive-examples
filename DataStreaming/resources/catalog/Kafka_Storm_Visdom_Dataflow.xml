<?xml version="1.0" encoding="UTF-8"?>
<job
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns="urn:proactive:jobdescriptor:3.13" xsi:schemaLocation="urn:proactive:jobdescriptor:3.13 http://www.activeeon.com/public_content/schemas/proactive/jobdescriptor/3.13/schedulerjob.xsd"  name="Kafka_Storm_Visdom_Dataflow" projectName="09. Data Streaming Workflows" priority="normal" onTaskError="continueJobExecution"  maxNumberOfExecution="2"  >
  <variables>
    <variable name="dataflow_name" value="BitcoinExchangeDataflow"/>
    <variable name="execution_duration" value="60"/>
    <variable name="automatic_kill" value="true" model="PA:Boolean"/>
    <variable name="kafka_instance_name" value="kafka-server-$PA_JOB_ID" model="" description="" group="Kafka" advanced="false" hidden="false"/>
    <variable name="kafka_service_id" value="Kafka" model="" description="" group="Kafka" advanced="true" hidden="false"/>
    <variable name="message_topic" value="BitCoinExchangeTopic" model="" description="" group="" advanced="false" hidden="false"/>
    <variable name="storm_instance_name" value="storm-cluster-$PA_JOB_ID" model="" description="" group="Storm" advanced="false" hidden="false"/>
    <variable name="storm_service_id" value="Storm" model="" description="" group="Storm" advanced="true" hidden="false"/>
    <variable name="zookeeper_instance_name" value="zookeeper-server-$PA_JOB_ID" model="" description="" group="Zookeeper" advanced="false" hidden="false"/>
    <variable name="zookeeper_service_id" value="Zookeeper" model="" description="" group="Zookeeper" advanced="true" hidden="false"/>
    <variable name="visdom_instance_name" value="visdom-server-$PA_JOB_ID" model="" description="" group="Visdom" advanced="false" hidden="false"/>
    <variable name="visdom_service_id" value="Visdom" model="" description="" group="Visdom" advanced="true" hidden="false"/>
    <variable name="VISDOM_ENABLE_LOGIN" value="false" model="PA:Boolean" description="" group="Visdom" advanced="false" hidden="false"/>
    <variable name="PROXYFIED" value="true" model="PA:Boolean" description="" group="Visdom" advanced="true" hidden="false"/>
    <variable name="VISDOM_USERNAME" value=""   group="Visdom" advanced="false" hidden="false"/>
    <variable name="VISDOM_PASSWORD" value=""   group="Visdom" advanced="false" hidden="false"/>
  </variables>
  <description>
    <![CDATA[ This workflow calls ProActive-Service-Automation service to deploy instances of (i) Apache Zookeeper coordination server (https://zookeeper.apache.org/), (ii) Apache Kafka publish/subscribe system (https://kafka.apache.org/), and (iii) Apache Storm stream processing system (http://storm.apache.org). It further runs a (Apache Storm) dataflow application that processes a stream of real-time data dealing with the Chinese Yuan to Bitcoin exchange rate. ]]>
  </description>
  <genericInformation>
    <info name="bucketName" value="big-data"/>
    <info name="workflow.icon" value="/automation-dashboard/styles/patterns/img/wf-icons/bigdata.png"/>
    <info name="Documentation" value="https://ow2-proactive.github.io/proactive-examples/DeepLearningWorkflows/resources/doc/V1/ActiveEon-Data+Streaming-Doc.pdf"/>
    <info name="group" value="public-objects"/>
  </genericInformation>
  <taskFlow>
    <task name="Start_Kafka" 
    
    
    
    
    fork="true">
      <genericInformation>
        <info name="task.icon" value="/automation-dashboard/styles/patterns/img/wf-icons/kafka.png"/>
      </genericInformation>
      <depends>
        <task ref="Start_Zookeeper"/>
      </depends>
      <scriptExecutable>
        <script>
          <code language="groovy">
            <![CDATA[
import org.ow2.proactive.pca.service.client.ApiClient
import org.ow2.proactive.pca.service.client.api.ServiceInstanceRestApi
import org.ow2.proactive.pca.service.client.model.ServiceInstanceData
import org.ow2.proactive.pca.service.client.model.ServiceDescription


// Get schedulerapi access
schedulerapi.connect()

// Acquire session id
def session_id = schedulerapi.getSession()
println(session_id)

// Define PCA URL
def pca_url = variables.get('PA_CLOUD_AUTOMATION_REST_URL')

// Connect to APIs
def api_client = new ApiClient()
api_client.setBasePath(pca_url)
//api_client.setDebugging(true)
def service_instance_rest_api = new ServiceInstanceRestApi(api_client)

// Check existing Kafka instances
def kafka_service_id = variables.get("kafka_service_id") 
def kafka_instance_name = variables.get("kafka_instance_name")
boolean instance_exists = false
List<ServiceInstanceData> service_instances = service_instance_rest_api.getServiceInstancesUsingGET(session_id, null)

for (ServiceInstanceData service_instance_data : service_instances) {
  
	if ( (service_instance_data.getServiceId() == kafka_service_id) && (service_instance_data.getInstanceStatus()  == "RUNNING")){
      
      if (service_instance_data.getVariables().get("INSTANCE_NAME") == kafka_instance_name) {
        instance_exists = true
        variables.put("kafka_instance_id", service_instance_data.getInstanceId())
        variables.put("kafka_endpoint", service_instance_data.getDeployments().iterator().next().getEndpoint().getUrl())
        println(variables.get("kafka_endpoint"))
        break
      }
  	}
}

if (!instance_exists){
  def zookeeper_instance_name = variables.get("zookeeper_instance_name")
  def zookeeper_service_id = variables.get("zookeeper_service_id")
  // Prepare kafka description
  ServiceDescription serviceDescription = new ServiceDescription()
  serviceDescription.setBucketName("service-automation")
  serviceDescription.setWorkflowName(kafka_service_id)
  serviceDescription.putVariablesItem("INSTANCE_NAME", kafka_instance_name)
  serviceDescription.putVariablesItem("ZOOKEEPER_INSTANCE_NAME", zookeeper_instance_name)
  serviceDescription.putVariablesItem("ZOOKEEPER_SERVICE_ID", zookeeper_service_id)
  serviceDescription.putVariablesItem("TERMINATE_ZOOKEEPER_ON_FINISH", "false")
  
  // Run kafka
  def service_instance_data = service_instance_rest_api.createRunningServiceInstanceUsingPOST(session_id, serviceDescription, variables.get("PA_JOB_ID"))
  
  // Acquire kafka Instance ID
  def service_instance_id  = service_instance_data.getInstanceId()
  
  // Create synchro channel
  channel = "Service_Instance_" + service_instance_id  
  synchronizationapi.createChannelIfAbsent(channel, false)
  synchronizationapi.waitUntil(channel, "RUNNING", "{k,x -> x == true}")
  
  // Acquire kafka endpoint
  service_instance_data = service_instance_rest_api.getServiceInstanceUsingGET(session_id, service_instance_id)
  variables.put("kafka_instance_id", service_instance_data.getInstanceId())
  variables.put("kafka_endpoint", service_instance_data.getDeployments().iterator().next().getEndpoint().getUrl())
  println(variables.get("kafka_endpoint"))
}
]]>
          </code>
        </script>
      </scriptExecutable>
      <metadata>
        <positionTop>
            210.8125
        </positionTop>
        <positionLeft>
            485.5625
        </positionLeft>
      </metadata>
    </task>
    <task name="Create_Topic" 
    
    
    
    
    fork="true">
      <description>
        <![CDATA[ Create Kafa topic (input of the dataflow) ]]>
      </description>
      <genericInformation>
        <info name="task.icon" value="/automation-dashboard/styles/patterns/img/wf-icons/kafka.png"/>
      </genericInformation>
      <depends>
        <task ref="Start_Kafka"/>
        <task ref="Start_Storm"/>
        <task ref="Start_Visdom_Service"/>
      </depends>
      <scriptExecutable>
        <script>
          <code language="bash">
            <![CDATA[
KAFKA=$variables_kafka_instance_name
TOPIC=$variables_message_topic

res=$(docker exec $KAFKA /opt/kafka/bin/kafka-topics.sh --list --bootstrap-server localhost:9092 | grep $TOPIC)

echo $res

if [[ $res != $TOPIC ]]; then
echo "create kafka topic: $TOPIC"
   docker exec $KAFKA /opt/kafka/bin/kafka-topics.sh --create --topic $TOPIC --replication-factor 1 --partitions 1 --bootstrap-server localhost:9092 --config compression.type=lz4
fi
]]>
          </code>
        </script>
      </scriptExecutable>
      <metadata>
        <positionTop>
            338.796875
        </positionTop>
        <positionLeft>
            655.0625
        </positionLeft>
      </metadata>
    </task>
    <task name="Submit_Dataflow" 
    
    
    
    
    fork="true">
      <description>
        <![CDATA[ Submit Storm topology ]]>
      </description>
      <genericInformation>
        <info name="task.icon" value="/automation-dashboard/styles/patterns/img/wf-icons/storm.png"/>
      </genericInformation>
      <depends>
        <task ref="Create_Topic"/>
      </depends>
      <inputFiles>
        <files  includes="BitcoinExchangeDataflow-1.0.jar" accessMode="transferFromGlobalSpace"/>
        <files  includes="BitcoinExchangeDataflow.yaml" accessMode="transferFromGlobalSpace"/>
        <files  includes="BitcoinExchangeDataflow.properties" accessMode="transferFromGlobalSpace"/>
      </inputFiles>
      <scriptExecutable>
        <script>
          <code language="bash">
            <![CDATA[
NIMBUS=$variables_storm_instance_name"-nimbus"
DATAFLOW=$variables_dataflow_name

ZOOKEEPER_ENDPOINT=$variables_zookeeper_endpoint
KAFKA_ENDPOINT=$variables_kafka_endpoint

echo "kafka.zookeeper.hosts: $ZOOKEEPER_ENDPOINT" >> BitcoinExchangeDataflow.properties
echo "kafka.bootstrap.servers: $KAFKA_ENDPOINT" >> BitcoinExchangeDataflow.properties

docker exec $NIMBUS mkdir -p /topologies

docker cp BitcoinExchangeDataflow-1.0.jar $NIMBUS:/topologies/
docker cp BitcoinExchangeDataflow.yaml $NIMBUS:/topologies/
docker cp BitcoinExchangeDataflow.properties $NIMBUS:/topologies/

##test if dataflow exists
docker exec -i  $NIMBUS storm list | grep -w "$DATAFLOW" && result=$?

if [[ "$result" == 0 ]]; then
	echo "Dataflow $DATAFLOW already exists, killing it"
    docker exec -i  $NIMBUS storm kill $DATAFLOW -w 1
    sleep 10
fi

## deploy dataflow
docker exec -i $NIMBUS storm jar /topologies/BitcoinExchangeDataflow-1.0.jar org.apache.storm.flux.Flux --remote /topologies/BitcoinExchangeDataflow.yaml --filter /topologies/BitcoinExchangeDataflow.properties
]]>
          </code>
        </script>
      </scriptExecutable>
      <metadata>
        <positionTop>
            453.734375
        </positionTop>
        <positionLeft>
            647.71875
        </positionLeft>
      </metadata>
    </task>
    <task name="Vis-Rate" 
    
    
    
    
    fork="true">
      <description>
        <![CDATA[ Send bitcoin rate data to Visdom server ]]>
      </description>
      <genericInformation>
        <info name="task.icon" value="/automation-dashboard/styles/patterns/img/wf-icons/visdom.png"/>
      </genericInformation>
      <depends>
        <task ref="Submit_Dataflow"/>
      </depends>
      <inputFiles>
        <files  includes="visdomRateClient.py" accessMode="transferFromGlobalSpace"/>
      </inputFiles>
      <scriptExecutable>
        <script>
          <code language="bash">
            <![CDATA[
KAFKA=$variables_kafka_instance_name
VISDOM=$variables_visdom_instance_name
TOPIC=BitCoinRateTopic

pyscript=visdomRateClient.py
timeout=$variables_execution_duration

docker cp $pyscript $VISDOM:/root/$pyscript

docker exec $VISDOM /bin/bash -c 'rm rate.pckl'

timeout $timeout docker exec -i $KAFKA /opt/kafka/bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic $TOPIC | \
while read LINE; do
    docker exec $VISDOM /bin/bash -c "python $pyscript --value $LINE"
done

exit 0
]]>
          </code>
        </script>
      </scriptExecutable>
      <metadata>
        <positionTop>
            589.8125
        </positionTop>
        <positionLeft>
            462.296875
        </positionLeft>
      </metadata>
    </task>
    <task name="Vis_Variation" 
    
    
    
    
    fork="true">
      <description>
        <![CDATA[ Send bitcoin rate variation to Visdom server ]]>
      </description>
      <genericInformation>
        <info name="task.icon" value="/automation-dashboard/styles/patterns/img/wf-icons/visdom.png"/>
      </genericInformation>
      <depends>
        <task ref="Submit_Dataflow"/>
      </depends>
      <inputFiles>
        <files  includes="visdomGapClient.py" accessMode="transferFromGlobalSpace"/>
      </inputFiles>
      <scriptExecutable>
        <script>
          <code language="bash">
            <![CDATA[
KAFKA=$variables_kafka_instance_name
VISDOM=$variables_visdom_instance_name
TOPIC=BitCoinGapTopic

pyscript=visdomGapClient.py
timeout=$variables_execution_duration

docker cp $pyscript $VISDOM:/root/$pyscript

docker exec $VISDOM /bin/bash -c 'rm gap.pckl'

timeout $timeout docker exec -i $KAFKA /opt/kafka/bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic $TOPIC | \
while read LINE; do
    docker exec $VISDOM /bin/bash -c "python $pyscript --value $LINE"
done

exit 0
]]>
          </code>
        </script>
      </scriptExecutable>
      <metadata>
        <positionTop>
            589.8125
        </positionTop>
        <positionLeft>
            569.3125
        </positionLeft>
      </metadata>
    </task>
    <task name="View_Result" 
    
    
    
    
    fork="true">
      <description>
        <![CDATA[ Give link to view results on Visdom and dataflow status on Storm ]]>
      </description>
      <depends>
        <task ref="Submit_Dataflow"/>
      </depends>
      <scriptExecutable>
        <script>
          <code language="groovy">
            <![CDATA[
visdomInstanceName =  variables.get("visdom_instance_name")
visdomEndpointKey = "ENDPOINT_" + visdomInstanceName
visdomEndpoint = variables.get(visdomEndpointKey)

result = '<meta http-equiv="refresh" content="1; url=' + visdomEndpoint + '/" />'
result+= '<h2><span style="color:black">Please wait while redirecting...</span></h2>'
resultMetadata.put("content.type", "text/html")
]]>
          </code>
        </script>
      </scriptExecutable>
      <metadata>
        <positionTop>
            586.796875
        </positionTop>
        <positionLeft>
            847.25
        </positionLeft>
      </metadata>
    </task>
    <task name="Poll_Data" 
    
    
    
    
    fork="true">
      <description>
        <![CDATA[ Poll online data and send it to Kafka topic (input of the dataflow) ]]>
      </description>
      <genericInformation>
        <info name="task.icon" value="/automation-dashboard/styles/patterns/img/wf-icons/kafka.png"/>
      </genericInformation>
      <depends>
        <task ref="Submit_Dataflow"/>
      </depends>
      <scriptExecutable>
        <script>
          <code language="bash">
            <![CDATA[
KAFKA=$variables_kafka_instance_name
TOPIC=$variables_message_topic

end=$((SECONDS+$variables_execution_duration))

counter=0
while [ $SECONDS -lt $end ]; do

	message1=$(curl -s "https://www.alphavantage.co/query?function=CURRENCY_EXCHANGE_RATE&from_currency=BTC&to_currency=CNY&apikey=PVCAYZTDBSG37ARW")
	message2=$(curl -s "https://www.alphavantage.co/query?function=CURRENCY_EXCHANGE_RATE&from_currency=BTC&to_currency=CNY&apikey=PVCAYZTDBSG37ARW")
	message3=$(curl -s "https://www.alphavantage.co/query?function=CURRENCY_EXCHANGE_RATE&from_currency=BTC&to_currency=CNY&apikey=PVCAYZTDBSG37ARW")

 	docker exec -i $KAFKA /opt/kafka/bin/kafka-console-producer.sh --broker-list localhost:9092 --topic $TOPIC <<< $message1$'\n'$message2$'\n'$message3
    (( counter=counter+3 ))

done
echo $counter
]]>
          </code>
        </script>
      </scriptExecutable>
      <metadata>
        <positionTop>
            590.78125
        </positionTop>
        <positionLeft>
            301.25
        </positionLeft>
      </metadata>
    </task>
    <task name="Vis_Alerts" 
    
    
    
    
    fork="true">
      <description>
        <![CDATA[ Send bitcoin alerts to Visdom server ]]>
      </description>
      <genericInformation>
        <info name="task.icon" value="/automation-dashboard/styles/patterns/img/wf-icons/visdom.png"/>
      </genericInformation>
      <depends>
        <task ref="Submit_Dataflow"/>
      </depends>
      <inputFiles>
        <files  includes="visdomAlertClient.py" accessMode="transferFromGlobalSpace"/>
      </inputFiles>
      <scriptExecutable>
        <script>
          <code language="bash">
            <![CDATA[
KAFKA=$variables_kafka_instance_name
VISDOM=$variables_visdom_instance_name
TOPIC=BitCoinAlertTopic

pyscript=visdomAlertClient.py
timeout=$variables_execution_duration

docker cp $pyscript $VISDOM:/root/$pyscript

docker exec $VISDOM /bin/bash -c 'rm alerts.pckl'

timeout $timeout docker exec -i $KAFKA /opt/kafka/bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic $TOPIC | \
while read LINE; do
    docker exec $VISDOM /bin/bash -c "python $pyscript --value '$LINE'"
done

exit 0
]]>
          </code>
        </script>
      </scriptExecutable>
      <metadata>
        <positionTop>
            588.796875
        </positionTop>
        <positionLeft>
            674.3125
        </positionLeft>
      </metadata>
    </task>
    <task name="Kill_Services" 
    
    
    
    
    fork="true">
      <description>
        <![CDATA[ Stop PSA services, Zookeeper, Kafka, Storm and Visdom. ]]>
      </description>
      <genericInformation>
        <info name="task.icon" value="/automation-dashboard/styles/patterns/img/wf-icons/proactive.png"/>
      </genericInformation>
      <depends>
        <task ref="Kill_Dataflow"/>
      </depends>
      <scriptExecutable>
        <script>
          <code language="groovy">
            <![CDATA[
import org.ow2.proactive.pca.service.client.ApiClient
import org.ow2.proactive.pca.service.client.api.ServiceInstanceRestApi
import org.ow2.proactive.pca.service.client.model.ServiceInstanceData
import org.ow2.proactive.pca.service.client.model.ServiceDescription

// Get schedulerapi access
schedulerapi.connect()

// Acquire session id
def session_id = schedulerapi.getSession()
println(session_id)

// Define PCA URL
def pca_url = variables.get('PA_CLOUD_AUTOMATION_REST_URL')

// Connect to APIs
def api_client = new ApiClient()
api_client.setBasePath(pca_url)
//api_client.setDebugging(true)
def service_instance_rest_api = new ServiceInstanceRestApi(api_client)

// Finish Zookeeper
ServiceDescription zookeeperFinishService = new ServiceDescription()
zookeeperFinishService.setBucketName("service-automation")
zookeeperFinishService.setWorkflowName("Finish_Zookeeper")
service_instance_rest_api.launchServiceInstanceActionUsingPUT(session_id, variables.get("zookeeper_instance_id"), zookeeperFinishService, variables.get("PA_JOB_ID"))

// Finish Kafka
ServiceDescription kafkaFinishService = new ServiceDescription()
kafkaFinishService.setBucketName("service-automation")
kafkaFinishService.setWorkflowName("Finish_Kafka")
service_instance_rest_api.launchServiceInstanceActionUsingPUT(session_id, variables.get("kafka_instance_id"), kafkaFinishService, variables.get("PA_JOB_ID"))

// Finish Storm
ServiceDescription stormFinishService = new ServiceDescription()
stormFinishService.setBucketName("service-automation")
stormFinishService.setWorkflowName("Finish_Storm")
service_instance_rest_api.launchServiceInstanceActionUsingPUT(session_id, variables.get("storm_instance_id"), stormFinishService, variables.get("PA_JOB_ID"))
]]>
          </code>
        </script>
      </scriptExecutable>
      <metadata>
        <positionTop>
            978.8125
        </positionTop>
        <positionLeft>
            659.5625
        </positionLeft>
      </metadata>
    </task>
    <task name="Finish" 
    
    
    
    
    fork="true">
      <depends>
        <task ref="Vis-Rate"/>
        <task ref="Vis_Variation"/>
        <task ref="Vis_Alerts"/>
        <task ref="View_Result"/>
        <task ref="Poll_Data"/>
      </depends>
      <scriptExecutable>
        <script>
          <code language="bash">
            <![CDATA[

]]>
          </code>
        </script>
      </scriptExecutable>
      <controlFlow >
        <if target="Immediately"
        else="After_Web_Validation"
        continuation="Kill_Dataflow">
          <script>
            <code language="javascript">
              <![CDATA[
kill=variables.get("automatic_kill")
if(kill=="true"){
    branch = "if";
} else {
    branch = "else";
}
]]>
            </code>
          </script>
        </if>
      </controlFlow>
      <metadata>
        <positionTop>
            722.8125
        </positionTop>
        <positionLeft>
            575.8125
        </positionLeft>
      </metadata>
    </task>
    <task name="Immediately" 
    
    
    
    
    fork="true">
      <scriptExecutable>
        <script>
          <code language="bash">
            <![CDATA[
echo "Stopping dataflow and removing PSA platforms immediately"
]]>
          </code>
        </script>
      </scriptExecutable>
      <metadata>
        <positionTop>
            850.8125
        </positionTop>
        <positionLeft>
            433.8125
        </positionLeft>
      </metadata>
    </task>
    <task name="After_Web_Validation" 
    
    
    
    
    fork="true">
      <scriptExecutable>
        <script>
          <file url="${PA_CATALOG_REST_URL}/buckets/notification-tools/resources/Web_Validation_Script/raw" language="groovy">
            <arguments>
              <argument value="Please validate to terminate the Kafka-Storm-Visdom Dataflow"/>
            </arguments>
          </file>
        </script>
      </scriptExecutable>
      <metadata>
        <positionTop>
            850.8125
        </positionTop>
        <positionLeft>
            586.8125
        </positionLeft>
      </metadata>
    </task>
    <task name="Kill_Dataflow" 
    
    
    
    
    fork="true">
      <description>
        <![CDATA[ Remove Storm topology ]]>
      </description>
      <genericInformation>
        <info name="task.icon" value="/automation-dashboard/styles/patterns/img/wf-icons/storm.png"/>
      </genericInformation>
      <scriptExecutable>
        <script>
          <code language="bash">
            <![CDATA[
ZOOKEEPER=$variables_zookeeper_endpoint
NIMBUS=$variables_storm_instance_name"-nimbus"
KAFKA=$variables_kafka_instance_name

docker exec -i $NIMBUS storm kill $variables_dataflow_name -w 5

docker exec $KAFKA /opt/kafka/bin/kafka-topics.sh --zookeeper $ZOOKEEPER --delete --topic BitCoinRateTopic
docker exec $KAFKA /opt/kafka/bin/kafka-topics.sh --zookeeper $ZOOKEEPER --delete --topic BitCoinGapTopic
docker exec $KAFKA /opt/kafka/bin/kafka-topics.sh --zookeeper $ZOOKEEPER --delete --topic BitCoinAlertTopic
]]>
          </code>
        </script>
      </scriptExecutable>
      <metadata>
        <positionTop>
            850.8125
        </positionTop>
        <positionLeft>
            739.8125
        </positionLeft>
      </metadata>
    </task>
    <task name="Start_Zookeeper" 
    
    
    
    
    fork="true">
      <genericInformation>
        <info name="task.icon" value="/automation-dashboard/styles/patterns/img/wf-icons/zookeeper.jpg"/>
      </genericInformation>
      <scriptExecutable>
        <script>
          <code language="groovy">
            <![CDATA[
import org.ow2.proactive.pca.service.client.ApiClient
import org.ow2.proactive.pca.service.client.api.ServiceInstanceRestApi
import org.ow2.proactive.pca.service.client.model.ServiceInstanceData
import org.ow2.proactive.pca.service.client.model.ServiceDescription


// Get schedulerapi access
schedulerapi.connect()

// Acquire session id
def session_id = schedulerapi.getSession()
println(session_id)

// Define PCA URL
def pca_url = variables.get('PA_CLOUD_AUTOMATION_REST_URL')

// Connect to APIs
def api_client = new ApiClient()
api_client.setBasePath(pca_url)
def service_instance_rest_api = new ServiceInstanceRestApi(api_client)

// Check existing Zookeeper instances
def zookeeper_service_id = variables.get("zookeeper_service_id")
def zookeeper_instance_name = variables.get("zookeeper_instance_name")
boolean instance_exists = false
List<ServiceInstanceData> service_instances = service_instance_rest_api.getServiceInstancesUsingGET(session_id, null)

for (ServiceInstanceData service_instance_data : service_instances) {

	if ( (service_instance_data.getServiceId() == zookeeper_service_id) && (service_instance_data.getInstanceStatus()  == "RUNNING")){

      if (service_instance_data.getVariables().get("INSTANCE_NAME") == zookeeper_instance_name) {
        instance_exists = true
        variables.put("zookeeper_instance_id", service_instance_data.getInstanceId())
        variables.put("zookeeper_endpoint", service_instance_data.getDeployments().iterator().next().getEndpoint().getUrl().replace("zookeeper://", ""))
        println(variables.get("zookeeper_endpoint"))
        break
      }
  	}
}

if (!instance_exists){
  // Prepare Zookeeper description
  ServiceDescription serviceDescription = new ServiceDescription()
  serviceDescription.setBucketName("service-automation")
  serviceDescription.setWorkflowName(zookeeper_service_id)
  serviceDescription.putVariablesItem("INSTANCE_NAME",zookeeper_instance_name)

  // Run Zookeeper
  def service_instance_data = service_instance_rest_api.createRunningServiceInstanceUsingPOST(session_id, serviceDescription, variables.get("PA_JOB_ID"))

  // Acquire Zookeeper Instance ID
  def service_instance_id  = service_instance_data.getInstanceId()

  // Create synchro channel
  channel = "Service_Instance_" + service_instance_id
  synchronizationapi.createChannelIfAbsent(channel, false)
  synchronizationapi.waitUntil(channel, "RUNNING", "{k,x -> x == true}")

  // Acquire Zookeeper endpoint
  service_instance_data = service_instance_rest_api.getServiceInstanceUsingGET(session_id, service_instance_id)
  variables.put("zookeeper_instance_id", service_instance_data.getInstanceId())
  variables.put("zookeeper_endpoint", service_instance_data.getDeployments().iterator().next().getEndpoint().getUrl().replace("zookeeper://", ""))
  println(variables.get("zookeeper_endpoint"))
}
]]>
          </code>
        </script>
      </scriptExecutable>
      <metadata>
        <positionTop>
            80.8125
        </positionTop>
        <positionLeft>
            578.546875
        </positionLeft>
      </metadata>
    </task>
    <task name="Start_Storm" 
    
    
    
    
    fork="true">
      <genericInformation>
        <info name="task.icon" value="/automation-dashboard/styles/patterns/img/wf-icons/storm.png"/>
      </genericInformation>
      <depends>
        <task ref="Start_Zookeeper"/>
      </depends>
      <scriptExecutable>
        <script>
          <code language="groovy">
            <![CDATA[
import org.ow2.proactive.pca.service.client.ApiClient
import org.ow2.proactive.pca.service.client.api.ServiceInstanceRestApi
import org.ow2.proactive.pca.service.client.model.ServiceInstanceData
import org.ow2.proactive.pca.service.client.model.ServiceDescription


// Get schedulerapi access
schedulerapi.connect()

// Acquire session id
def session_id = schedulerapi.getSession()
println(session_id)

// Define PCA URL
def pca_url = variables.get('PA_CLOUD_AUTOMATION_REST_URL')

// Connect to APIs
def api_client = new ApiClient()
api_client.setBasePath(pca_url)
//api_client.setDebugging(true)
def service_instance_rest_api = new ServiceInstanceRestApi(api_client)

// Check existing storm instances
def storm_service_id = variables.get("storm_service_id")
def storm_instance_name = variables.get("storm_instance_name")
boolean instance_exists = false
List<ServiceInstanceData> service_instances = service_instance_rest_api.getServiceInstancesUsingGET(session_id, null)

for (ServiceInstanceData service_instance_data : service_instances) {

	if ( (service_instance_data.getServiceId() == storm_service_id) && (service_instance_data.getInstanceStatus()  == "RUNNING")){

      if (service_instance_data.getVariables().get("INSTANCE_NAME") == storm_instance_name) {
        instance_exists = true
        variables.put("storm_instance_id", service_instance_data.getInstanceId())
        variables.put("storm_endpoint", service_instance_data.getDeployments().iterator().next().getEndpoint().getUrl())
        println(variables.get("storm_endpoint"))
        break
      }
  	}
}

if (!instance_exists){
  def zookeeper_instance_name = variables.get("zookeeper_instance_name")
  def zookeeper_service_id = variables.get("zookeeper_service_id")
  // Prepare storm description
  ServiceDescription serviceDescription = new ServiceDescription()
  serviceDescription.setBucketName("service-automation")
  serviceDescription.setWorkflowName(storm_service_id)
  serviceDescription.putVariablesItem("INSTANCE_NAME", storm_instance_name)
  serviceDescription.putVariablesItem("ZOOKEEPER_INSTANCE_NAME", zookeeper_instance_name)
  serviceDescription.putVariablesItem("ZOOKEEPER_SERVICE_ID", zookeeper_service_id)   

  // Run storm
  def service_instance_data = service_instance_rest_api.createRunningServiceInstanceUsingPOST(session_id, serviceDescription, variables.get("PA_JOB_ID"))

  // Acquire storm Instance ID
  def service_instance_id  = service_instance_data.getInstanceId()

  // Create synchro channel
  channel = "Service_Instance_" + service_instance_id
  synchronizationapi.createChannelIfAbsent(channel, false)
  synchronizationapi.waitUntil(channel, "RUNNING", "{k,x -> x == true}")

  // Acquire storm endpoint
  service_instance_data = service_instance_rest_api.getServiceInstanceUsingGET(session_id, service_instance_id)
  variables.put("storm_instance_id", service_instance_data.getInstanceId())
  variables.put("storm_endpoint", service_instance_data.getDeployments().iterator().next().getEndpoint().getUrl())
  println(variables.get("storm_endpoint"))
}
]]>
          </code>
        </script>
      </scriptExecutable>
      <metadata>
        <positionTop>
            210.8125
        </positionTop>
        <positionLeft>
            647.5625
        </positionLeft>
      </metadata>
    </task>
    <task name="Start_Visdom_Service" 
    
    onTaskError="cancelJob" 
    
    
    fork="true">
      <description>
        <![CDATA[ Start the Visdom server as a service. ]]>
      </description>
      <variables>
        <variable name="SERVICE_ID" value="$visdom_service_id" inherited="true" />
        <variable name="INSTANCE_NAME" value="$visdom_instance_name" inherited="true" />
      </variables>
      <genericInformation>
        <info name="task.icon" value="/automation-dashboard/styles/patterns/img/wf-icons/visdom.png"/>
        <info name="task.documentation" value="PML/PMLUserGuide.html"/>
      </genericInformation>
      <scriptExecutable>
        <script>
          <file url="${PA_CATALOG_REST_URL}/buckets/service-automation/resources/Service_Start/raw" language="groovy">
            <arguments>
              <argument value="true"/>
              <argument value="PROXYFIED"/>
              <argument value="VISDOM_ENABLE_LOGIN"/>
              <argument value="VISDOM_USERNAME"/>
              <argument value="VISDOM_PASSWORD"/>
            </arguments>
          </file>
        </script>
      </scriptExecutable>
      <controlFlow block="none"></controlFlow>
      <metadata>
        <positionTop>
            210.8125
        </positionTop>
        <positionLeft>
            802.0625
        </positionLeft>
      </metadata>
    </task>
    <task name="Visdom_Service_Actions" 
    
    onTaskError="cancelJob" 
    
    
    fork="true">
      <description>
        <![CDATA[ Manage the life-cycle of Visdom PSA service. It allows to trigger the following action: Finish_Visdom.
It requires the following variables:
INSTANCE_ID: if used alone or;
INSTANCE_NAME: if used within the same workflow as a Visdom_Service_Start task. In this case there is no need for an INSTANCE_ID.
ACTION: the action to execute on the Visdom service among the aforementioned actions. ]]>
      </description>
      <variables>
        <variable name="INSTANCE_NAME" value="$visdom_instance_name" inherited="true" />
        <variable name="ACTION" value="Finish_Visdom" inherited="false" model="PA:LIST(Finish_Visdom)"/>
        <variable name="INSTANCE_ID" value="" inherited="false" />
      </variables>
      <genericInformation>
        <info name="task.icon" value="/automation-dashboard/styles/patterns/img/wf-icons/visdom.png"/>
        <info name="task.documentation" value="PML/PMLUserGuide.html"/>
      </genericInformation>
      <depends>
        <task ref="Kill_Dataflow"/>
      </depends>
      <scriptExecutable>
        <script>
          <file url="${PA_CATALOG_REST_URL}/buckets/service-automation/resources/Service_Action/raw" language="groovy">
            <arguments>
              <argument value="INSTANCE_NAME"/>
            </arguments>
          </file>
        </script>
      </scriptExecutable>
      <controlFlow block="none"></controlFlow>
      <metadata>
        <positionTop>
            978.8125
        </positionTop>
        <positionLeft>
            820.0625
        </positionLeft>
      </metadata>
    </task>
  </taskFlow>
  <metadata>
    <visualization>
      <![CDATA[ <html>
    <head>
    <link rel="stylesheet" href="/studio/styles/studio-standalone.css">
        <style>
        #workflow-designer {
            left:0 !important;
            top:0 !important;
            width:3826px;
            height:4976px;
            }
        </style>
    </head>
    <body>
    <div id="workflow-visualization-view"><div id="workflow-visualization" style="position:relative;top:-75.8125px;left:-296.25px"><div class="task ui-draggable _jsPlumb_endpoint_anchor_" id="jsPlumb_1_236" style="top: 210.812px; left: 485.562px; z-index: 24;"><a class="task-name" data-toggle="tooltip" data-placement="right" title=""><img src="/automation-dashboard/styles/patterns/img/wf-icons/kafka.png" width="20px">&nbsp;<span class="name">Start_Kafka</span></a></div><div class="task ui-draggable _jsPlumb_endpoint_anchor_" id="jsPlumb_1_239" style="top: 338.797px; left: 655.062px;"><a class="task-name" data-toggle="tooltip" data-placement="right" title="Create Kafa topic (input of the dataflow)"><img src="/automation-dashboard/styles/patterns/img/wf-icons/kafka.png" width="20px">&nbsp;<span class="name">Create_Topic</span></a></div><div class="task ui-draggable _jsPlumb_endpoint_anchor_" id="jsPlumb_1_242" style="top: 453.735px; left: 647.719px;"><a class="task-name" data-toggle="tooltip" data-placement="right" title="Submit Storm topology"><img src="/automation-dashboard/styles/patterns/img/wf-icons/storm.png" width="20px">&nbsp;<span class="name">Submit_Dataflow</span></a></div><div class="task ui-draggable _jsPlumb_endpoint_anchor_" id="jsPlumb_1_245" style="top: 589.813px; left: 462.297px;"><a class="task-name" data-toggle="tooltip" data-placement="right" title="Send bitcoin rate data to Visdom server"><img src="/automation-dashboard/styles/patterns/img/wf-icons/visdom.png" width="20px">&nbsp;<span class="name">Vis-Rate</span></a></div><div class="task ui-draggable _jsPlumb_endpoint_anchor_" id="jsPlumb_1_248" style="top: 589.813px; left: 569.312px;"><a class="task-name" data-toggle="tooltip" data-placement="right" title="Send bitcoin rate variation to Visdom server"><img src="/automation-dashboard/styles/patterns/img/wf-icons/visdom.png" width="20px">&nbsp;<span class="name">Vis_Variation</span></a></div><div class="task ui-draggable _jsPlumb_endpoint_anchor_" id="jsPlumb_1_251" style="top: 586.797px; left: 847.25px;"><a class="task-name" data-toggle="tooltip" data-placement="right" title="Give link to view results on Visdom and dataflow status on Storm"><img src="/studio/images/Groovy.png" width="20px">&nbsp;<span class="name">View_Result</span></a></div><div class="task ui-draggable _jsPlumb_endpoint_anchor_" id="jsPlumb_1_254" style="top: 590.782px; left: 301.25px;"><a class="task-name" data-toggle="tooltip" data-placement="right" title="Poll online data and send it to Kafka topic (input of the dataflow)"><img src="/automation-dashboard/styles/patterns/img/wf-icons/kafka.png" width="20px">&nbsp;<span class="name">Poll_Data</span></a></div><div class="task ui-draggable _jsPlumb_endpoint_anchor_" id="jsPlumb_1_257" style="top: 588.797px; left: 674.312px;"><a class="task-name" data-toggle="tooltip" data-placement="right" title="Send bitcoin alerts to Visdom server"><img src="/automation-dashboard/styles/patterns/img/wf-icons/visdom.png" width="20px">&nbsp;<span class="name">Vis_Alerts</span></a></div><div class="task ui-draggable _jsPlumb_endpoint_anchor_" id="jsPlumb_1_260" style="top: 978.813px; left: 659.562px;"><a class="task-name" data-toggle="tooltip" data-placement="right" title="Stop PSA services, Zookeeper, Kafka, Storm and Visdom."><img src="/automation-dashboard/styles/patterns/img/wf-icons/proactive.png" width="20px">&nbsp;<span class="name">Kill_Services</span></a></div><div class="task ui-draggable _jsPlumb_endpoint_anchor_" id="jsPlumb_1_263" style="top: 722.813px; left: 575.812px;"><a class="task-name" data-toggle="tooltip" data-placement="right" title="This task has no description"><img src="/studio/images/LinuxBash.png" width="20px">&nbsp;<span class="name">Finish</span></a></div><div class="task ui-draggable _jsPlumb_endpoint_anchor_" id="jsPlumb_1_266" style="top: 850.813px; left: 433.812px;"><a class="task-name" data-toggle="tooltip" data-placement="right" title="This task has no description"><img src="/studio/images/LinuxBash.png" width="20px">&nbsp;<span class="name">Immediately</span></a></div><div class="task ui-draggable _jsPlumb_endpoint_anchor_" id="jsPlumb_1_269" style="top: 850.813px; left: 586.812px;"><a class="task-name" data-toggle="tooltip" data-placement="right" title="This task has no description"><img src="/studio/images/Groovy.png" width="20px">&nbsp;<span class="name">After_Web_Validation</span></a></div><div class="task ui-draggable _jsPlumb_endpoint_anchor_" id="jsPlumb_1_272" style="top: 850.813px; left: 739.812px;"><a class="task-name" data-toggle="tooltip" data-placement="right" title="Remove Storm topology"><img src="/automation-dashboard/styles/patterns/img/wf-icons/storm.png" width="20px">&nbsp;<span class="name">Kill_Dataflow</span></a></div><div class="task _jsPlumb_endpoint_anchor_ ui-draggable" id="jsPlumb_1_275" style="top: 80.8129px; left: 578.547px;"><a class="task-name" data-toggle="tooltip" data-placement="right" title="This task has no description"><img src="/automation-dashboard/styles/patterns/img/wf-icons/zookeeper.jpg" width="20px">&nbsp;<span class="name">Start_Zookeeper</span></a></div><div class="task ui-draggable _jsPlumb_endpoint_anchor_" id="jsPlumb_1_278" style="top: 210.813px; left: 647.562px;"><a class="task-name" data-toggle="tooltip" data-placement="right" title=""><img src="/automation-dashboard/styles/patterns/img/wf-icons/storm.png" width="20px">&nbsp;<span class="name">Start_Storm</span></a></div><div class="task _jsPlumb_endpoint_anchor_ ui-draggable" id="jsPlumb_1_281" style="top: 210.813px; left: 802.062px;"><a class="task-name" data-toggle="tooltip" data-placement="right" title="Start the Visdom server as a service."><img src="/automation-dashboard/styles/patterns/img/wf-icons/visdom.png" width="20px">&nbsp;<span class="name">Start_Visdom_Service</span></a></div><div class="task ui-draggable _jsPlumb_endpoint_anchor_" id="jsPlumb_1_284" style="top: 978.813px; left: 820.062px;"><a class="task-name" data-toggle="tooltip" data-placement="right" title="Manage the life-cycle of Visdom PSA service. It allows to trigger the following action: Finish_Visdom.
It requires the following variables:
INSTANCE_ID: if used alone or;
INSTANCE_NAME: if used within the same workflow as a Visdom_Service_Start task. In this case there is no need for an INSTANCE_ID.
ACTION: the action to execute on the Visdom service among the aforementioned actions."><img src="/automation-dashboard/styles/patterns/img/wf-icons/visdom.png" width="20px">&nbsp;<span class="name">Visdom_Service_Actions</span></a></div><svg style="position:absolute;left:525.0625px;top:120.5px" width="118.9375" height="90.8125" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector"><path d="M 0 89.8125 C -10 39.8125 107.9375 50 97.9375 0 " transform="translate(10.5,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#666" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M10.290450124999998,63.399653625 L30.803857696424096,58.08927606698773 L21.92371765131079,55.61074570018263 L23.01494977160673,46.45600854067694 L10.290450124999998,63.399653625" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M10.290450124999998,63.399653625 L30.803857696424096,58.08927606698773 L21.92371765131079,55.61074570018263 L23.01494977160673,46.45600854067694 L10.290450124999998,63.399653625" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path></svg><svg style="position:absolute;left:525.0625px;top:250.3125px" width="190.4375" height="89.1875" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector"><path d="M 169.4375 88.1875 C 179.4375 38.1875 -10 50 0 0 " transform="translate(10.5,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#666" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M144.796125640625,59.945700953125 L128.3611169291387,46.57070605019629 L131.6278585143373,55.1920980152756 L123.6075139912893,59.738973176483995 L144.796125640625,59.945700953125" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M144.796125640625,59.945700953125 L128.3611169291387,46.57070605019629 L131.6278585143373,55.1920980152756 L123.6075139912893,59.738973176483995 L144.796125640625,59.945700953125" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path></svg><svg style="position:absolute;left:687.5px;top:250.5px" width="28" height="89" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector"><path d="M 7 88 C 17 38 -10 50 0 0 " transform="translate(10.5,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#666" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M9.235168,66.303232 L13.724569009562899,45.59465217000355 L7.514881717901915,52.40932631773681 L-0.1693366727002843,47.314938452101636 L9.235168,66.303232" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M9.235168,66.303232 L13.724569009562899,45.59465217000355 L7.514881717901915,52.40932631773681 L-0.1693366727002843,47.314938452101636 L9.235168,66.303232" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path></svg><svg style="position:absolute;left:694.5px;top:250.5px" width="185" height="89" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector"><path d="M 0 88 C -10 38 174 50 164 0 " transform="translate(10.5,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#666" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M22.8125,60.1875 L43.996482787264696,59.69875336945079 L35.91632630432136,55.25903815210308 L39.06802093936777,46.59492706512943 L22.8125,60.1875" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M22.8125,60.1875 L43.996482787264696,59.69875336945079 L35.91632630432136,55.25903815210308 L39.06802093936777,46.59492706512943 L22.8125,60.1875" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path></svg><svg style="position:absolute;left:692.5px;top:378.5px" width="23" height="76" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector "><path d="M 0 75 C -10 25 12 50 2 0 " transform="translate(10.5,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#666" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M-2.581927999999999,56.597043750000005 L5.359247547088778,36.95174581562601 L-1.917585114440521,42.61281518599239 L-8.624981016918838,36.287402930066534 L-2.581927999999999,56.597043750000005" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M-2.581927999999999,56.597043750000005 L5.359247547088778,36.95174581562601 L-1.917585114440521,42.61281518599239 L-8.624981016918838,36.287402930066534 L-2.581927999999999,56.597043750000005" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path></svg><svg style="position:absolute;left:501.5px;top:493.5px" width="212" height="97" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector"><path d="M 0 96 C -10 46 201 50 191 0 " transform="translate(10.5,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#666" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M29.250208,66.05299199999999 L50.439385667072976,65.91606211569425 L42.43406238333735,61.3427920468179 L45.72918571389088,52.7322077323569 L29.250208,66.05299199999999" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M29.250208,66.05299199999999 L50.439385667072976,65.91606211569425 L42.43406238333735,61.3427920468179 L45.72918571389088,52.7322077323569 L29.250208,66.05299199999999" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path></svg><svg style="position:absolute;left:608.5px;top:493.5px" width="105" height="97" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector"><path d="M 0 96 C -10 46 94 50 84 0 " transform="translate(10.5,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#666" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M7.966687499999998,69.2210625 L27.71103886584224,61.529470392889564 L18.60063484062139,60.115066455805206 L18.60504282164745,50.895523052268175 L7.966687499999998,69.2210625" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M7.966687499999998,69.2210625 L27.71103886584224,61.529470392889564 L18.60063484062139,60.115066455805206 L18.60504282164745,50.895523052268175 L7.966687499999998,69.2210625" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path></svg><svg style="position:absolute;left:692.5px;top:493.5px" width="215" height="94" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector"><path d="M 194 93 C 204 43 -10 50 0 0 " transform="translate(10.5,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#666" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M164.246848,63.555935999999996 L147.52759082860314,50.538008375500965 L150.979255761265,59.08704394640793 L143.05869877501107,63.805600614235985 L164.246848,63.555935999999996" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M164.246848,63.555935999999996 L147.52759082860314,50.538008375500965 L150.979255761265,59.08704394640793 L143.05869877501107,63.805600614235985 L164.246848,63.555935999999996" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path></svg><svg style="position:absolute;left:340.5px;top:493.5px" width="373" height="98" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector "><path d="M 0 97 C -10 47 362 50 352 0 " transform="translate(10.5,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#666" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M62.52743750000001,65.56990625 L83.4920708930887,68.64954043174806 L76.27332057322081,62.914591101596365 L80.83675574468505,54.90365735852726 L62.52743750000001,65.56990625" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M62.52743750000001,65.56990625 L83.4920708930887,68.64954043174806 L76.27332057322081,62.914591101596365 L80.83675574468505,54.90365735852726 L62.52743750000001,65.56990625" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path></svg><svg style="position:absolute;left:692.5px;top:493.5px" width="42" height="96" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector"><path d="M 21 95 C 31 45 -10 50 0 0 " transform="translate(10.5,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#666" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M21.876318,71.70201 L22.941626753377225,50.53918605658504 L17.92159573828721,58.272186031209 L9.511802784586227,54.49390831829783 L21.876318,71.70201" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M21.876318,71.70201 L22.941626753377225,50.53918605658504 L17.92159573828721,58.272186031209 L9.511802784586227,54.49390831829783 L21.876318,71.70201" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path></svg><svg style="position:absolute;left:699.5px;top:890.5px" width="101" height="89" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector "><path d="M 0 88 C -10 38 90 50 80 0 " transform="translate(10.5,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#666" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M6.617807499999998,63.115491500000005 L26.49664200533075,55.778466305163086 L17.413008373938954,54.20125355773553 L17.58240406306627,44.98326543122413 L6.617807499999998,63.115491500000005" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M6.617807499999998,63.115491500000005 L26.49664200533075,55.778466305163086 L17.413008373938954,54.20125355773553 L17.58240406306627,44.98326543122413 L6.617807499999998,63.115491500000005" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path></svg><svg style="position:absolute;left:501.5px;top:629.5px" width="135" height="94" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector"><path d="M 114 93 C 124 43 -10 50 0 0 " transform="translate(10.5,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#666" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M100.93042799999999,65.71399725 L87.35729026512773,49.442244669832526 L88.9145921010676,58.52931300850911 L80.17260602363685,61.45808056876492 L100.93042799999999,65.71399725" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M100.93042799999999,65.71399725 L87.35729026512773,49.442244669832526 L88.9145921010676,58.52931300850911 L80.17260602363685,61.45808056876492 L100.93042799999999,65.71399725" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path></svg><svg style="position:absolute;left:608.5px;top:629.5px" width="28" height="94" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector"><path d="M 7 93 C 17 43 -10 50 0 0 " transform="translate(10.5,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#666" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M9.21956525,70.38066975000001 L13.780062951029919,49.6876308064591 L7.547007432230218,56.480937725740795 L-0.11966907322929643,51.36018862422888 L9.21956525,70.38066975000001" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M9.21956525,70.38066975000001 L13.780062951029919,49.6876308064591 L7.547007432230218,56.480937725740795 L-0.11966907322929643,51.36018862422888 L9.21956525,70.38066975000001" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path></svg><svg style="position:absolute;left:615.5px;top:628.5px" width="119" height="95" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector "><path d="M 0 94 C -10 44 108 50 98 0 " transform="translate(10.5,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#666" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M10.298848,67.024496 L30.65868151415294,61.152768888155066 L21.713823783968863,58.919045497319445 L22.553231011472384,49.73779310418621 L10.298848,67.024496" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M10.298848,67.024496 L30.65868151415294,61.152768888155066 L21.713823783968863,58.919045497319445 L22.553231011472384,49.73779310418621 L10.298848,67.024496" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path></svg><svg style="position:absolute;left:615.5px;top:626.5px" width="292" height="97" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector"><path d="M 0 96 C -10 46 281 50 271 0 " transform="translate(10.5,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#666" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M45.87953400000001,65.18403599999999 L66.9775778120143,67.15191488507533 L59.46595804922358,61.80630280232448 L63.599844614338785,53.565490835851755 L45.87953400000001,65.18403599999999" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M45.87953400000001,65.18403599999999 L66.9775778120143,67.15191488507533 L59.46595804922358,61.80630280232448 L63.599844614338785,53.565490835851755 L45.87953400000001,65.18403599999999" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path></svg><svg style="position:absolute;left:340.5px;top:630.5px" width="296" height="93" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector"><path d="M 275 92 C 285 42 -10 50 0 0 " transform="translate(10.5,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#666" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M228.40313,61.901372 L210.4896800227681,50.58287784604073 L214.76175267101794,58.752908157372225 L207.34121618014032,64.22425517502278 L228.40313,61.901372" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M228.40313,61.901372 L210.4896800227681,50.58287784604073 L214.76175267101794,58.752908157372225 L207.34121618014032,64.22425517502278 L228.40313,61.901372" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path></svg><svg style="position:absolute;left:423.5px;top:762.5px" width="163" height="89" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector"><path d="M 0 88 C -10 38 152 50 142 0 " transform="translate(10.5,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#00f" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M18.563992999999996,60.59109050000001 L39.69226134488013,58.979793895790735 L31.388064423950837,54.97475787867072 L34.07592872355084,46.155722471839894 L18.563992999999996,60.59109050000001" class="" stroke="#00f" fill="#00f" transform="translate(10.5,0.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M18.563992999999996,60.59109050000001 L39.69226134488013,58.979793895790735 L31.388064423950837,54.97475787867072 L34.07592872355084,46.155722471839894 L18.563992999999996,60.59109050000001" class="" stroke="#00f" fill="#00f" transform="translate(10.5,0.5)"></path></svg><div class="_jsPlumb_overlay l1 component label" id="jsPlumb_1_328" style="position: absolute; transform: translate(-50%, -50%); left: 504.5px; top: 806.5px;">if</div><svg style="position:absolute;left:565.5px;top:762.5px" width="32" height="89" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector"><path d="M 11 88 C 21 38 -10 50 0 0 " transform="translate(10.5,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#00f" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M12.893024,66.303232 L16.31083689897854,45.39106915184926 L10.460052179499373,52.5162581434697 L2.523863042448242,47.824040972349884 L12.893024,66.303232" class="" stroke="#00f" fill="#00f" transform="translate(10.5,0.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M12.893024,66.303232 L16.31083689897854,45.39106915184926 L10.460052179499373,52.5162581434697 L2.523863042448242,47.824040972349884 L12.893024,66.303232" class="" stroke="#00f" fill="#00f" transform="translate(10.5,0.5)"></path></svg><div class="_jsPlumb_overlay l1 component label" id="jsPlumb_1_332" style="position: absolute; transform: translate(-50%, -50%); left: 581px; top: 806.5px;">else</div><svg style="position:absolute;left:565.5px;top:762.5px" width="185" height="89" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector"><path d="M 164 88 C 174 38 -10 50 0 0 " transform="translate(10.5,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#00f" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M141.1875,60.1875 L124.93197906063223,46.59492706512943 L128.08367369567864,55.25903815210308 L120.0035172127353,59.69875336945079 L141.1875,60.1875" class="" stroke="#00f" fill="#00f" transform="translate(10.5,0.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M141.1875,60.1875 L124.93197906063223,46.59492706512943 L128.08367369567864,55.25903815210308 L120.0035172127353,59.69875336945079 L141.1875,60.1875" class="" stroke="#00f" fill="#00f" transform="translate(10.5,0.5)"></path></svg><div class="_jsPlumb_overlay l1 component label" id="jsPlumb_1_336" style="position: absolute; transform: translate(-50%, -50%); left: 657.5px; top: 806.5px;">continuation</div><svg style="position:absolute;left:623px;top:120.5px" width="85.5" height="91" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector"><path d="M 64.5 90 C 74.5 40 -10 50 0 0 " transform="translate(10.5,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#666" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M60.047979,65.32668 L51.40104904468792,45.981639231163996 L50.433381265404655,55.15026066892317 L41.224629713611094,55.596236965759346 L60.047979,65.32668" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M60.047979,65.32668 L51.40104904468792,45.981639231163996 L50.433381265404655,55.15026066892317 L41.224629713611094,55.596236965759346 L60.047979,65.32668" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path></svg><svg style="position:absolute;left:779.5px;top:890.5px" width="123.5" height="89" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector "><path d="M 102.5 88 C 112.5 38 -10 50 0 0 " transform="translate(10.5,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#666" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M91.596505,61.830692 L78.33408297797747,45.304707547938705 L79.71894454906834,54.41964904138317 L70.92304001936064,57.18226799887036 L91.596505,61.830692" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M91.596505,61.830692 L78.33408297797747,45.304707547938705 L79.71894454906834,54.41964904138317 L70.92304001936064,57.18226799887036 L91.596505,61.830692" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path></svg><div class="_jsPlumb_endpoint source-endpoint dependency-source-endpoint connected _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 525.562px; top: 240.812px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint target-endpoint dependency-target-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 525.562px; top: 200.812px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint dependency-source-endpoint connected _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 695px; top: 369px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint target-endpoint dependency-target-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 695px; top: 329px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint dependency-source-endpoint connected _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 693px; top: 484px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint target-endpoint dependency-target-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 693px; top: 444px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint dependency-source-endpoint connected _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 502px; top: 620px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint target-endpoint dependency-target-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 502px; top: 580px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint dependency-source-endpoint connected _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 609px; top: 620px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint target-endpoint dependency-target-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 609px; top: 580px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint dependency-source-endpoint connected _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 887px; top: 617px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint target-endpoint dependency-target-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 887px; top: 577px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint dependency-source-endpoint connected _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 341px; top: 621px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint target-endpoint dependency-target-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 341px; top: 581px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint dependency-source-endpoint connected _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 714px; top: 619px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint target-endpoint dependency-target-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 714px; top: 579px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint dependency-source-endpoint connected _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable" style="position: absolute; height: 20px; width: 20px; left: 700px; top: 1009px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint target-endpoint dependency-target-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 700px; top: 969px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint dependency-source-endpoint connected _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable" style="position: absolute; height: 20px; width: 20px; left: 616px; top: 753px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint target-endpoint dependency-target-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 616px; top: 713px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint if-source-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected _jsPlumb_endpoint_full" style="position: absolute; height: 20px; width: 20px; left: 566px; top: 753px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#00f" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint dependency-source-endpoint connected _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable" style="position: absolute; height: 20px; width: 20px; left: 474px; top: 881px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint target-endpoint if-target-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected _jsPlumb_endpoint_full" style="position: absolute; height: 20px; width: 20px; left: 424px; top: 841px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#00f" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint dependency-source-endpoint connected _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable" style="position: absolute; height: 20px; width: 20px; left: 642px; top: 881px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint target-endpoint if-target-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected _jsPlumb_endpoint_full" style="position: absolute; height: 20px; width: 20px; left: 577px; top: 841px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#00f" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint dependency-source-endpoint connected _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 780px; top: 881px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint target-endpoint if-target-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected _jsPlumb_endpoint_full" style="position: absolute; height: 20px; width: 20px; left: 730px; top: 841px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#00f" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint dependency-source-endpoint connected _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 623.5px; top: 111px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint dependency-source-endpoint connected _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 688px; top: 241px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint target-endpoint dependency-target-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 688px; top: 201px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint dependency-source-endpoint connected _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 859px; top: 241px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint dependency-source-endpoint connected _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable" style="position: absolute; height: 20px; width: 20px; left: 882.5px; top: 1009px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint target-endpoint dependency-target-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 882.5px; top: 969px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div></div></div>
    </body>
</html>
 ]]>
    </visualization>
  </metadata>
</job>
