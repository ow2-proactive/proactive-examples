<?xml version="1.0" encoding="UTF-8"?>
<job
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns="urn:proactive:jobdescriptor:3.14" xsi:schemaLocation="urn:proactive:jobdescriptor:3.14 http://www.activeeon.com/public_content/schemas/proactive/jobdescriptor/3.14/schedulerjob.xsd"  name="Monte_Carlo_VaR_Portfolio_MC_Interactive_Control" projectName="Risk Valuation Workflows" tags="QuantLib,Cpp,Finance,VaR,Pricing,Bale,Risk,Solvency,Black-Scholes" priority="normal" onTaskError="cancelJob"  maxNumberOfExecution="1"  >
  <variables>
    <variable name="nb_MC" value="1000" model="PA:INTEGER[100,1000]" description="The number of Monte Carlo simulations limited to 1000." group="Simulation"  />
    <variable name="nb_time_steps" value="255" model="PA:INTEGER" description="The number of time steps to the horizon." group="Simulation"  />
    <variable name="horizon" value="1" model="PA:INTEGER" description="The horizon in year fraction." group="Simulation"  />
    <variable name="assets_params_file_path_from_dataspace" value="assets.txt" model="PA:GLOBAL_FILE" description="The relative path from the dataspace of the asset params file following the csv format." group="Simulation"  />
    <variable name="assets_correlations_file_path_from_dataspace" value="assets_correlations.txt" model="PA:GLOBAL_FILE" description="The relative path from the dataspace of the asset correlations file." group="Simulation"  />
    <variable name="confidence_rate" value="0.99" model="PA:FLOAT" description="The confidence level rate." group="VaR"  />
    <variable name="nb_bins" value="50" model="PA:INTEGER" description="The number of bins for the portfolio estimation distributions." group="VaR"  />
    <variable name="nb_tasks" value="5" model="PA:INTEGER" description="The number of ProActive replicated tasks that will execute in parallel." group="Parallelization"  />
    <variable name="TARGET_INFRASTRUCTURE" value="" model="PA:MODEL_FROM_URL(${PA_SCHEDULER_REST_PUBLIC_URL}/rm/model/nodesources?infrastructure=%5E(%3F!(Default)).*$)" description="The node source where the job will be executed." group="Job Execution Parameters"  />
    <variable name="TOKEN" value="" model="PA:MODEL_FROM_URL(${PA_SCHEDULER_REST_PUBLIC_URL}/rm/model/tokens?nodeSource=${TARGET_INFRASTRUCTURE})" description="(Optional) Please select a value in case the node source access is restricted with tokens." group="Job Execution Parameters"  />
    <variable name="width_chart" value="2000" model="PA:INTEGER" description="The width of the chart in pixels." group="Display"  />
    <variable name="height_chart" value="1000" model="PA:INTEGER" description="The height of the chart in pixels." group="Display"  />
    <variable name="CONTAINER_PLATFORM" value="docker" model="PA:LIST(no-container,docker,podman,singularity)" description="Container platform used for executing the workflow tasks." group="Container Parameters" advanced="true" hidden="false"/>
    <variable name="CONTAINER_GPU_ENABLED" value="False" model="PA:Boolean" description="If True, it will activate the use of GPU for the workflow tasks on the selected container platform." group="Container Parameters" advanced="true" hidden="false"/>
    <variable name="CONTAINER_IMAGE" value="" model="PA:LIST(,docker://activeeon/dlm3,docker://activeeon/cuda,docker://activeeon/cuda2)" description="Name of the container image being used to run the workflow tasks." group="Container Parameters" advanced="true" hidden="false"/>
    <variable name="DOCKER_ENABLED" value="True" model="PA:Boolean" description="If true, the workflow tasks will be executed inside a docker container" group="Docker" advanced="true" hidden="false"/>
    <variable name="VISDOM_INSTANCE_NAME" value="visdom-server-${PA_JOB_ID}"  description="Name of the Visdom service instance to use." group="Visdom" advanced="true" hidden="false"/>
    <variable name="VISDOM_PROXYFIED" value="True" model="PA:Boolean" description="If True, requests to Visdom are sent via a proxy server." group="Visdom" advanced="true" hidden="false"/>
    <variable name="VISDOM_ENABLE_LOGIN" value="False" model="PA:Boolean" description="If True, a login in required for accessing the Visdom service." group="Visdom" advanced="true" hidden="false"/>
    <variable name="VISDOM_USERNAME" value=""  description="Username to access the Visdom service." group="Visdom" advanced="true" hidden="false"/>
    <variable name="VISDOM_PASSWORD" value="" model="PA:HIDDEN" description="Password to access the Visdom service." group="Visdom" advanced="true" hidden="false"/>
  </variables>
  <description>
    <![CDATA[ Estimates the Monte Carlo Value at Risk (MC VaR) of a portfolio. We use the Geometric Brownian motion (GBM) method to simulate stock price paths, but more advanced assets can be integrated thanks to the C++ Quantlib lib. After the VaR estimation, user can rerun/trigger more simualations to improve the VaR accuracy and smooth the bar chart. ]]>
  </description>
  <genericInformation>
    <info name="bucketName" value="hpc-finance"/>
    <info name="workflow.icon" value="/automation-dashboard/styles/patterns/img/wf-icons/quantlib.png"/>
    <info name="Documentation" value="https://ow2-proactive.github.io/proactive-examples/Finance/resources/doc/risk-valuation-proactive.pdf"/>
    <info name="group" value="public-objects"/>
  </genericInformation>
  <taskFlow>
    <task name="Start_Visdom_Service"

          onTaskError="cancelJob"


          fork="true">
      <description>
        <![CDATA[ Start the Visdom server as a service. ]]>
      </description>
      <variables>
        <variable name="SERVICE_ACTIVATION_WORKFLOW" value="service-automation/Visdom" inherited="false" model="PA:CATALOG_OBJECT(Workflow/psa,,,Visdom%)" description="The service activation workflow. Please keep the default value for this variable."  advanced="false" hidden="false"/>
        <variable name="INSTANCE_NAME" value="$VISDOM_INSTANCE_NAME" inherited="false"  description="Instance name of the server to be used to broadcast the visualization."  advanced="false" hidden="false"/>
        <variable name="ENGINE" value="$CONTAINER_PLATFORM" inherited="false"  description="Container platform used for executing the workflow tasks."  advanced="false" hidden="false"/>
        <variable name="PROXYFIED" value="$VISDOM_PROXYFIED" inherited="false"  description="If True, requests to Visdom are sent via a proxy server."  advanced="false" hidden="false"/>
      </variables>
      <genericInformation>
        <info name="task.icon" value="/automation-dashboard/styles/patterns/img/wf-icons/visdom.png"/>
        <info name="task.documentation" value="PAIO/PAIOUserGuide.html#_visdom_service_start"/>
      </genericInformation>
      <scriptExecutable>
        <script>
          <file url="${PA_CATALOG_REST_URL}/buckets/service-automation/resources/Service_Start/raw" language="groovy">
            <arguments>
              <argument value="true"/>
              <argument value="ENGINE"/>
              <argument value="PROXYFIED"/>
              <argument value="VISDOM_ENABLE_LOGIN"/>
              <argument value="VISDOM_USERNAME"/>
              <argument value="VISDOM_PASSWORD"/>
            </arguments>
          </file>
        </script>
      </scriptExecutable>
      <controlFlow block="none"></controlFlow>
      <post>
        <script>
          <code language="groovy">
            <![CDATA[
variables.put("ENDPOINT_VISDOM",variables.get("ENDPOINT_" + variables.get("INSTANCE_NAME")))
]]>
          </code>
        </script>
      </post>
      <metadata>
        <positionTop>
          -19.92498779296875
        </positionTop>
        <positionLeft>
          515.0249938964844
        </positionLeft>
      </metadata>
    </task>
    <task name="Init"




          fork="true">
      <genericInformation>
        <info name="NODE_SOURCE" value="${TARGET_INFRASTRUCTURE}"/>
        <info name="NODE_ACCESS_TOKEN" value="${TOKEN}"/>
      </genericInformation>
      <depends>
        <task ref="Start_Visdom_Service"/>
      </depends>
      <scriptExecutable>
        <script>
          <code language="groovy">
            <![CDATA[
variables.put("NODE_SOURCE_INTERNAL", variables.get("TARGET_INFRASTRUCTURE"))
variables.put("TOKEN_INTERNAL", variables.get("TOKEN"))
]]>
          </code>
        </script>
      </scriptExecutable>
      <metadata>
        <positionTop>
          108.43750762939453
        </positionTop>
        <positionLeft>
          515.0249938964844
        </positionLeft>
      </metadata>
    </task>
    <task name="Start"




          fork="true">
      <depends>
        <task ref="Init"/>
      </depends>
      <scriptExecutable>
        <script>
          <code language="groovy">
            <![CDATA[
println "### NEW SIMULATIONS ###"
println "Starting the simulations!"
]]>
          </code>
        </script>
      </scriptExecutable>
      <controlFlow block="start"></controlFlow>
      <metadata>
        <positionTop>
          234.85001373291016
        </positionTop>
        <positionLeft>
          515.0249938964844
        </positionLeft>
      </metadata>
    </task>
    <task name="split_MC_simulations"




          fork="true">
      <depends>
        <task ref="Start"/>
      </depends>
      <inputFiles>
        <files  includes="$assets_params_file_path_from_dataspace" accessMode="transferFromGlobalSpace"/>
      </inputFiles>
      <scriptExecutable>
        <script>
          <code language="groovy">
            <![CDATA[
println "Split_MC_simulations ..."

// Retrieve variables
def nb_MC = variables.get("nb_MC").toInteger()
def nb_tasks = variables.get("nb_tasks").toInteger()
def assets_params_file_path_from_dataspace = variables.get("assets_params_file_path_from_dataspace")

// Estimate nb_MC per task
def nbMC_per_task = (int)(nb_MC / nb_tasks)
if (nb_MC % nb_tasks != 0)
	nbMC_per_task++

def nbMC_left = nb_MC
def nbMC_task = 0
(0..nb_tasks-1).each {
     // How many simulations must we give?
     if(it == nb_tasks-1)
     	nbMC_task = nbMC_left
     else
  	    nbMC_task = nbMC_per_task

     // Update nbMC_left
     nbMC_left = nbMC_left - nbMC_task

     // Store nbMC_task
     variables["nbMC_task_${it}"] = nbMC_task
     println "nbMC_task " + nbMC_task
}

// Estimate the number of assets
variables["nb_assets"] = new File(localspace, assets_params_file_path_from_dataspace).text.split(System.getProperty("line.separator")).length

println "... Split_MC_simulations"
]]>
          </code>
        </script>
      </scriptExecutable>
      <controlFlow >
        <replicate>
          <script>
            <code language="groovy">
              <![CDATA[
runs=variables.get("nb_tasks")
]]>
            </code>
          </script>
        </replicate>
      </controlFlow>
      <metadata>
        <positionTop>
          361.25001525878906
        </positionTop>
        <positionLeft>
          448.6750183105469
        </positionLeft>
      </metadata>
    </task>
    <task name="simulate_ptf_PnLs"




          fork="true">
      <genericInformation>
        <info name="task.icon" value="/automation-dashboard/styles/patterns/img/wf-icons/quantlib.png"/>
        <info name="NODE_SOURCE" value="${NODE_SOURCE_INTERNAL}"/>
        <info name="NODE_ACCESS_TOKEN" value="${TOKEN_INTERNAL}"/>
      </genericInformation>
      <depends>
        <task ref="split_MC_simulations"/>
      </depends>
      <inputFiles>
        <files  includes="ptfPnLSimulations" accessMode="transferFromGlobalSpace"/>
        <files  includes="$assets_params_file_path_from_dataspace" accessMode="transferFromGlobalSpace"/>
        <files  includes="$assets_correlations_file_path_from_dataspace" accessMode="transferFromGlobalSpace"/>
        <files  includes="outputs_job_${PA_JOB_ID}_task_${PA_TASK_REPLICATION}.txt" accessMode="transferFromGlobalSpace"/>
      </inputFiles>
      <scriptExecutable>
        <script>
          <code language="groovy">
            <![CDATA[
println "simulate_ptf_PnLs ..."

// Retrieve variables
def job_id = variables.get("PA_JOB_ID")
def task_id = variables.get("PA_TASK_REPLICATION")
def nbMC_task = variables.get("nbMC_task_" + task_id)
def nb_time_steps = variables.get("nb_time_steps")
def horizon = variables.get("horizon")
def nb_assets = variables.get("nb_assets")
def assets_params_file_path_from_dataspace = variables.get("assets_params_file_path_from_dataspace")
def assets_correlations_file_path_from_dataspace = variables.get("assets_correlations_file_path_from_dataspace")

// Set executable permission
def executable_file_path = new File(localspace, "ptfPnLSimulations").absolutePath
["chmod","+x", executable_file_path].execute().waitForProcessOutput(System.out, System.err)

// Build the command
def cmd = ['/bin/sh', '-c', "docker run --rm -v " + localspace + ":" + localspace + " -w " + localspace + " activeeon/quantlib:1.19 /bin/bash -c './ptfPnLSimulations " + nbMC_task + " " + nb_time_steps + " " + horizon + " " + nb_assets + " " + assets_params_file_path_from_dataspace + " " +  assets_correlations_file_path_from_dataspace + " " + task_id + "'"]
println cmd

// Execute the command
def sout = new StringBuilder()
cmd.execute().waitForProcessOutput(sout, System.err)

// Store ptf PnLs at horizon (or append to previous wkw reexecutions results)
def output_file_name = "outputs_job_" + job_id + "_task_" + task_id + ".txt"
def output_file = new File(localspace, output_file_name)
if (output_file.exists()){
  output_file.append(sout)
} else {
  output_file.text = sout
}

println "... simulate_ptf_PnLs"
]]>
          </code>
        </script>
      </scriptExecutable>
      <outputFiles>
        <files  includes="outputs_job_${PA_JOB_ID}_task_${PA_TASK_REPLICATION}.txt" accessMode="transferToGlobalSpace"/>
      </outputFiles>
      <metadata>
        <positionTop>
          489.65000915527344
        </positionTop>
        <positionLeft>
          448.6750183105469
        </positionLeft>
      </metadata>
    </task>
    <task name="compute_and_plot_VaR_png"
          preciousResult="true"
          fork="true">
      <depends>
        <task ref="simulate_ptf_PnLs"/>
      </depends>
      <inputFiles>
        <files  includes="DualAxisChart.jar" accessMode="transferFromGlobalSpace"/>
        <files  includes="jcommon-1.0.6.jar" accessMode="transferFromGlobalSpace"/>
        <files  includes="jfreechart-1.0.2.jar" accessMode="transferFromGlobalSpace"/>
        <files  includes="outputs_job_${PA_JOB_ID}_task_*.txt" accessMode="transferFromGlobalSpace"/>
      </inputFiles>
      <forkEnvironment >
        <additionalClasspath>
          <pathElement path="DualAxisChart.jar"/>
          <pathElement path="jcommon-1.0.6.jar"/>
          <pathElement path="jfreechart-1.0.2.jar"/>
        </additionalClasspath>
      </forkEnvironment>
      <scriptExecutable>
        <script>
          <code language="groovy">
            <![CDATA[
import DualAxisChart;

// Retrieve variables
def job_id = variables.get("PA_JOB_ID")
def horizon = variables.get("horizon").toInteger()
def confidence_rate = variables.get("confidence_rate").toDouble()
def nb_bins = variables.get("nb_bins").toInteger()
def chart_file_path_from_dataspace = variables.get("chart_file_path_from_dataspace")
def width_chart = variables.get("width_chart").toInteger()
def height_chart = variables.get("height_chart").toInteger()

// Retrieve ptf PnLs at horizon from all tasks
def ptfHorizonPnLs = []
def MCid = 0

// Retrieve all task result files
new File(localspace).eachFileMatch(~/outputs_job_${job_id}_task_\d+.txt/) {task_results_file ->

  println "Reading ... " + task_results_file.name

  task_results_file.text.split().each{ ptfHorizonPnL ->
		ptfHorizonPnLs += ptfHorizonPnL.toDouble()
		MCid++;
  }
}
println "nb MC simus retrived from tasks: " + MCid

// Compute VaR
ptfHorizonPnLs = ptfHorizonPnLs.sort()
def VaRIndex = (int)((1 - confidence_rate) * MCid);
def VaR = ptfHorizonPnLs[VaRIndex]

def resultStr = "portfolio VaR " + confidence_rate*100 + "% at horizon " + horizon + " = " + VaR + " (" + MCid + " simus)"
println resultStr
def chart_file_name = "VaR.png"
DualAxisChart.writeChart(resultStr, ptfHorizonPnLs as double[], nb_bins, VaR, chart_file_name, width_chart, height_chart)

// Expose the resulting chart image
def chart_file = new File(localspace, chart_file_name)
result = chart_file.getBytes()
resultMetadata.put("file.name", chart_file_name)
resultMetadata.put("content.type", "image/png")
]]>
          </code>
        </script>
      </scriptExecutable>
      <metadata>
        <positionTop>
          592.4500274658203
        </positionTop>
        <positionLeft>
          268.1750183105469
        </positionLeft>
      </metadata>
    </task>
    <task name="compute_and_plot_VaR_visdom"
          fork="true">
      <variables>
        <variable name="DOCKER_ENABLED" value="True" inherited="true" model="PA:Boolean" description="If true, the workflow tasks will be executed inside a docker container"   />
        <variable name="DOCKER_IMAGE" value="activeeon/dlm3" inherited="true"  description="Name of the docker image"   />
      </variables>
      <depends>
        <task ref="simulate_ptf_PnLs"/>
      </depends>
      <inputFiles>
        <files  includes="outputs_job_${PA_JOB_ID}_task_*.txt" accessMode="transferFromGlobalSpace"/>
      </inputFiles>
      <forkEnvironment javaHome="/usr" >
        <envScript>
          <script>
            <file url="${PA_CATALOG_REST_URL}/buckets/scripts/resources/fork_env_ai/raw" language="groovy"></file>
          </script>
        </envScript>
      </forkEnvironment>
      <scriptExecutable>
        <script>
          <code language="cpython">
            <![CDATA[
import numpy as np
import pandas as pd
from visdom import Visdom
import csv
import plotly.graph_objects as go
from plotly.subplots import make_subplots
import glob


##### PROCESS VAR #####

# Retrieve some variables
job_id = int(variables.get("PA_JOB_ID"))
horizon = int(variables.get("horizon"))
confidence_rate = float(variables.get("confidence_rate"))
nb_bins = int(variables.get("nb_bins"))
chart_file_path_from_dataspace = variables.get("chart_file_path_from_dataspace")
width_chart = int(variables.get("width_chart"))
height_chart = int(variables.get("height_chart"))

# Retrieve ptf PnLs at horizon from all tasks
nb_MC = 0
ptf_horizon_PnLs_list = []

task_result_file_paths = glob.glob(os.path.join(localspace, 'outputs_job_' + str(job_id) + '_task_*.txt'))

for task_result_file_path in task_result_file_paths:
	task_result_file = open(task_result_file_path, "r")
	current_task_ptf_horizon_PnLs_list = list(np.float_(task_result_file.read().split()))
	task_result_file.close()
	ptf_horizon_PnLs_list = ptf_horizon_PnLs_list + current_task_ptf_horizon_PnLs_list
	nb_MC = nb_MC + len(current_task_ptf_horizon_PnLs_list)


# Compute VaR
ptf_horizon_PnLs_list_sorted = sorted(ptf_horizon_PnLs_list, key = lambda x:float(x))
VaR_index = (int)((1 - confidence_rate) * nb_MC);
VaR = ptf_horizon_PnLs_list_sorted[VaR_index]
result_str = "VAR(" + str(confidence_rate*100) + "%, H=" + str(horizon) + ") = " + str(VaR) + "(" + str(nb_MC) + " simus)"
print(result_str)


#####  CONNECT TO VISDOM #####

visdom_endpoint = variables.get("ENDPOINT_VISDOM") if variables.get("ENDPOINT_VISDOM") else results[0].__str__()
print("VISDOM_ENDPOINT: ", visdom_endpoint)

assert visdom_endpoint is not None

visdom_endpoint = visdom_endpoint.replace("http://", "")
(VISDOM_HOST, VISDOM_PORT) = visdom_endpoint.split(":")
print("Connecting to %s:%s" % (VISDOM_HOST, VISDOM_PORT))
vis = Visdom(server="http://"+VISDOM_HOST, port=int(VISDOM_PORT))

assert vis.check_connection()


##### PLOT #####


ptf_horizon_PnLs_df = pd.DataFrame(data = ptf_horizon_PnLs_list_sorted, columns = ['ptf_horizon_PnLs']).iloc[:,0]
trace1 = go.Histogram(x = ptf_horizon_PnLs_df, nbinsx = nb_bins)
#trace2 = go.Histogram(x = ptf_horizon_PnLs_df, nbinsx = nb_bins, histnorm = "probability density", cumulative_enabled=True)
#trace3 = go.Scatter(x=[VaR_index,VaR_index], y=[0,100])

fig = make_subplots(subplot_titles = [result_str], x_title = "Portfolio PnL", y_title = "Frequency")
fig.add_trace(trace1)
#fig.add_trace(trace2)
#fig.add_trace(trace3)

vis.plotlyplot(fig)
]]>
          </code>
        </script>
      </scriptExecutable>
      <metadata>
        <positionTop>
          592.0500030517578
        </positionTop>
        <positionLeft>
          450.6750183105469
        </positionLeft>
      </metadata>
    </task>
    <task name="Wait_For_Signals_With_Variables"




          fork="true">
      <description>
        <![CDATA[ A template task that sends a ready notification for all the signals specified in the variable SIGNALS, then loops until one signal among those specified is received by the job. ]]>
      </description>
      <variables>
        <variable name="SIGNALS" value="stop, kill" inherited="false"  description="List of comma-separated signals expected by this task."  advanced="false" hidden="false"/>
      </variables>
      <genericInformation>
        <info name="task.icon" value="/automation-dashboard/styles/patterns/img/wf-icons/signal-wait.png"/>
        <info name="TASK.DOCUMENTATION" value="user/ProActiveUserGuide.html#_task_signal_api"/>
      </genericInformation>
      <depends>
        <task ref="put_signal"/>
      </depends>
      <scriptExecutable>
        <script>
          <code language="groovy">
            <![CDATA[
import org.ow2.proactive.scheduler.common.job.JobVariable
import java.util.*;

if (variables.get("waitForSignals")){

  List <JobVariable> signalVariables = new java.util.ArrayList<JobVariable>()
  signalVariables.add(new JobVariable("nb_MC", "" + variables.get("nb_MC"), "PA:INTEGER", "The number of Monte Carlo simulations limited to 1000.", "", false, false))
  signalVariables.add(new JobVariable("nb_tasks", "" + variables.get("nb_tasks"), "PA:INTEGER", "The number of ProActive replicated tasks that will execute in parallel.", "", false, false))
  signalVariables.add(new JobVariable("TARGET_INFRASTRUCTURE", "" + variables.get("TARGET_INFRASTRUCTURE"), "PA:MODEL_FROM_URL(\${PA_SCHEDULER_REST_PUBLIC_URL}/rm/model/nodesources?infrastructure=%5E(%3F!(Default)).*\$)", "The node source where the job will be executed.", "Job Execution Parameters", false, false))
  signalVariables.add(new JobVariable("TOKEN", "" + variables.get("TOKEN"), "PA:MODEL_FROM_URL(\${PA_SCHEDULER_REST_PUBLIC_URL}/rm/model/tokens?nodeSource=\${TARGET_INFRASTRUCTURE})", "(Optional) Please select a value in case the node source access is restricted with tokens.", "Job Execution Parameters", false, false))

  signalapi.readyForSignal("Terminate_Job")
  signalapi.readyForSignal("Add_more_MC_simulations", signalVariables)

  variables.put("Terminate_Job", false)
}
variables.put("waitForSignals", false)

signals = new HashSet()
signals.add("Terminate_Job")
signals.add("Add_more_MC_simulations")
now = new Date()
receivedSignal = signalapi.waitForAny(signals)
receivedSignalName = receivedSignal.getName()
println "Received signal = " + receivedSignalName + " At: " + now.format("yyyy/MM/dd hh:mm:ss")

if (receivedSignalName == "Terminate_Job") {
    variables.put("Terminate_Job", true)
    result = receivedSignalName
} else {
    if (receivedSignalName == "Add_more_MC_simulations") {
        println "### Input parameters of the new simulations ####"
        updatedVariables = receivedSignal.getUpdatedVariables()

        variables.put("nb_MC", updatedVariables.get("nb_MC"))
        println "nb_MC : " + updatedVariables.get("nb_MC")

        variables.put("nb_tasks",  updatedVariables.get("nb_tasks"))
        println "nb_tasks : " + updatedVariables.get("nb_tasks")

        variables.put("NODE_SOURCE_INTERNAL", updatedVariables.get("TARGET_INFRASTRUCTURE"))
        variables.put("TOKEN_INTERNAL", updatedVariables.get("TOKEN"))

        variables.put("TARGET_INFRASTRUCTURE", updatedVariables.get("TARGET_INFRASTRUCTURE"))
        println "TARGET_INFRASTRUCTURE : " + updatedVariables.get("TARGET_INFRASTRUCTURE")

        variables.put("TOKEN", updatedVariables.get("TOKEN"))
        println "TOKEN : " + updatedVariables.get("TOKEN")

        signalapi.removeSignal("ready_Terminate_Job")
        variables.put("PA_TASK_ITERATION", 0)
        schedulerapi.connect()

        result = receivedSignalName
    }
    else{
        result = null
    }
}
]]>
          </code>
        </script>
      </scriptExecutable>
      <metadata>
        <positionTop>
          777.4499969482422
        </positionTop>
        <positionLeft>
          411.6750183105469
        </positionLeft>
      </metadata>
    </task>
    <task name="Rerun_Simulation"




          fork="true">
      <description>
        <![CDATA[ A template task that waits for a Signal with variables, allowing to rerun the loop with new variable values. ]]>
      </description>
      <genericInformation>
        <info name="task.icon" value="/automation-dashboard/styles/patterns/img/wf-icons/signal-send.png"/>
      </genericInformation>
      <depends>
        <task ref="Wait_For_Signals_With_Variables"/>
      </depends>
      <scriptExecutable>
        <script>
          <code language="groovy">
            <![CDATA[

]]>
          </code>
        </script>
      </scriptExecutable>
      <controlFlow  block="end">
        <loop target="Start">
          <script>
            <code language="groovy">
              <![CDATA[
loop = ! variables.get("Terminate_Job")
]]>
            </code>
          </script>
        </loop>
      </controlFlow>
      <metadata>
        <positionTop>
          872.8500213623047
        </positionTop>
        <positionLeft>
          515.0249938964844
        </positionLeft>
      </metadata>
    </task>
    <task name="Visdom_Service_Actions"

          onTaskError="cancelJob"


          fork="true">
      <description>
        <![CDATA[ This task manages the life-cycle of Visdom PSA service. It allows to trigger the following actions: Finish_Visdom.
It requires the following variables:
INSTANCE_ID: if used alone or;
INSTANCE_NAME: if used within the same workflow as a Visdom_Service_Start task. In this case there is no need for an INSTANCE_ID.
ACTION: the action to execute on the Visdom service among the aforementioned actions. ]]>
      </description>
      <variables>
        <variable name="INSTANCE_NAME" value="$VISDOM_INSTANCE_NAME" inherited="false"  description="Instance name of the server to be used to broadcast the visualization."  advanced="false" hidden="false"/>
        <variable name="SERVICE_ACTION_WORKFLOW" value="service-automation/Finish_Visdom" inherited="false" model="PA:CATALOG_OBJECT(Workflow/psa,,,%Visdom)" description="The action that will be processed regarding the service status."  advanced="false" hidden="false"/>
        <variable name="INSTANCE_ID" value="" inherited="false"  description="Visdom instance ID to be used."  advanced="false" hidden="false"/>
      </variables>
      <genericInformation>
        <info name="task.icon" value="/automation-dashboard/styles/patterns/img/wf-icons/visdom.png"/>
        <info name="task.documentation" value="PAIO/PAIOUserGuide.html#_visdom_service_actions"/>
      </genericInformation>
      <depends>
        <task ref="Rerun_Simulation"/>
      </depends>
      <scriptExecutable>
        <script>
          <file url="${PA_CATALOG_REST_URL}/buckets/service-automation/resources/Service_Action/raw" language="groovy">
            <arguments>
              <argument value="INSTANCE_NAME"/>
            </arguments>
          </file>
        </script>
      </scriptExecutable>
      <controlFlow block="none"></controlFlow>
      <metadata>
        <positionTop>
          999.2500457763672
        </positionTop>
        <positionLeft>
          515.0249938964844
        </positionLeft>
      </metadata>
    </task>
    <task name="put_signal"




          fork="true">
      <depends>
        <task ref="compute_and_plot_VaR_png"/>
        <task ref="compute_and_plot_VaR_visdom"/>
      </depends>
      <scriptExecutable>
        <script>
          <code language="groovy">
            <![CDATA[
// Put signal for interactive control

variables.put("waitForSignals", true)
]]>
          </code>
        </script>
      </scriptExecutable>
      <metadata>
        <positionTop>
          689.7750091552734
        </positionTop>
        <positionLeft>
          444.1999816894531
        </positionLeft>
      </metadata>
    </task>
  </taskFlow>
  <metadata>
    <visualization>
      <![CDATA[ <html>
    <head>
    <link rel="stylesheet" href="/studio/styles/studio-standalone.css">
        <style>
        #workflow-designer {
            left:0 !important;
            top:0 !important;
            width:2248px;
            height:2574px;
            }
        </style>
    </head>
    <body>
    <div id="workflow-visualization-view"><div id="workflow-visualization" style="position:relative;top:24.92498779296875px;left:-263.1750183105469px"><div class="task ui-draggable" id="jsPlumb_1_922" style="top: -19.9375px; left: 515.025px;"><a class="task-name" data-toggle="tooltip" data-placement="right" title="Start the Visdom server as a service."><img src="/automation-dashboard/styles/patterns/img/wf-icons/visdom.png" width="20px">&nbsp;<span class="name">Start_Visdom_Service</span></a>&nbsp;&nbsp;<a id="called-icon-a" href="javascript:void(0)" class="pointer" style=" position: inherit; top: 17px; right: 3px;"><i title="Workflows being Called by this Task" id="called-icon" class="glyphicon glyphicon-arrow-right"></i></a><a title="Scripts being Called by this Task" id="reference-icon-a" href="javascript:void(0)" class="pointer" style=" position: inherit; top: -7px; right: 3px;"><i id="reference-icon" class="glyphicon glyphicon-list-alt"></i></a></div><div class="task ui-draggable _jsPlumb_endpoint_anchor_" id="jsPlumb_1_925" style="top: 108.438px; left: 515.025px;"><a class="task-name" data-toggle="tooltip" data-placement="right" title="This task has no description"><img src="/studio/images/Groovy.png" width="20px">&nbsp;<span class="name">Init</span></a>&nbsp;&nbsp;<a id="called-icon-a" href="javascript:void(0)" class="pointer" style=" position: inherit; top: 17px; right: 3px;"><i title="Workflows being Called by this Task" id="called-icon"></i></a><a title="Scripts being Called by this Task" id="reference-icon-a" href="javascript:void(0)" class="pointer" style=" position: inherit; top: -7px; right: 3px;"><i id="reference-icon"></i></a></div><div class="task block-start ui-draggable _jsPlumb_endpoint_anchor_" id="jsPlumb_1_928" style="top: 234.85px; left: 515.025px;"><a class="task-name" data-toggle="tooltip" data-placement="right" title="This task has no description"><img src="/studio/images/Groovy.png" width="20px">&nbsp;<span class="name">Start</span></a>&nbsp;&nbsp;<a id="called-icon-a" href="javascript:void(0)" class="pointer" style=" position: inherit; top: 17px; right: 3px;"><i title="Workflows being Called by this Task" id="called-icon"></i></a><a title="Scripts being Called by this Task" id="reference-icon-a" href="javascript:void(0)" class="pointer" style=" position: inherit; top: -7px; right: 3px;"><i id="reference-icon"></i></a></div><div class="task ui-draggable _jsPlumb_endpoint_anchor_" id="jsPlumb_1_931" style="top: 361.25px; left: 448.675px;"><a class="task-name" data-toggle="tooltip" data-placement="right" title="This task has no description"><img src="/studio/images/Groovy.png" width="20px">&nbsp;<span class="name">split_MC_simulations</span></a>&nbsp;&nbsp;<a id="called-icon-a" href="javascript:void(0)" class="pointer" style=" position: inherit; top: 17px; right: 3px;"><i title="Workflows being Called by this Task" id="called-icon"></i></a><a title="Scripts being Called by this Task" id="reference-icon-a" href="javascript:void(0)" class="pointer" style=" position: inherit; top: -7px; right: 3px;"><i id="reference-icon"></i></a></div><div class="task ui-draggable" id="jsPlumb_1_934" style="top: 489.65px; left: 448.675px;"><a class="task-name" data-toggle="tooltip" data-placement="right" title="This task has no description"><img src="/automation-dashboard/styles/patterns/img/wf-icons/quantlib.png" width="20px">&nbsp;<span class="name">simulate_ptf_PnLs</span></a>&nbsp;&nbsp;<a id="called-icon-a" href="javascript:void(0)" class="pointer" style=" position: inherit; top: 17px; right: 3px;"><i title="Workflows being Called by this Task" id="called-icon"></i></a><a title="Scripts being Called by this Task" id="reference-icon-a" href="javascript:void(0)" class="pointer" style=" position: inherit; top: -7px; right: 3px;"><i id="reference-icon"></i></a></div><div class="task ui-draggable active-task" id="jsPlumb_1_937" style="top: 592.45px; left: 268.175px; z-index: 24;"><a class="task-name" data-toggle="tooltip" data-placement="right" title=""><img src="/studio/images/Groovy.png" width="20px">&nbsp;<span class="name">compute_and_plot_VaR_png</span></a>&nbsp;&nbsp;<a id="called-icon-a" href="javascript:void(0)" class="pointer" style=" position: inherit; top: 17px; right: 3px;"><i title="Workflows being Called by this Task" id="called-icon"></i></a><a title="Scripts being Called by this Task" id="reference-icon-a" href="javascript:void(0)" class="pointer" style=" position: inherit; top: -7px; right: 3px;"><i id="reference-icon"></i></a></div><div class="task ui-draggable" id="jsPlumb_1_940" style="top: 592.05px; left: 450.675px; z-index: 24;"><a class="task-name" data-toggle="tooltip" data-placement="right" title=""><img src="/studio/images/Python.png" width="20px">&nbsp;<span class="name">compute_and_plot_VaR_visdom</span></a>&nbsp;&nbsp;<a id="called-icon-a" href="javascript:void(0)" class="pointer" style=" position: inherit; top: 17px; right: 3px;"><i title="Workflows being Called by this Task" id="called-icon"></i></a><a title="Scripts being Called by this Task" id="reference-icon-a" href="javascript:void(0)" class="pointer" style=" position: inherit; top: -7px; right: 3px;"><i id="reference-icon" class="glyphicon glyphicon-list-alt"></i></a></div><div class="task ui-draggable _jsPlumb_endpoint_anchor_" id="jsPlumb_1_943" style="top: 777.45px; left: 411.675px; z-index: 24;"><a class="task-name" data-toggle="tooltip" data-placement="right" title="A template task that sends a ready notification for all the signals specified in the variable SIGNALS, then loops until one signal among those specified is received by the job."><img src="/automation-dashboard/styles/patterns/img/wf-icons/signal-wait.png" width="20px">&nbsp;<span class="name">Wait_For_Signals_With_Variables</span></a>&nbsp;&nbsp;<a id="called-icon-a" href="javascript:void(0)" class="pointer" style=" position: inherit; top: 17px; right: 3px;"><i title="Workflows being Called by this Task" id="called-icon"></i></a><a title="Scripts being Called by this Task" id="reference-icon-a" href="javascript:void(0)" class="pointer" style=" position: inherit; top: -7px; right: 3px;"><i id="reference-icon"></i></a></div><div class="task block-end ui-draggable _jsPlumb_endpoint_anchor_" id="jsPlumb_1_946" style="top: 872.85px; left: 515.025px;"><a class="task-name" data-toggle="tooltip" data-placement="right" title="A template task that waits for a Signal with variables, allowing to rerun the loop with new variable values."><img src="/automation-dashboard/styles/patterns/img/wf-icons/signal-send.png" width="20px">&nbsp;<span class="name">Rerun_Simulation</span></a>&nbsp;&nbsp;<a id="called-icon-a" href="javascript:void(0)" class="pointer" style=" position: inherit; top: 17px; right: 3px;"><i title="Workflows being Called by this Task" id="called-icon"></i></a><a title="Scripts being Called by this Task" id="reference-icon-a" href="javascript:void(0)" class="pointer" style=" position: inherit; top: -7px; right: 3px;"><i id="reference-icon"></i></a></div><div class="task ui-draggable _jsPlumb_endpoint_anchor_" id="jsPlumb_1_949" style="top: 999.25px; left: 515.025px;"><a class="task-name" data-toggle="tooltip" data-placement="right" title="This task manages the life-cycle of Visdom PSA service. It allows to trigger the following actions: Finish_Visdom.
It requires the following variables:
INSTANCE_ID: if used alone or;
INSTANCE_NAME: if used within the same workflow as a Visdom_Service_Start task. In this case there is no need for an INSTANCE_ID.
ACTION: the action to execute on the Visdom service among the aforementioned actions."><img src="/automation-dashboard/styles/patterns/img/wf-icons/visdom.png" width="20px">&nbsp;<span class="name">Visdom_Service_Actions</span></a>&nbsp;&nbsp;<a id="called-icon-a" href="javascript:void(0)" class="pointer" style=" position: inherit; top: 17px; right: 3px;"><i title="Workflows being Called by this Task" id="called-icon" class="glyphicon glyphicon-arrow-right"></i></a><a title="Scripts being Called by this Task" id="reference-icon-a" href="javascript:void(0)" class="pointer" style=" position: inherit; top: -7px; right: 3px;"><i id="reference-icon" class="glyphicon glyphicon-list-alt"></i></a></div><svg style="position:absolute;left:554.5px;top:19.5px" width="40.5" height="89" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector "><path d="M 0 88 C -10 38 29.5 50 19.5 0 " transform="translate(10.5,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#666" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M-1.1659680000000008,66.303232 L11.101334505106049,49.025694870877146 L2.712976460524842,52.8513254484303 L-2.3505720464636433,45.1467504103523 L-1.1659680000000008,66.303232" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M-1.1659680000000008,66.303232 L11.101334505106049,49.025694870877146 L2.712976460524842,52.8513254484303 L-2.3505720464636433,45.1467504103523 L-1.1659680000000008,66.303232" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path></svg><svg style="position:absolute;left:550.0235032915331px;top:147.5px" width="15.47649670846693" height="88" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector "><path d="M 0 87 C -10 37 -10 50 0 0 " transform="translate(14.97649670846693,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#666" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M-4.331249999999999,65.86284375000001 L-1.2275778407318203,44.90175553569722 L-6.970801092219563,52.1139248822649 L-14.97649670846693,47.54130662791678 L-4.331249999999999,65.86284375000001" class="" stroke="#666" fill="#666" transform="translate(14.97649670846693,0.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M-4.331249999999999,65.86284375000001 L-1.2275778407318203,44.90175553569722 L-6.970801092219563,52.1139248822649 L-14.97649670846693,47.54130662791678 L-4.331249999999999,65.86284375000001" class="" stroke="#666" fill="#666" transform="translate(14.97649670846693,0.5)"></path></svg><svg style="position:absolute;left:505.5px;top:274.5px" width="70" height="87" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector "><path d="M 0 86 C -10 36 59 50 49 0 " transform="translate(10.5,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#666" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M1.9903747499999969,63.10169600000001 L19.46560376735256,51.117691210653554 L10.272405163146468,51.81418200285623 L8.178089770208775,42.83566079750708 L1.9903747499999969,63.10169600000001" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M1.9903747499999969,63.10169600000001 L19.46560376735256,51.117691210653554 L10.272405163146468,51.81418200285623 L8.178089770208775,42.83566079750708 L1.9903747499999969,63.10169600000001" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path></svg><svg style="position:absolute;left:536.1px;top:390.5px" width="30.600000000000023" height="100" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector "><path d="M 0 89 C -10 89 19.600000000000023 -10 9.600000000000023 0 " transform="translate(10.5,10.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#e5db3d" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M-1.7943911999999977,77.82858800000001 L7.8291154168641715,58.95034336774747 L0.08648603554837453,63.95550972498131 L-6.043962858154531,57.0694661321991 L-1.7943911999999977,77.82858800000001" class="" stroke="rgba(229,219,61,0.5)" fill="rgba(229,219,61,0.5)" transform="translate(10.5,10.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M-1.7943911999999977,77.82858800000001 L7.8291154168641715,58.95034336774747 L0.08648603554837453,63.95550972498131 L-6.043962858154531,57.0694661321991 L-1.7943911999999977,77.82858800000001" class="" stroke="rgba(229,219,61,0.5)" fill="rgba(229,219,61,0.5)" transform="translate(10.5,10.5)"></path></svg><div class="_jsPlumb_overlay l1 component label" id="jsPlumb_1_966" style="position: absolute; transform: translate(-50%, -50%); left: 550.9px; top: 441.25px;">replicate</div><svg style="position:absolute;left:499.5px;top:400.5px" width="27" height="90" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector "><path d="M 0 89 C -10 39 16 50 6 0 " transform="translate(10.5,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#666" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M-2.320704,67.21769599999999 L6.809306733328803,48.09590466107725 L-0.8007319418315451,53.30045184239511 L-7.107937424276075,46.5759326029088 L-2.320704,67.21769599999999" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M-2.320704,67.21769599999999 L6.809306733328803,48.09590466107725 L-0.8007319418315451,53.30045184239511 L-7.107937424276075,46.5759326029088 L-2.320704,67.21769599999999" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path></svg><svg style="position:absolute;left:309.1750183105469px;top:529.5px" width="211.32498168945312" height="63.45002746582031" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector"><path d="M 0 62.45002746582031 C -10 12.450027465820312 200.32498168945312 50 190.32498168945312 0 " transform="translate(10.5,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#666" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M28.023313516548157,38.37544050626755 L48.980407198781975,41.505971514591124 L41.775603649824724,35.75351066544725 L46.358477357961675,27.753681381314554 L28.023313516548157,38.37544050626755" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M28.023313516548157,38.37544050626755 L48.980407198781975,41.505971514591124 L41.775603649824724,35.75351066544725 L46.358477357961675,27.753681381314554 L28.023313516548157,38.37544050626755" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path></svg><svg style="position:absolute;left:497px;top:816.5px" width="88" height="57" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector"><path d="M 67 56 C 77 6 -10 50 0 0 " transform="translate(10.5,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#666" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M63.81886025000001,36.7111045 L50.46749882415647,20.25689081242145 L51.901501362207384,29.364230529422432 L43.12062485357891,32.17424970021408 L63.81886025000001,36.7111045" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M63.81886025000001,36.7111045 L50.46749882415647,20.25689081242145 L51.901501362207384,29.364230529422432 L43.12062485357891,32.17424970021408 L63.81886025000001,36.7111045" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path></svg><svg style="position:absolute;left:614.5px;top:224.5px" width="51" height="699" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector "><path d="M 0 0 C 50 -50 9 648 19 598 " transform="translate(0.5,50.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#316b31" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M23.86275075,104.88780900000003 L31.545278307560736,124.63568914768474 L24.343408793750342,118.87955541869195 L17.553531888868818,125.11634719143508 L23.86275075,104.88780900000003" class="" stroke="#316b31" fill="#316b31" transform="translate(0.5,50.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M23.86275075,104.88780900000003 L31.545278307560736,124.63568914768474 L24.343408793750342,118.87955541869195 L17.553531888868818,125.11634719143508 L23.86275075,104.88780900000003" class="" stroke="#316b31" fill="#316b31" transform="translate(0.5,50.5)"></path></svg><div class="_jsPlumb_overlay l1 component label" id="jsPlumb_1_987" style="position: absolute; transform: translate(-50%, -50%); left: 639px; top: 573.5px;">loop</div><svg style="position:absolute;left:564px;top:912.5px" width="36.5" height="87" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector "><path d="M 15.5 86 C 25.5 36 -10 50 0 0 " transform="translate(10.5,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#666" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M17.057390625,64.94400000000002 L19.282210424751046,43.8715018837672 L13.845463517070105,51.31742580641251 L5.655636231163537,47.0834289916971 L17.057390625,64.94400000000002" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M17.057390625,64.94400000000002 L19.282210424751046,43.8715018837672 L13.845463517070105,51.31742580641251 L5.655636231163537,47.0834289916971 L17.057390625,64.94400000000002" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path></svg><div class="_jsPlumb_endpoint source-endpoint dependency-source-endpoint connected _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 574.5px; top: 10px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint dependency-source-endpoint connected _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 555px; top: 138px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint target-endpoint dependency-target-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 555px; top: 98px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint dependency-source-endpoint connected _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 555px; top: 265px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint target-endpoint dependency-target-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 555px; top: 225px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint target-endpoint loop-target-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected _jsPlumb_endpoint_full" style="position: absolute; height: 20px; width: 20px; left: 605px; top: 265px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#316b31" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint dependency-source-endpoint connected _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 506px; top: 391px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint target-endpoint dependency-target-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 506px; top: 351px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint replicate-source-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected _jsPlumb_endpoint_full" style="position: absolute; height: 20px; width: 20px; left: 546.2px; top: 391px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#e5db3d" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint dependency-source-endpoint connected _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected endpointDrag" style="position: absolute; height: 20px; width: 20px; left: 500px; top: 520px; visibility: visible;" dragid="jsPlumb_1_1036" elid="jsPlumb_1_934"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint target-endpoint replicate-target-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected _jsPlumb_endpoint_full" style="position: absolute; height: 20px; width: 20px; left: 536.6px; top: 480px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#e5db3d" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint target-endpoint dependency-target-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 500px; top: 480px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint dependency-source-endpoint connected _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable endpointDrag _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 309.675px; top: 622.45px; visibility: visible;" dragid="jsPlumb_1_1030" elid="jsPlumb_1_937"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint target-endpoint dependency-target-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 309.675px; top: 582.45px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint dependency-source-endpoint connected _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable endpointDrag _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 499.675px; top: 622.05px; visibility: visible;" dragid="jsPlumb_1_1044" elid="jsPlumb_1_940"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint dependency-source-endpoint connected _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 497.5px; top: 807px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint dependency-source-endpoint connected _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 564.5px; top: 903px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint target-endpoint dependency-target-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 564.5px; top: 863px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint loop-source-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected _jsPlumb_endpoint_full" style="position: absolute; height: 20px; width: 20px; left: 624px; top: 863px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#316b31" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint source-endpoint dependency-source-endpoint connected _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable" style="position: absolute; height: 20px; width: 20px; left: 580px; top: 1029px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint target-endpoint dependency-target-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 580px; top: 989px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="task ui-draggable" id="jsPlumb_1_1015" style="top: 689.775px; left: 444.2px; z-index: 24;"><a class="task-name" data-toggle="tooltip" data-placement="right" title=""><img src="/studio/images/Groovy.png" width="20px">&nbsp;<span class="name">put_signal</span></a>&nbsp;&nbsp;<a id="called-icon-a" href="javascript:void(0)" class="pointer" style=" position: inherit; top: 17px; right: 3px;"><i title="Workflows being Called by this Task" id="called-icon"></i></a><a title="Scripts being Called by this Task" id="reference-icon-a" href="javascript:void(0)" class="pointer" style=" position: inherit; top: -7px; right: 3px;"><i id="reference-icon"></i></a></div><div class="_jsPlumb_endpoint source-endpoint dependency-source-endpoint connected _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable endpointDrag _jsPlumb_endpoint_connected" style="position: absolute; height: 20px; width: 20px; left: 484px; top: 720px; visibility: visible;" dragid="jsPlumb_1_1022" elid="jsPlumb_1_1015"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><div class="_jsPlumb_endpoint target-endpoint dependency-target-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected connected" style="position: absolute; height: 20px; width: 20px; left: 484px; top: 680px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><svg style="position:absolute;left:483.5px;top:726.5px" width="34.5" height="54" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector"><path d="M 13.5 47 C 23.5 -3 -10 50 0 0 " transform="translate(10.5,3.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#666" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M15.336746999999997,33.96471400000001 L17.679996767209055,12.90505634541135 L12.201476364518587,20.32029836420644 L4.035581131415485,16.04032698089276 L15.336746999999997,33.96471400000001" class="" stroke="#666" fill="#666" transform="translate(10.5,3.5)"></path></svg><div class="_jsPlumb_endpoint target-endpoint dependency-target-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected connected" style="position: absolute; height: 20px; width: 20px; left: 497.5px; top: 767px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><svg style="position:absolute;left:309.1750183105469px;top:631.9500274658203px" width="195.32498168945312" height="58.54997253417969" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector"><path d="M 174.32498168945312 57.54997253417969 C 184.32498168945312 7.5499725341796875 -10 50 0 0 " transform="translate(10.5,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#666" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M149.89920330047607,34.49528932571411 L131.50160607447796,23.98203976575661 L136.13166281015245,31.954653805357133 L128.96097055412096,37.749580256080236 L149.89920330047607,34.49528932571411" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path></svg><svg style="position:absolute;left:499.1750183105469px;top:529.5px" width="21.324981689453125" height="63.05000305175781" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector"><path d="M 0 62.05000305175781 C -10 12.050003051757812 10.324981689453125 50 0.324981689453125 0 " transform="translate(10.5,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#666" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M-2.5412032797775264,46.1758891874199 L4.638980547729659,26.23986751299337 L-2.414875111385071,32.17645915638397 L-9.360449483306269,26.113539344600916 L-2.5412032797775264,46.1758891874199" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path></svg><div class="_jsPlumb_endpoint target-endpoint dependency-target-endpoint _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable _jsPlumb_endpoint_connected connected" style="position: absolute; height: 20px; width: 20px; left: 499.675px; top: 582.05px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div><svg style="position:absolute;left:483.5px;top:631.5500030517578px" width="36.675018310546875" height="58.94999694824219" pointer-events="none" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml" class="_jsPlumb_connector"><path d="M 0 57.94999694824219 C -10 7.9499969482421875 25.675018310546875 50 15.675018310546875 0 " transform="translate(10.5,0.5)" pointer-events="visibleStroke" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="none" stroke="#666" style=""></path><path pointer-events="all" version="1.1" xmlns="http://www.w3.org/1999/xhtml" d="M-1.7849726021118162,42.7124643895569 L10.158720447069378,25.209659004506744 L1.8429987253621682,29.190710655405894 L-3.3630332870816275,21.581687677032757 L-1.7849726021118162,42.7124643895569" class="" stroke="#666" fill="#666" transform="translate(10.5,0.5)"></path></svg></div></div>
    </body>
</html>
 ]]>
    </visualization>
  </metadata>
</job>